# 《Project Harmony》第七章开发计划：合成主脑·斯托克豪森

**文档目的：** 本文档为《Project Harmony》第七章，也是最终章——“合成主脑·斯托克豪森”——提供详细、可执行的开发计划。本章将作为整个游戏机制的集大成者，聚焦于“电子音乐”、“频谱合成”与“玩家创造力”本身，带来一场史诗级的、与游戏规则本身对抗的终极Boss战。

**核心目标：** 引入“频谱相位”作为核心战斗解谜机制，并设计一个能够动态分析并反制玩家行为的、具有学习能力的最终Boss。

---

## 1. 章节设计：解构音乐

第七章的主题是“声音的本质”。灵感来源于卡尔海因茨·斯托克豪森等先锋电子音乐作曲家对声音物理属性的探索。战斗将不再局限于音符和节奏，而是深入到频率、波形和频谱的层面。

### 1.1. 章节时间线 (第七章)

本章没有传统的“波次”概念，而是只有一个不断进化的、分为多个乐章的Boss战。

```
[章节开始]
│
└─ 【Boss 战】合成主脑·斯托克豪森
    │
    ├─ 乐章 I: 正弦波 (Sine Wave)
    │
    ├─ 乐章 II: 方波与锯齿波 (Square & Sawtooth)
    │
    ├─ 乐章 III: 频谱分裂 (Spectral Splitting)
    │
    └─ 最终乐章: 白噪音 (White Noise)
```

---

## 2. 核心系统改造

*   **频谱相位系统:** 这是本章的核心。玩家将解锁在“高频（Overtone）”、“基频（Fundamental）”和“低频（Sub-bass）”三个相位之间切换的能力。不同相位的敌人和弹幕拥有完全不同的属性和行为。
*   **Boss AI:** Boss需要一个能够分析玩家行为模式（如常用音符、和弦、节奏型）的模块，并根据分析结果调整自身的攻击策略和抗性。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **UI元素** | `PhaseSwitcher.tscn` | 一个清晰的UI，显示当前所处的频谱相位，并允许玩家快速切换。 | **极高** |
| **Boss模型** | `Boss_Stockhausen.tscn` | 一个巨大的、由示波器、频谱分析仪和各种合成器模块构成的抽象“主脑”。 | **极高** |
| **Shader** | `SpectrumVisualizer.gdshader` | Boss战背景，实时将游戏内所有音效（玩家、敌人、BGM）可视化为动态的频谱图。 | **极高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 频谱相位系统实现 (预计 4 天)

*   [ ] **Task 1.1**: 创建 `PhaseManager.gd` 全局单例，管理玩家的相位切换、能量消耗和冷却。
*   [ ] **Task 1.2**: 修改弹幕和敌人基类，使其能够根据当前全局相位改变自身的属性和行为。
*   [ ] **Task 1.3**: 为游戏中所有现存的敌人和弹幕，设计并实现其在高、中、低三个相位下的不同形态。
*   [ ] **Task 1.4**: **(集成测试)** 在测试关卡中反复切换相位，验证所有物体的行为变化是否符合设计。

### Milestone 2: 最终Boss实现 (预计 6 天)

*   [ ] **Task 2.1**: 创建 `boss_stockhausen.gd` 脚本。
*   [ ] **Task 2.2**: **(核心难点)** 实现Boss的四个乐章，每个乐章拥有基于不同波形（正弦波、方波、锯齿波、白噪音）的独特攻击模式。
*   [ ] **Task 2.3**: **(核心难点)** 实现Boss的“玩家分析”模块。例如，如果玩家频繁使用G音符，Boss会临时获得对G音符的高额抗性，并释放专门克制近战的攻击模式。
*   [ ] **Task 2.4**: 实现 `SpectrumVisualizer.gdshader`，并将其作为Boss战的核心背景。
*   [ ] **Task 2.5**: **(最终测试)** 完整挑战并通过四个乐章的Boss战，体验这场与游戏系统本身对抗的史诗级战斗。

---

## 5. Boss 战详细设计：合成主脑·斯托克豪森

*   **核心机制:** Boss战的解谜核心在于“频谱相位切换”。Boss的某些攻击只能在特定相位下被躲避或伤害，强迫玩家根据弹幕的“音色”（视觉上表现为形态和颜色）来切换相位。

### 乐章 I: 正弦波 (Sine Wave)

*   **HP:** 2000
*   **攻击模式:** 所有弹幕都是平滑、纯净的正弦波形态。
    1.  **纯音弹幕 (Pure Tone Bullets):** 基础的追踪弹幕，只能在“基频”相位下被正常伤害。
    2.  **驻波 (Standing Wave):** 在场地中生成数条固定的、持续造成伤害的“线”。这些线在高频相位下变得透明无害，在低频相位下范围扩大但伤害降低。

### 乐章 II: 方波与锯齿波 (Square & Sawtooth)

*   **HP:** 2500
*   **攻击模式:** 弹幕变为棱角分明的方波和锯齿波形态，攻击性更强。
    1.  **方波脉冲 (Square Pulse):** 产生覆盖半个场地的矩形冲击波，必须切换到高频相位（体积变小）才能从缝隙中穿过。
    2.  **锯齿波扫射 (Sawtooth Strafe):** 发射快速、穿透性的锯齿状激光，必须切换到低频相位（获得霸体和减伤）才能硬抗。

### 乐章 III: 频谱分裂 (Spectral Splitting)

*   **HP:** 3000
*   **新机制:** Boss将自身分裂成三个部分，分别对应高、中、低三个频段，玩家必须切换到对应的相位才能对该部分造成伤害。
*   **攻击模式:** 三个部分同时使用前两个乐章的技能，形成极其复杂的复合弹幕。

### 最终乐章: 白噪音 (White Noise)

*   **HP:** 4000
*   **新机制:** Boss合为一体，进入“白噪音”形态。此时，所有弹幕都混合了高、中、低三种频段的特性，玩家的相位切换不再有“完美解”，而必须在承受一部分伤害和获得一部分增益之间做出动态权衡。
*   **攻击模式:**
    1.  **熵增 (Entropy Increase):** Boss开始分析并反制玩家的行为。例如，玩家使用高伤害和弦，Boss会生成吸收伤害的护盾；玩家使用大范围法术，Boss会分裂成多个高速移动的小核心。
    2.  **格式塔崩溃 (Gestalt Collapse):** （终极技能）Boss开始解构游戏UI本身，玩家的血条、序列器、音符库存等UI元素会开始“故障”和“漂移”，甚至成为Boss的弹幕来源。玩家将在信息不完整的极端压力下，完成最后的战斗。

*   **击败奖励:** 通关游戏，解锁“自由创作模式”（Sandbox Mode），允许玩家不受限制地使用所有音符、和弦和机制，创造属于自己的音乐和声的乐谱序列器扩展到无限长，真正地“用一场战斗，一首乐曲”。
