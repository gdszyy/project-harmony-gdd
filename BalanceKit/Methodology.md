# 平衡性跑分系统方法论 (Balance Scoring System Methodology)

**作者：** Manus AI
**版本：** 1.0
**日期：** 2026年2月7日

---

## 1. 设计理念与目标

**Project Harmony** 的核心机制是动态且复杂的，任何微小的数值改动都可能对整个系统产生连锁反应。为了高效、科学地进行平衡性调整，我们设计并实现了这套**平衡性跑分系统 (Balance Scoring System)**。

其核心目标是：

*   **量化策略表现**：将玩家可能采用的各种法术策略（Builds）转化为可量化、可比较的综合得分。
*   **自动化评估**：提供一个“一键跑分”的工具，让设计师在修改数值后能快速得到反馈，评估改动对所有策略的影响。
*   **识别最优与最差实践**：通过得分排序，清晰地识别出哪些策略过于强大（Over-powered）或过于弱小（Under-powered），从而指导平衡性调整。
*   **验证核心设计**：确保数值改动后的系统依然遵循“多样性优于单调性”、“风险与回报匹配”等核心设计原则。

本系统并非旨在取代设计师的最终判断，而是作为一个强大的**决策辅助工具**，用数据驱动平衡性工作。

---

## 2. 核心评估模型

我们将一个法术策略的综合表现分解为三个核心维度：**输出 (DPS)**、**生存 (Survival)** 和 **风险 (Risk)**。一个策略的最终综合得分 `S` 是这三个维度评分的加权总和。

### 2.1. 综合得分公式

> **综合得分 (S)** = (w_dps × S_dps) + (w_survival × S_survival) - (w_risk × S_risk)

其中：

| 变量 | 含义 | 权重 (w) | 设计说明 |
| :--- | :--- | :--- | :--- |
| **S_dps** | **有效DPS评分** | 0.50 | 游戏的核心是造成伤害，因此输出能力占据最大权重。 |
| **S_survival** | **生存贡献评分** | 0.25 | 治疗、护盾、闪避等生存能力是有效输出的保障。 |
| **S_risk** | **综合风险评分** | 0.25 | 策略执行过程中付出的代价，包括生命值损失和操作限制。 |

### 2.2. 模拟环境

为了在统一标准下评估不同策略，所有跑分都在一个标准化的**8小节（32拍）模拟战斗**中进行。这个时长足以让一个策略完成数次循环，并让疲劳系统的效果充分显现。

---

## 3. 维度评分详解

### 3.1. 有效DPS评分 (S_dps)

此评分衡量策略的实际伤害输出能力。它并非简单计算理论上的最高伤害，而是综合考虑了疲劳系统的动态惩罚。

> **S_dps** = (策略的有效DPS / 基准DPS) × 50

*   **有效DPS (Effective DPS)**：在8小节模拟中，计入所有**单调值**和**密度值**造成的伤害衰减后，计算出的平均每秒伤害。
*   **基准DPS (Benchmark DPS)**：我们设定了一个理想的DPS参考值（当前为 **100**），代表一个平衡良好的策略在游戏初期应达到的水平。评分会根据策略DPS与此基准的接近程度进行归一化。

### 3.2. 生存贡献评分 (S_survival)

此评分量化策略为玩家带来的生存价值。

> **S_survival** = 治疗评分 + 护盾评分 + 闪避评分

*   **治疗/护盾评分**：将模拟中产生的总治疗量和总护盾量，与其占玩家最大生命值的百分比挂钩。例如，总治疗量达到最大生命值的50%，即可获得较高的治疗评分。
*   **闪避评分**：直接与玩家通过升级获得的闪避率挂钩。

### 3.3. 综合风险评分 (S_risk)

此评分是惩罚项，量化策略的负面影响和操作成本。

> **S_risk** = (HP损失风险 × 40%) + (操作锁定风险 × 40%) + (性能衰减风险 × 20%)

*   **HP损失风险**：主要来源于**不和谐值**累积导致的持续扣血。我们会计算模拟中总扣血量占玩家最大生命值的百分比。
*   **操作锁定风险**：来源于**单调值**达到峰值（90+）后，导致音符被禁用的总时长。
*   **性能衰减风险**：来源于**密度值**过高导致的全属性debuff，或单调值导致的伤害衰减的总时长。

---

## 4. 跑分系统实现 (`balance_scorer.py`)

该系统的完整实现位于 `BalanceKit/balance_scorer.py` 文件中，其核心组件包括：

1.  **数据定义模块**：定义了音符、和弦、升级项等所有基础数据结构。
2.  **数值成长系统**：实现了 `PlayerBuild` 类，可以动态应用各种肉鸽升级，并实时更新玩家的所有属性。
3.  **策略模拟器 (`StrategySimulator`)**：
    *   这是系统的核心，它接收一个 `PlayerBuild` 和一个 `StrategyDefinition`（一个由32个动作组成的序列）。
    *   逐拍（Beat by Beat）模拟施法过程。
    *   在每一拍，它都会计算：
        1.  当前的原始伤害输出。
        2.  单调值、密度值、不和谐值的累积与衰减。
        3.  根据当前的疲劳值计算伤害惩罚，得到有效伤害。
        4.  计算不和谐值导致的HP损失。
    *   模拟结束后，输出包含所有维度评分和综合得分的 `SimulationResult` 对象。
4.  **预定义策略库**：我们内置了十几种覆盖不同风格的典型策略，从“纯音符Spam”这样的极端反面教材，到“混合最优策略”这样的理想模板，用于提供丰富的对比参照。
5.  **主执行入口**：脚本可以独立运行，自动对“初始”、“中期”、“后期”三种不同成长阶段的Build，运行所有预定义策略，并打印出清晰的命令行报告。

---

## 5. 可视化报告 (`generate_report.py`)

为了更直观地分析跑分结果，我们提供了 `BalanceKit/generate_report.py` 脚本，它可以调用跑分系统并生成一系列可视化图表，存放在 `BalanceKit/Reports/` 目录下：

*   **策略综合得分对比图**：直观展示在不同成长阶段，各策略的强弱排序。
*   **DPS vs 风险散点图**：将策略置于二维坐标系中，帮助设计师找到位于“高DPS、低风险”理想象限的策略。
*   **疲劳峰值热力图**：展示每种策略最容易在哪一个疲劳维度上“触顶”，有助于诊断策略的风险来源。
*   **音符DPS成长曲线**：展示单个音符在获得“伤害增幅”升级后的DPS变化，验证成长性是否符合预期。
*   **和弦不和谐度-威力关系图**：验证“高风险高回报”的设计原则是否在和弦设计中得到体现。
*   **扩展和弦惩罚增长曲线**：展示随着和弦音数的增加，其不和谐度和疲劳代价是否呈指数级增长，以平衡其强大威力。

通过这一整套自动化的跑分、分析与可视化流程，我们可以确保 **Project Harmony** 的数值体系在不断迭代和扩展的过程中，始终保持健康、平衡和充满乐趣。
