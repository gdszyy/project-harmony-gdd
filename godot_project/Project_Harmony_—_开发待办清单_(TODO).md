# Project Harmony — 开发待办清单 (TODO)

> **重要规范**：每次对代码或设计文档进行修改后，**必须同步更新本文件**以反映最新的开发状态。  
> 最后更新时间：2026-02-08 v5.0

---

## 目录

1. [核心系统状态总览](#核心系统状态总览)
2. [法术构建系统 (SpellcraftSystem)](#法术构建系统-spellcraftsystem)
3. [听感疲劳系统 (FatigueManager)](#听感疲劳系统-fatiguemanager)
4. [调式系统 (ModeSystem)](#调式系统-modesystem)
5. [音乐理论引擎 (MusicTheoryEngine)](#音乐理论引擎-musictheoryengine)
6. [弹体系统 (ProjectileManager)](#弹体系统-projectilemanager)
7. [敌人系统 (EnemySpawner)](#敌人系统-enemyspawner)
8. [Boss 系统](#boss-系统)
9. [视觉与 Shader](#视觉与-shader)
10. [UI 系统](#ui-系统)
11. [音频系统](#音频系统)
12. [局外成长 (SaveManager)](#局外成长-savemanager)
13. [游戏流程](#游戏流程)
14. [性能优化](#性能优化)
15. [待设计/待讨论](#待设计待讨论)

---

## 核心系统状态总览

| 系统 | 状态 | 完成度 | 说明 |
|------|------|--------|------|
| 法术构建系统 | ✅ 核心完成 | 90% | 序列器、手动施法、和弦、节奏型、进行效果、调式集成、留白奖励 |
| 听感疲劳系统 | ✅ 核心完成 | 95% | 八维AFI、三维惩罚、留白奖励机制均已实现 |
| 调式系统 | ✅ 新增完成 | 90% | 4种调式实际影响（限制音符、伤害加成、被动效果）均已实现 |
| 音乐理论引擎 | ✅ 完成 | 95% | 和弦识别、功能判定、进行分析、不和谐度计算均已实现 |
| 弹体系统 | ✅ 全面完成 | 95% | MultiMesh渲染、修饰符、和弦弹体、摇摆弹道、拖尾效果、**全部法术形态** |
| 敌人系统 | ✅ 核心完成 | 75% | 5种基础敌人已实现，需要更多敌人变体 |
| Boss 系统 | ⚠️ 待重做 | 10% | 原Boss已归档，需按GDD重新设计音乐史七大Boss |
| 视觉/Shader | ✅ 全面完成 | 98% | 疲劳滤镜、弹体发光、**固化静默**、**Boss血条纹理**、**受击反馈**、全部Shader |
| UI 系统 | ✅ 全面完成 | 98% | HUD全面完善 + **序列器拖拽** + **殿堂交互** + **法典数据** + Boss血条主题化 |
| 音频系统 | ✅ 全面完成 | 95% | 音符合成、ADSR、音色、**和弦音效**、**BGM动态混音**、全部音效 |
| 局外成长 | ✅ 核心完成 | 90% | 乐器调优、乐理研习、声学降噪、调式选择（调式已有实际影响） |
| 游戏流程 | ✅ 核心完成 | 85% | 完整流程 + 碰撞层配置 + 调式集成 |

---

## 法术构建系统 (SpellcraftSystem)

### 已完成 ✅

- [x] 16拍序列器 (4小节 × 4拍)
- [x] 7个白键音符，每个有独立四维属性 (DMG/SPD/DUR/SIZE)
- [x] 5个黑键修饰符 (穿透/追踪/分裂/回响/散射)
- [x] **黑键双重身份**：和弦缓冲窗口内参与和弦构建，否则作为修饰符 (Issue #18) — *v2.0*
- [x] 和弦构建缓冲区 (0.3秒窗口)
- [x] 9种基础和弦 → 9种法术形态映射
- [x] 6种扩展和弦 → 6种传说法术形态映射
- [x] **6种节奏型识别与行为修饰** (连射/重击/闪避射击/摇摆弹道/三连发/精准蓄力) — *v2.0*
- [x] **手动施法槽** (3槽，带冷却，八分音符精度对齐，时机奖励+15%) — *v2.0*
- [x] **和弦进行效果完整实现** — *v2.0*
  - D→T: 爆发治疗（低血量）或全屏伤害（高血量），受完整度加成
  - T→D: 增伤Buff（下一法术伤害翻倍），受完整度加成
  - PD→D: 全体手动施法槽冷却缩减50%，受完整度加成
- [x] 音色系统接口 (切换音色、疲劳代价)
- [x] **单音寂静检查集成** — *v2.0*
- [x] **密度过载精准度惩罚集成** — *v2.0*
- [x] **不和谐法术缓解单调值的交互** — *v2.0*
- [x] **调式系统集成** — *v3.0 新增*
  - 调式不可用音符自动跳过
  - 调式伤害倍率应用
  - 多利亚自动回响被动
  - 布鲁斯暴击被动
  - 五声音阶不和谐度减半
- [x] **留白奖励集成** — *v3.0 新增*
  - 休止符记录 → FatigueManager.record_rest()
  - 施法时重置休止符计数 → FatigueManager.reset_rest_counter()
- [x] **系统重置接口** (含调式重置) — *v3.0 完善*
- [x] **序列器 UI 的拖拽编辑交互** — *v5.0 完成*

### 待完成 🔲

- [ ] 音色切换的快捷键绑定 (UI 已在 v4.0 完成)

---

## 听感疲劳系统 (FatigueManager)

### 已完成 ✅

- [x] 八维 AFI 计算 (音高熵/转移熵/节奏熵/和弦多样性/模式递归/密度/留白缺失/持续压力)
- [x] 滑动窗口 + 指数时间衰减
- [x] 五级疲劳等级 (NONE/MILD/MODERATE/SEVERE/CRITICAL)
- [x] 三种惩罚模式 (WEAKEN/LOCKOUT/GLOBAL_DEBUFF)
- [x] **单音寂静惩罚** — *v2.0*
  - 短窗口(8秒)内同一音符使用 ≥4次 → 该音符暂时禁用
  - 基础寂静时间3秒 + 每多用1次额外+1秒
  - 受单调抗性升级减免
- [x] **密度过载惩罚** — *v2.0*
  - 3秒内施法次数超过动态阈值 → 弹体精准度下降
  - 轻度过载：0.3弧度散射偏移 / 严重过载：0.6弧度散射偏移
  - 阈值随BPM动态调整，受密度抗性升级加成
- [x] **不和谐值连接** — *v2.0*
  - 不和谐法术直接扣血 (生命腐蚀)
  - 不和谐度 > 2.0 时触发
- [x] **不和谐法术缓解单调值** — *v2.0*
- [x] **留白奖励机制** — *v3.0 新增*
  - 连续2个休止符触发"留白清洗"
  - 减少所有被寂静音符的剩余时间 (1.5秒/次)
  - 减少总体疲劳度 (0.03/次)
  - 缓解密度过载 (精准度惩罚 -0.15)
  - 信号：rest_cleanse_triggered
- [x] 每个音符的独立疲劳度查询
- [x] 恢复建议系统
- [x] 外部疲劳注入/减少接口
- [x] 升级抗性接口
- [x] **系统重置接口** (含留白计数器重置) — *v3.0 完善*

### 待完成 🔲

- [ ] 调优：单音寂静触发阈值的平衡性测试
- [ ] 调优：密度过载阈值与 BPM 的动态关系微调
- [ ] 疲劳等级变化时的视觉/音效反馈增强

---

## 调式系统 (ModeSystem)

> *v3.0 新增模块*

### 已完成 ✅

- [x] **4种调式定义与实际影响** — *v3.0 新增*
  - 伊奥尼亚 (均衡者): 全套白键 (CDEFGAB)，无特殊被动
  - 多利亚 (民谣诗人): 全套白键，每3次施法自动附加回响修饰符
  - 五声音阶 (东方行者): 仅 CDEGA，剩余音符伤害+20%，不和谐度减半
  - 布鲁斯 (爵士乐手): 全套白键，不和谐值转化为暴击率 (每点+3%，上限30%)
- [x] **可用白键限制** (五声音阶移除 F 和 B)
- [x] **调式伤害倍率** (五声音阶 1.2x)
- [x] **调式不和谐度倍率** (五声音阶 0.5x)
- [x] **多利亚自动回响被动** (每3次施法自动附加 ECHO 修饰符)
- [x] **布鲁斯暴击被动** (不和谐度 → 暴击率转化，暴击伤害2x)
- [x] **与 SpellcraftSystem 完整集成** (音符可用性检查、伤害倍率、被动效果)
- [x] **与 GameManager 完整集成** (start_game/reset_game 时应用/重置调式)
- [x] **信号系统** (mode_changed, crit_from_dissonance)

### 待完成 🔲

- [ ] 更多调式/职业解锁 (如利底亚、混合利底亚)
- [ ] 调式专属的序列器预设
- [ ] 调式选择界面的视觉增强

---

## 音乐理论引擎 (MusicTheoryEngine)

### 已完成 ✅

- [x] 和弦识别 (支持所有15种和弦类型)
- [x] 和弦功能判定 (T/PD/D 三功能)
- [x] 和弦进行分析 (D→T/T→D/PD→D)
- [x] 完整度计算 (2-4和弦连续有效转换)
- [x] 不和谐度计算 (和弦级别 + 音程级别)
- [x] 扩展和弦检测
- [x] 历史清除接口

### 待完成 🔲

- [ ] 调性感知：根据当前调式动态调整和弦功能判定
- [ ] 更精确的和弦转位识别

---

## 弹体系统 (ProjectileManager)

### 已完成 ✅

- [x] MultiMesh 批量渲染 (最大500弹体)
- [x] 对象池管理
- [x] 5种修饰符效果 (穿透/追踪/分裂/回响/散射)
- [x] 和弦弹体 (强化弹体/DOT弹体/爆炸弹体/冲击波/蓄力弹体)
- [x] 连射 (EVEN_EIGHTH) 多弹体发射
- [x] 三连发 (TRIPLET) 扇形弹体
- [x] **密度过载精准度惩罚** (弹体方向随机偏移) — *v2.0*
- [x] 弹体发光 Shader (projectile_glow.gdshader)
- [x] 空间哈希碰撞优化 (SpatialHash)
- [x] **摇摆弹道 (SWING) S型正弦轨迹** — *v3.0 新增*
  - 正弦波垂直偏移 (振幅20px, 频率3Hz)
  - 弹体存活时间内持续摇摆
- [x] **弹体拖尾效果 (Trail)** — *v3.0 新增*
  - 摇摆弹体：8帧拖尾历史
  - 普通弹体：4帧短拖尾
  - 渐变透明度渲染
- [x] **法阵/区域 (FIELD) 弹体形态** — *v5.0 新增*
  - 减速光环 + 旋转视觉 + 入场缩放动画
  - 持续伤害 + 敌人减速效果
  - 脉冲呼吸视觉反馈
- [x] **天降打击 (DIVINE_STRIKE) 弹体形态** — *v5.0 新增*
  - 预警标记 + 高空下落动画
  - 着陆爆炸 + 屏幕震动
  - 拖尾光效
- [x] **护盾/治疗 (SHIELD_HEAL) 弹体形态** — *v5.0 新增*
  - 跟随玩家的护盾气泡
  - 护盾HP吸收伤害
  - 持续治疗 (减少疲劳)
- [x] **召唤/构造 (SUMMON) 弹体形态** — *v5.0 新增*
  - 跟随玩家的自动攻击构造体
  - 自动寻敌 + 发射子弹体
  - 最大攻击次数限制
- [x] **扩展和弦法术的6种弹体形态** — *v5.0 新增*
  - 风暴区域 (STORM_FIELD): 大范围持续伤害场
  - 圣光领域 (HOLY_DOMAIN): 治疗+伤害双重法阵
  - 湮灭射线 (ANNIHILATION_RAY): 光束效果 + 穿透伤害
  - 时空裂隙 (TIME_RIFT): 减速场 + 时间扭曲视觉
  - 交响风暴 (SYMPHONY_STORM): 螺旋弹道 + 多波次攻击
  - 终焉乐章 (FINALE): 蓄力 + 全屏扩展冲击波

### 待完成 🔲

- *(弹体系统所有核心功能已完成)*

---

## 敌人系统 (EnemySpawner)

### 已完成 ✅

- [x] 基础敌人框架 (enemy_base.gd)
- [x] Static (静态噪音) — 直线追踪 + 群体加速
- [x] Pulse (脉冲干扰) — 节拍同步冲刺 + 蓄力释放
- [x] Screech (尖啸反馈) — 远程攻击 + 冲刺 + 死亡不和谐爆发
- [x] Silence (寂静吞噬) — 注入疲劳 + 静音光环
- [x] Wall (音墙) — 高血量屏障 + 护盾 + 地震冲击波
- [x] 波次生成系统 (5种波次类型)
- [x] 精英敌人 (HP+50%, 伤害+30%, 金色标记)
- [x] 经验值掉落 + 死亡特效 + 敌人 Shader

### 待完成 🔲

- [ ] 更多敌人变体 (如 Echo 回声敌人、Feedback 反馈敌人)
- [ ] 敌人属性随时间/BPM 动态缩放
- [ ] 敌人与疲劳系统的更深交互

---

## Boss 系统

### 已完成 ✅

- [x] Boss 基类框架 (boss_base.gd)
- [x] Boss 生成器 (boss_spawner.gd)
- [x] Boss 血条 UI (boss_health_bar.gd)

### 已归档 📦

- 失谐指挥家 (Dissonance Conductor) → `Archive/Boss_Dissonance_Conductor/`
- Max_Issues_Implementation_Report.md → `Archive/`

### 已完成 ✅

- [x] **Boss 1-7 核心逻辑实现** — *v4.0 补全*
  - Pythagoras (律动尊者): 克拉尼图形 + 频率脉冲
  - Guido (圣咏宗师): 四线谱战场 + 唱名弹幕
  - Bach (大构建师): 赋格引擎 + 多声部模仿
  - Mozart (古典完形): 奏鸣曲式阶段 + 优雅反击
  - Beethoven (狂想者): 命运动机 + 动态力度系统
  - Jazz (切分行者): 摇摆力场 + Call & Response
  - Noise (合成主脑): 波形战争 + 单一诅咒
- [x] **Boss 战斗阶段系统** (三阶段/四阶段切换逻辑) — *v4.0 补全*
- [x] **Boss 专属机制** (克拉尼图形、四线谱、赋格引擎等) — *v4.0 补全*

### 待完成 🔲

- [ ] Boss 战前/战后叙事对话
- [ ] Boss 专属的 BGM 资源文件 (.ogg)
- [ ] 各章节 Boss 专属的场景环境装饰视觉效果

---

## 视觉与 Shader

### 已完成 ✅

- [x] 疲劳滤镜 Shader (fatigue_filter.gdshader)
- [x] 弹体发光 Shader (projectile_glow.gdshader)
- [x] 脉冲网格 Shader (pulsing_grid.gdshader)
- [x] 事件视界 Shader (event_horizon.gdshader)
- [x] 敌人故障 Shader (enemy_glitch.gdshader)
- [x] 寂静光环 Shader (silence_aura.gdshader)
- [x] **疲劳滤镜接入 HUD** (fatigue_level + beat_pulse + dissonance_level) — *v2.0*
- [x] **单音寂静视觉反馈** (被禁用音符UI灰化 + 红色闪烁 + 屏幕微震) — *v3.0 新增*
- [x] **密度过载视觉反馈** (屏幕顶部闪烁警告文字) — *v3.0 新增*
- [x] **和弦进行解决视觉反馈** (提示文字 + 颜色脉冲动画) — *v3.0 新增*
- [x] **留白清洗视觉反馈** (青色脉冲 + 滤镜短暂变亮) — *v3.0 新增*
- [x] 玩家视觉增强 + 地面网格 + 事件视界
- [x] **UI扫光Shader** (scanline_glow.gdshader) — 周期性斜向扫光效果 — *v4.0 新增*
- [x] **流动能量Shader** (flowing_energy.gdshader) — Boss血条能量流动效果 — *v4.0 新增*
- [x] **和弦进行冲击波Shader** (progression_shockwave.gdshader) — 全屏冲击波VFX — *v4.0 新增*
- [x] **调式切换边框Shader** (mode_border.gdshader) — 调式专属风格化屏幕边框 — *v4.0 新增*
- [x] **比特破碎Shader** (bitcrush.gdshader) — 第七章降采样/色彩量化/数据损坏效果 — *v4.0 新增*
- [x] **敌人死亡音符粒子** — 死亡时分解为音符形状粒子 — *v4.0 新增*
- [x] **Boss多阶段崩坏特效** — 闪烁→粒子波→最终爆发→淡出 — *v4.0 新增*
- [x] **和弦法术视觉效果** — 法阵光环、全屏冲击波、穿透震荡波反馈 — *v4.0 新增*
- [x] **固化静默Shader** (crystallized_silence.gdshader) — 水晶化/石化障碍物视觉效果 — *v5.0 新增*
  - Voronoi裂纹图案 + 能量脉络流动
  - 边缘冰蓝辉光 + 棱面高光
  - 冻结进度动画 (渐进石化/恢复)
- [x] **Boss血条容器纹理Shader** (boss_hp_bar.gdshader) — 各章节Boss专属血条视觉 — *v5.0 新增*
  - 毕达哥拉斯: 旋转几何图案 (金色+白色)
  - 圭多: 五线谱纹理 (羊皮纸色+圣光)
  - 巴赫: 交织对位线条 (深蓝+银色)
  - 莫扎特: 华丽装饰纹样 (金色+象牙白)
  - 贝多芬: 雷电裂纹 (深红+暗金)
  - 低血量危险脉冲 + 受击闪白 + 阶段转换波纹
- [x] **受击反馈Shader** (hit_feedback.gdshader) — 玩家受击屏幕效果 — *v5.0 新增*
  - 方向性色差偏移 (模拟抖动)
  - 边缘红色渐变暗角 (方向性)
  - 低血量持续红色脉冲 + 心跳效果
  - 受击白色闪光
- [x] **固化静默障碍物组件** (crystallized_obstacle.gd) — *v5.0 新增*
  - 渐进石化/恢复动画
  - 状态机 (NORMAL/CRYSTALLIZING/CRYSTALLIZED/DECRYSTALLIZING)
- [x] **Boss血条UI组件** (boss_hp_bar_ui.gd) — *v5.0 新增*
  - 章节自动切换血条纹理风格
  - 受击闪白 + 阶段转换动画
  - Boss名称/阶段名称/HP数值显示
- [x] **受击反馈管理器** (hit_feedback_manager.gd) — *v5.0 新增*
  - Camera2D屏幕抖动 + Shader暗角联动
  - 低血量持续红色脉冲
  - Hitstop顿帧效果 (轻击0.05s / 重击0.1s)
  - 自动连接 player_damaged / player_hp_changed 信号

### 待完成 🔲

- *(视觉/Shader系统所有核心功能已完成)*

---

## UI 系统

### 已完成 ✅

- [x] HUD 主界面 (hud.gd) — 血条/疲劳度/BPM/时间/等级
- [x] 疲劳仪表 (fatigue_meter.gd)
- [x] 伤害数字系统 (damage_number.gd + damage_number_manager.gd)
- [x] 弹药环 HUD / 序列器 UI / 升级面板 / 暂停菜单 / 设置菜单
- [x] 局结算界面 / 和谐殿堂 UI / 性能监控
- [x] 恢复建议文字显示 (带淡出动画)
- [x] **手动施法槽冷却 UI** (覆盖层从上到下缩小表示冷却进度) — *v3.0 新增*
- [x] **单音寂静灰化指示** (7个白键对应的灰化/红色闪烁标记) — *v3.0 新增*
- [x] **密度过载警告指示器** (屏幕顶部橙红色闪烁文字) — *v3.0 新增*
- [x] **和弦进行效果提示** (D→T/T→D/PD→D + 效果描述 + chain计数) — *v3.0 新增*
- [x] **调式信息显示** (调式名称 + 副标题 + 可用键位) — *v3.0 新增*
- [x] **布鲁斯暴击率显示** (仅布鲁斯调式可见) — *v3.0 新增*
- [x] **留白清洗提示** (青色脉冲文字 + 音效 + 滤镜变亮) — *v3.0 新增*
- [x] **全局UI色彩规范** (ui_colors.gd) — 统一调色板单一事实来源 — *v4.0 新增*
- [x] **UI动画辅助工具** (ui_animation_helper.gd) — 按钮交互增强/面板入场/节拍脉动/故障闪烁 — *v4.0 新增*
- [x] **全局VFX管理器** (vfx_manager.gd) — 冲击波/调式边框/全屏闪光/Boss阶段转换 — *v4.0 新增*
- [x] **Boss血条主题化** — 流动能量Shader + 专属容器纹理 + 阶段转换动画 — *v4.0 新增*
- [x] **主菜单优化** — 统一调色板 + 入场动画 + VBoxContainer布局 — *v4.0 新增*
- [x] **和谐殿堂重构** — "神圣音乐工作站"布局 + 机架模块化标签页 — *v4.0 新增*
- [x] **谐振法典重构** — "魔法书"视觉风格 + 翻页动画 + 星图纹理背景 — *v4.0 新增*
- [x] **结算界面增强** — 统一调色板 + 评价等级差异化背景特效 (S级金/D级红) — *v4.0 新增*
- [x] **游戏结束界面统一调色板** — 应用全局色彩规范 — *v4.0 新增*
- [x] **升级面板增强** — 稀有度颜色视觉区分 (普通/稀有/史诗/传说) — *v4.0 新增*
- [x] **音色切换 UI** (timbre_wheel_ui.gd) — 轮盘式选择界面 — *v4.0 新增*
- [x] **序列器拖拽编辑增强** — *v5.0 新增*
  - Shift+点击多选 + 框选
  - Ctrl+C/V 复制粘贴
  - Ctrl+Z/Y 撤销重做 (最多20步)
  - Ctrl+A 全选 / Delete 删除选中
  - 多选视觉高亮反馈
- [x] **和谐殿堂详细交互** — *v5.0 新增*
  - 乐器调优机架：旋钮/推子交互 + 实时数值显示
  - 乐理研习机架：技能树网格 + 解锁动画
  - 声学降噪机架：抗性升级条 + 当前等级显示
  - 调式选择机架：调式卡片 + 详细信息 + 选中高亮
  - 共鸣碎片余额显示 + 购买确认
- [x] **谐振法典完整数据填充** — *v5.0 新增*
  - 全4卷数据条目 (音符/和弦/敌人/Boss)
  - 搜索过滤功能
  - 条目详情页 (描述/属性/策略)
  - 卷标签切换 + 条目列表 + 详情面板三栏布局

### 待完成 🔲

- *(UI系统所有核心功能已完成)*

---

## 音频系统

### 已完成 ✅

- [x] 音符合成器 (note_synthesizer.gd) — 12半音实时合成
- [x] ADSR 包络 + 5种音色系别 + 泛音结构
- [x] 全局音乐管理器 / BGM 管理器 / 音效管理器
- [x] 频谱分析接入 + 音频总线布局
- [x] **单音寂静音效** (低沉下行音 + 消音) — *v3.0 新增*
- [x] **密度过载音效** (电流干扰 + 警告嵼嵼声) — *v3.0 新增*
- [x] **暴击音效** (布鲁斯调式专用：明亮金属撞击 + 上行音阶) — *v3.0 新增*
- [x] **留白清洗音效** (柔和"叮"声 + 上行纯音) — *v3.0 新增*
- [x] **信号自动连接** (spell_blocked_by_silence → 寂静音效, accuracy_penalized → 过载音效, is_crit → 暴击音效) — *v3.0 新增*
- [x] **和弦音效系统** — *v5.0 新增*
  - 多音符同时播放 (和弦构成音同时发声)
  - 和弦根音低八度强化
  - 法术形态专属音效修饰 (FIELD低频嗡鸣/DIVINE_STRIKE下行滑音/SHIELD_HEAL上行琶音/SUMMON节奏脉冲)
  - 扩展和弦额外泛音层
- [x] **BGM疲劳动态混音** — *v5.0 新增*
  - 疲劳等级驱动的5级混音状态
  - 低通滤波器频率随疲劳降低 (20500Hz → 800Hz)
  - 音量衰减 + 失真效果
  - CRITICAL级别触发心跳低频脉冲
  - 平滑过渡 (1.5秒渐变)
- [x] **BGM音频文件占位目录** — *v5.0 新增*
  - audio/bgm/ 目录结构 + 命名规范文档
  - audio/samples/ 目录结构 + 命名规范文档
  - 外部BGM加载播放接口

### 待完成 🔲

- [ ] 实际 BGM 音频文件制作/采购 (.ogg)

---

## 局外成长 (SaveManager)

### 已完成 ✅

- [x] 共鸣碎片货币系统
- [x] 乐器调优 / 乐理研习 / 声学降噪
- [x] 调式/职业选择 (4种)
- [x] **调式选择对游戏玩法的实际影响** (通过 ModeSystem 实现) — *v3.0 完善*
- [x] 局结算奖励 / 存档持久化 / 局外加成应用
- [x] **和谐殿堂 UI 的完整交互流程** — *v5.0 完成*

### 待完成 🔲

- [ ] 更多调式/职业解锁
- [ ] 成就系统

---

## 游戏流程

### 已完成 ✅

- [x] 主菜单 → 游戏 → 结算 完整流程
- [x] 游戏开始 — 重置状态 + 应用局外加成 + **应用调式系统** — *v3.0 完善*
- [x] 游戏暂停/恢复 / 游戏结束 / 重试/返回菜单
- [x] **游戏重置** — 重置所有子系统 (含 ModeSystem) — *v3.0 完善*
- [x] 竞技场边界限制 / 碰撞检测 / 玩家无敌帧 / 闪避机制
- [x] **不和谐伤害连接** — *v2.0*
- [x] **碰撞层配置文档** (collision_layers.md) — *v3.0 新增*

### 待完成 🔲

- [ ] 新手引导/教程关卡
- [ ] 难度选择
- [ ] 每局随机事件/变异器
- [ ] 计时里程碑 (5分钟/10分钟/15分钟 Boss 出现)

---

## 性能优化

### 已完成 ✅

- [x] MultiMesh 弹体批量渲染
- [x] 对象池 (弹体、伤害数字、死亡特效碎片、音效播放器)
- [x] 空间哈希碰撞优化 / 碰撞检测频率控制
- [x] 音效冷却系统

### 待完成 🔲

- [ ] 大量敌人时的性能测试与优化
- [ ] 敌人对象池
- [ ] MultiMesh 高负载验证 (2000+弹体)

---

## 待设计/待讨论

- [ ] 多人合奏模式
- [ ] 排行榜系统
- [ ] Steam 成就集成
- [ ] 自定义序列器预设保存/分享
- [ ] 回放系统 (记录每局的"乐谱")
- [x] ~~障碍物系统 ("固化静默" 黑色玄武岩柱体)~~ — *v5.0 Shader+组件已完成*

---

## 文件变更日志

### 2026-02-08 v5.0 音频/弹体/UI/Shader 全面完善

**新增文件：**

| 文件 | 说明 |
|------|------|
| `shaders/crystallized_silence.gdshader` | 固化静默Shader — Voronoi裂纹+能量脉络+冰蓝辉光+冻结动画 |
| `shaders/boss_hp_bar.gdshader` | Boss血条容器纹理Shader — 5章节专属视觉风格 |
| `shaders/hit_feedback.gdshader` | 受击反馈Shader — 屏幕抖动+红色暗角+低血量脉冲 |
| `scripts/ui/boss_hp_bar_ui.gd` | Boss血条UI组件 — 章节纹理+受击闪白+阶段转换 |
| `scripts/systems/hit_feedback_manager.gd` | 受击反馈管理器 — 屏幕抖动+暗角+Hitstop |
| `scripts/systems/crystallized_obstacle.gd` | 固化静默障碍物组件 — 渐进石化/恢复动画 |
| `audio/bgm/README.md` | BGM音频文件命名规范与占位说明 |
| `audio/samples/README.md` | 音效采样文件命名规范与占位说明 |

**修改文件：**

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| `scripts/systems/projectile_manager.gd` | 大幅增强 | FIELD/DIVINE_STRIKE/SHIELD_HEAL/SUMMON完整实现 + 6种扩展和弦弹体 |
| `scripts/autoload/audio_manager.gd` | 编辑 | 和弦音效多音符同时播放 + 法术形态专属音效修饰 |
| `scripts/autoload/bgm_manager.gd` | 编辑 | 疲劳等级驱动的5级动态混音 + 外部BGM加载接口 |
| `scripts/ui/sequencer_ui.gd` | 编辑 | 多选拖拽 + 复制粘贴 + 撤销重做 + 快捷键 |
| `scripts/ui/hall_of_harmony.gd` | 重写 | 完整机架模块交互：旋钮/推子/技能树/调式卡片 |
| `scripts/ui/codex_ui.gd` | 重写 | 三栏布局 + 搜索 + 全4卷数据 + 条目详情页 |

### 2026-02-08 v4.0 UI与美术风格优化

**新增文件：**

| 文件 | 说明 |
|------|------|
| `scripts/autoload/ui_colors.gd` | 全局UI色彩规范 — 统一调色板单一事实来源 |
| `scripts/ui/ui_animation_helper.gd` | UI动画辅助工具 — 按钮交互增强/面板入场/节拍脉动/故障闪烁 |
| `scripts/systems/vfx_manager.gd` | 全局VFX管理器 — 冲击波/调式边框/全屏闪光/Boss阶段转换 |
| `shaders/scanline_glow.gdshader` | UI扫光Shader — 周期性斜向扫光效果 |
| `shaders/flowing_energy.gdshader` | 流动能量Shader — Boss血条能量流动效果 |
| `shaders/progression_shockwave.gdshader` | 和弦进行冲击波Shader — 全屏冲击波VFX |
| `shaders/mode_border.gdshader` | 调式切换边框Shader — 调式专属风格化屏幕边框 |
| `shaders/bitcrush.gdshader` | 比特破碎Shader — 第七章降采样/色彩量化/数据损坏效果 |
| `themes/GlobalTheme.tres` | 全局UI主题资源文件 (占位) |
| `Docs/UI_Art_Style_Enhancement_Proposal.md` | UI与美术风格优化提案文档 |

**修改文件：**

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| `scripts/ui/boss_health_bar.gd` | 重写 | 主题化Boss血条：流动能量Shader + 专属容器纹理 + 阶段转换动画 |
| `scripts/ui/codex_ui.gd` | 重写 | "魔法书"视觉风格：星图纹理背景 + 翻页动画 + 统一调色板 |
| `scripts/ui/hall_of_harmony.gd` | 重写 | "神圣音乐工作站"布局：机架模块化标签页 + 统一调色板 |
| `scripts/ui/run_results_screen.gd` | 编辑 | 应用全局色彩规范 |
| `scripts/scenes/game_over.gd` | 编辑 | 应用全局色彩规范 |
| `scripts/scenes/main_menu.gd` | 重写 | 统一调色板 + 入场动画 + VBoxContainer布局 |
| `scripts/systems/death_vfx_manager.gd` | 编辑 | 音符粒子死亡特效 + Boss多阶段崩坏特效 |

### 2026-02-08 v3.0 系统完善（排除敌人/Boss）

**新增文件：**

| 文件 | 说明 |
|------|------|
| `scripts/autoload/mode_system.gd` | 调式系统 — 4种调式定义、可用音符限制、伤害倍率、被动效果 |
| `collision_layers.md` | 碰撞层配置文档 — 8层碰撞矩阵定义 |

**修改文件：**

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| `scripts/autoload/spellcraft_system.gd` | 编辑 | 集成调式系统（音符可用性、伤害倍率、被动效果）+ 留白奖励 |
| `scripts/autoload/fatigue_manager.gd` | 编辑 | 新增留白奖励机制（休止符清洗：减寂静/减疲劳/缓过载） |
| `scripts/autoload/game_manager.gd` | 编辑 | start_game/reset_game 集成 ModeSystem |
| `scripts/autoload/audio_manager.gd` | 编辑 | 新增4种状态音效（寂静/过载/暴击/清洗）+ 信号自动连接 |
| `scripts/ui/hud.gd` | 重写 | 全面完善：冷却UI/寂静灰化/过载警告/进行提示/调式信息/暴击率/留白反馈 |
| `scripts/systems/projectile_manager.gd` | 编辑 | 摇摆弹道S型轨迹 + 弹体拖尾效果 |

### 2026-02-08 v2.0 核心玩法完善

**修改文件：**

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| `scripts/autoload/fatigue_manager.gd` | 重写 | 单音寂静、密度过载、不和谐值连接三维惩罚 |
| `scripts/autoload/spellcraft_system.gd` | 重写 | 黑键双重身份、手动施法、和弦进行效果、节奏型修饰 |
| `scripts/systems/projectile_manager.gd` | 编辑 | 密度过载精准度偏移 |
| `scripts/autoload/game_manager.gd` | 编辑 | reset_game() 重置所有子系统 |
| `scripts/ui/hud.gd` | 编辑 | 疲劳滤镜接入不和谐度视觉参数 |

**归档文件：**

| 文件 | 移至 |
|------|------|
| `scripts/entities/enemies/boss_dissonance_conductor.gd` | `Archive/Boss_Dissonance_Conductor/` |
| `Max_Issues_Implementation_Report.md` | `Archive/` |

### 2026-02-07 v1.0 初始实现

- 音频系统全面完成 (AudioManager + BGMManager + NoteSynthesizer + 音色系统)
- 敌人系统全面完成 (5种敌人 + 场景模板 + AI行为 + 死亡特效)
- 视觉系统基础完成 (4种Shader + 玩家视觉增强)
- UI系统基础完成 (HUD + 序列器 + 升级面板)
- 局外成长系统完成 (SaveManager + 和谐殿堂)
