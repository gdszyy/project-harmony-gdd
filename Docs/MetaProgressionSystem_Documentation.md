# Project Harmony：局外成长系统设计文档：和谐殿堂

**版本:** 1.1
**最后更新:** 2026-02-11
**状态:** 设计稿
**作者：** Manus AI (根据 gdszyy 的设计方案整理)

---

## 1. 核心概念与包装

为了补全游戏的核心循环，我们设计了一套**局外（Meta-Progression/Out-of-Game）**的永久成长系统。这套系统旨在扩展玩家“编曲”的可能性，而非简单的数值堆砌，并紧扣“音乐创作”与“魔法”的主题。

- **场景包装**：**“和谐殿堂” (The Hall of Harmony)**。这是玩家在两轮战斗之间休息、沉淀与成长的地方，其视觉风格类似于一间古典音乐学院的休息室或一位指挥家的私人书房。
- **核心货币**：**“共鸣碎片” (Resonance Fragments)**。
    - **来源**：在局内战斗中击败精英或首领敌人、以高评价（如高“和谐度”或乐章“完整度”）完成关卡时获得。
    - **用途**：在“和谐殿堂”中解锁和升级永久性的能力。

---

## 2. 四大成长模块

局外成长系统被划分为四个核心模块，分别对应音乐创作的不同维度：**乐器（基础属性）**、**乐理（机制解锁）**、**曲库（职业/流派）** 和 **声学（系统优化）**。这种设计旨在为玩家提供既有深度又有广度的成长路径。

### 模块 A：乐器调优 (Instrument Tuning) — 基础属性成长

此模块对应传统Roguelike游戏中的“属性强化”，旨在直接提升玩家开始每一局游戏时的基准状态，从而降低游戏早期的生存压力，使玩家能更快地进入核心玩法循环。

| 升级项目 | 音乐化包装 | 效果描述 | 关联机制 |
| :--- | :--- | :--- | :--- |
| **舞台定力** | Stage Presence | 提升初始最大生命值 (每级 +10) | 生存强化 |
| **基础声压** | Acoustic Pressure | 提升所有法术的基础伤害倍率 (每级 +2%) | 白键音符 DMG |
| **节拍敏锐度** | Rhythmic Sense | 略微放宽“完美”判定的时间窗口 | 节奏同步战斗 |
| **拾音范围** | Pickup Range | 扩大自动吸附掉落物（如经验）的范围 | 通用体验 |
| **起拍速度** | Upbeat Velocity | 提升初始投射物的飞行速度 (每级 +3%) | 白键音符 SPD |

### 模块 B：乐理研习 (Theory Archives) — 复杂性解锁

此模块对应传统Roguelike游戏中的“物品池/技能池扩充”。为了避免新手玩家在游戏初期被过于复杂的乐理机制淹没，高级和弦与特殊的功能将通过此模块逐步解锁，让玩家可以按照自己的节奏深化对游戏系统的理解。

1.  **黑键修饰符进阶**：
    -   **初始状态**：玩家初始仅解锁 C# (穿透) 和 F# (分裂) 两种修饰符。
    -   **解锁项目**：通过消耗“共鸣碎片”购买“半音阶研究笔记”，将 D# (追踪)、G# (回响)、A# (散射) 等更高级的修饰符加入到局内的随机奖励池中。

2.  **和弦图谱扩展**：
    -   **初始状态**：玩家初始仅能构建基础的大三和弦与小三和弦。
    -   **解锁项目：“紧张度理论”** — 解锁 **减三和弦 (冲击波)** 和 **增三和弦 (爆炸)**，使其能够出现在法术池中。
    -   **解锁项目：“七和弦解析”** — 解锁 **属七、大七、小七、减七和弦** 的构建能力。只有解锁后，玩家在局内拼凑出这些和弦组合时才会生成对应的法术，否则将被视为无效组合。

3.  **传说乐章许可**：
    -   **解锁项目**：永久性地、小幅地提升在局内遇到“扩展和弦解锁（九、十一、十三和弦）”这一传说级升级选项的概率。

### 模块 C：调式风格 (Mode Mastery) — 职业/流派系统

此模块对应GDD中提到的角色/职业系统，通过局外解锁和选择，为玩家提供风格迥异的开局预设（Build），极大地丰富了游戏的重玩价值。

| 调式/职业 | 特性描述 | 优劣势分析 |
| :--- | :--- | :--- |
| **伊奥尼亚 (Ionian)** | **[均衡者]** C大调音阶 (CDEFGAB)，初始拥有全套白键。 | **优势**：和谐度高，资源管理容易。<br>**劣势**：爆发力中等。 |
| **多利亚 (Dorian)** | **[民谣诗人]** 侧重小调色彩，初始自带“回响”修饰符效果。 | **优势**：控场能力强，特定音符有加成。<br>**劣势**：单调值累积速度略快。 |
| **五声音阶 (Pentatonic)** | **[东方行者]** 移除 F 和 B 两个音符，仅剩 CDEGA。剩余音符基础伤害 +20%。 | **优势**：极难产生不和谐值，操作简单，单发伤害高。<br>**劣势**：无法构建复杂的七和弦，功能性受限。 |
| **布鲁斯 (Blues)** | **[爵士乐手]** 初始自带降三/降五/降七音，不和谐值可转化为暴击率。 | **优势**：极高的爆发潜力，适合高风险高回报的玩法。<br>**劣势**：生存压力大，对疲劳管理技巧要求极高。 |

### 模块 D：声学降噪 (Acoustic Treatment) — 疲劳系统缓解

此模块针对游戏特色的“三维惩罚模型”（即听感疲劳系统）提供永久性的缓解措施，让玩家在熟悉游戏后能更专注于构建复杂的乐曲，而不过度受制于惩罚机制。

1.  **听觉耐受 (Auditory Tolerance)**：永久性地降低“单调值”的累积速度 (例如 -5% / -10% / -15%)。
2.  **混响消除 (Reverb Damping)**：加快“密度值”过高所带来的负面效果的恢复速度。
3.  **绝对音感 (Perfect Pitch)**：永久性地减少“不和谐值”造成的生命值腐蚀伤害 (例如 每跳-1HP / -2HP)。
4.  **休止符美学 (Rest Aesthetics)**：提升在序列器中编入“休止符”时，其清除负面状态的效率。

---

## 3. UI 实现建议与架构接口

局外升级界面的视觉风格可以设计为一个**“合成器机架” (Synthesizer Rack)** 或 **“乐谱架”**，以强化音乐主题。

-   **树状结构**：“乐理研习”模块可采用类似技能树的结构，在视觉上表现为五线谱，从左到右解锁更高级的乐理知识。
-   **旋钮与推杆**：“乐器调优”模块中的基础属性强化，可以设计为调音台上的推杆或旋钮，玩家投入资源的过程即是“推大音量”的隐喻。

### 架构接口预留

为了在未来实现此系统，需在现有代码架构中预留以下接口：

-   **`MetaProgressionManager` (单例)**：
    -   需要新增一个全局单例脚本，负责读取、保存和管理所有局外升级的解锁状态和等级数据。
    -   它将提供如 `is_chord_unlocked(chord_type)` 或 `get_stat_bonus(stat_name)` 之类的接口，供游戏主逻辑调用。

-   **`PlayerBuild` (扩展)**：
    -   在 `BalanceKit/balance_scorer.py` 的 `PlayerBuild` 类中，需要增加一个 `apply_meta_upgrades(meta_manager)` 方法。
    -   此方法将在每次游戏开始时、应用局内升级之前被调用，用于将“和谐殿堂”中解锁的永久属性加成应用到玩家的初始Build状态上。

-   **`GameManager` (修改)**：
    -   在 Godot 的 `game_manager.gd` 中，初始化 `Player` 实体时，需要先调用 `MetaProgressionManager` 来获取局外加成，并配置玩家的初始属性和可用技能池。

-   **`SpellcraftSystem` (修改)**：
    -   在 Godot 的 `spellcraft_system.gd` 检测和弦组合时，需要增加一个前置判断：`if MetaProgressionManager.is_chord_unlocked(chord_type): ...`，以确认玩家是否已解锁该和弦的构建能力。

---

## 4. 开发优先级建议

1.  **P0 (基础)**：实现 **“乐器调优” (属性加成)**。这是最容易实现且玩家感知最强的部分，只需在 `GameManager` 初始化 `Player` 时读取存档数据并应用属性偏移量。
2.  **P1 (流派)**：实现 **“调式选择” (职业)**。这能极大增加游戏的可重玩价值。需要修改 `MusicTheoryEngine` 的初始化逻辑，根据玩家选择的调式来调整可用的音符池和被动特性。
3.  **P2 (解锁)**：实现 **“乐理研习” (机制解锁)**。这部分涉及对游戏内多个系统的逻辑修改（如法术生成、奖励池刷新等），是功能开发的核心，但对于长线留存至关重要。
4.  **P3 (优化)**：实现 **“声学降噪” (疲劳缓解)**。这部分需要对听感疲劳系统的核心参数进行动态调整，建议在游戏平衡性稳定后再进行微调。
