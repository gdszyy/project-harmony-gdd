# 《Project Harmony》核心机制迭代设计提案

**作者：** Manus AI
**版本：** 1.0
**日期：** 2026年2月9日

---

## 1. 引言

本提案旨在响应用户于2026年2月9日提出的五项核心设计反馈，对《Project Harmony》的游戏机制进行一次系统性的迭代与深化。在对现有 GDD 文档、功能报告及 Godot 项目代码进行全面分析后，我们确认了部分功能的实现状态，并针对需要重大修改的系统，提出了一套全新的、更具主题一致性的设计方案。本提案将作为后续开发与 GDD (Game Design Document) 更新的详细蓝图。

## 2. 现状分析与设计方向

首先，我们对用户提出的五个问题进行了深入分析，并将其与项目当前实现状态进行比对，总结如下：

| 用户反馈 | 核心诉求 | 当前实现状态 | 设计决策 |
| :--- | :--- | :--- | :--- |
| 1. 音符消耗品化 | 将音符从无限工具变为有限资源 | **未实现**。音符当前为永久可用的基础元素。 | **引入“音符经济”**。设计全新的音符库存系统，重塑获取、消耗与回收的闭环。 |
| 2. 音符背包系统 | 移除的音符应返回库存 | **未实现**。当前无库存概念。 | **整合至音符经济**。序列器中的音符为“已装备”状态，移除即“卸下”，返回库存。 |
| 3. 和弦合成机制 | 通过消耗3个以上音符来“合成”和弦 | **部分冲突**。当前通过UI选择音符识别和弦，不消耗。 | **重构为“和弦炼成”**。设计专门的和弦合成界面，永久消耗音符以创造可重复使用的“和弦法术”。 |
| 4. 手动施法绑定 | 快捷键绑定手动法术槽 | ✅ **已实现**。`1`, `2`, `3` 键已绑定至手动施法槽。 | **补充缺失环节**。设计用于**配置**手动施法槽内容的UI交互界面。 |
| 5. 升级选择形式 | 构思比“三选一卡片”更适合主题的形式 | ✅ **已实现**。标准的三选一卡片升级系统已在 `upgrade_panel.gd` 中完成。 | **主题化重构**。设计全新的“五度圈罗盘”升级系统，将选择过程与音乐理论深度绑定。 |

基于以上分析，我们的核心设计目标是：**将游戏从“一个使用音乐元素的战斗系统”转变为“一个以音乐创作逻辑为核心的完整生态”**。下文将详细阐述各个模块的设计方案。

---

## 3. 音符经济系统 (Note Economy System)

为了响应“音符消耗品化”的需求，我们提议引入一个全新的核心系统——**音符经济**。该系统将彻底改变玩家与最基础的法术资源（音符）的交互方式，为游戏增加一层战略性的资源管理维度。

### 3.1. 音符库存 (The Note Inventory)

我们将引入一个名为“音符库存”的系统，作为玩家持有所有可用音符的容器。这在概念上类似于玩家的“箭袋”或“弹药库”。

- **库存形式**：一个可视化的UI界面，展示玩家当前拥有的所有音符。每种音符（C, D, E, F, G, A, B）各自独立堆叠，并显示其数量。
- **初始状态**：游戏开始时，玩家将获得一套基础的音符组合（例如：4个C，3个G，2个E），而非全部音符。
- **获取途径**：
    1.  **升级奖励**：玩家升级时，新的升级系统（详见第6节）将提供“获得一个随机音符”或“获得指定的音符”等选项。
    2.  **敌人掉落**：有较小几率，特定敌人（如精英怪）在死亡时会掉落可拾取的“音符晶片”。

### 3.2. 音符的生命周期：装备、卸下与消耗

音符的“消耗品”属性将通过其生命周期的不同阶段来体现：

- **装备 (Equip)**：当玩家将一个音符从库存拖拽或放置到**法术序列器**或**手动施法槽**中时，该音符即被“装备”。库存中对应音符的数量减一，音符出现在法术槽中。这代表着一种“占位消耗”。
- **卸下 (Unequip)**：当玩家从法术序列器或手动施法槽中移除一个音符时（例如，通过右键点击），该音符将被“卸下”，并安全返回音符库存，对应音符数量加一。
- **永久消耗 (Consume)**：音符只在一种情况下会被永久消耗——**和弦炼成**。当玩家使用多个音符合成一个和弦法术时，这些作为“原材料”的音符将被彻底消耗，无法回收。

这一设计使得玩家在构筑自动序列时需要进行策略规划（我有哪些音符可供配置？），同时让和弦的合成成为一个更具分量的、需要深思熟虑的决策。

---

## 4. 和弦炼成系统 (Chord Alchemy System)

为了匹配音符经济并深化和弦的独特性，我们提议用全新的“和弦炼成”系统取代现有的 `chord_builder_panel.gd` 钢琴键盘选择模式。

### 4.1. “和弦法术”概念

和弦不再是临时识别的组合，而是通过合成创造出的、可重复使用的**“和弦法术”物品**。一旦合成，它就成为一个独立的实体，可以被放置、移除和存储。

### 4.2. 炼成界面

我们设计一个专门的“和弦炼成台”界面，该界面包含：

- **音符槽 (Ingredient Slots)**：3至4个用于放置音符原材料的插槽。
- **合成按钮 (Synthesize Button)**：点击后消耗音符槽中的音符，生成和弦法术。
- **预览区 (Preview Pane)**：实时显示当前音符组合将产生的和弦类型、法术形态及其效果描述。

**交互流程**：
1. 玩家打开炼成台界面。
2. 从音符库存中将3个或以上的音符拖入音符槽。
3. 预览区立即识别并显示结果（例如，“C+E+G → 大三和弦 → 强化弹体”）。
4. 玩家点击“合成”，音符被永久消耗，一个“大三和弦法术”物品被添加到玩家的“法术书”中。

### 4.3. 法术书 (Spellbook)

“法术书”是一个新的UI面板，用于存放所有已合成的“和弦法术”。玩家可以从这里将和弦法术拖拽到序列器或手动施法槽中。如果从槽中移除，和弦法术将返回法术书，而非被销毁。

这一改动将和弦的创造过程仪式化，使其成为一种高价值的投资行为，完美契合了“消耗音符”的核心理念。

---

## 5. 手动施法配置 (Manual Casting Configuration)

经分析，手动施法的按键绑定（`1`, `2`, `3`）与核心触发逻辑 `trigger_manual_cast()` 均已在 `input_setup.gd` 和 `spellcraft_system.gd` 中正确实现。当前缺失的是允许玩家**自由配置**这些槽位内容的UI交互。

我们提议在主HUD（Heads-Up Display）上增加一个简单的交互功能：

- **拖拽配置**：玩家可以直接从**音符库存**（对于单音法术）或**法术书**（对于和弦法术）中，将一个法术图标拖拽到对应的手动施法槽（HUD上显示为1, 2, 3的图标）上，即可完成配置。
- **右键清空**：右键点击一个已配置的手动施法槽，可以将其清空，并将对应的法术（如果是和弦法术）或音符返回其来源地（法术书或音符库存）。

此方案无需复杂的独立界面，直观且高效，能与新引入的库存和法术书系统无缝集成。

---

## 6. “五度圈罗盘”升级系统 (Circle of Fifths Compass)

针对“寻求更具主题性的升级形式”的反馈，我们设计了**“五度圈罗盘”**系统，以取代传统的“三选一卡片”界面 (`upgrade_panel.gd`)。这个新系统将升级选择的过程本身，变成了一次有趣的音乐理论实践。

### 6.1. 设计理念

五度圈是音乐理论中揭示12个调之间关系的基础工具。我们将借用其圆形结构，创造一个罗盘式的升级选择界面。罗盘的指针代表玩家当前的“音乐探索方向”。

### 6.2. 罗盘界面与交互

当玩家升级时，屏幕中央会展开一个“五度圈罗盘”：

- **罗盘结构**：一个包含12个刻度的圆盘，每个刻度对应一个音级（C, G, D, A, E, B, F#, C#, G#, D#, A#, F）。
- **指针**：罗盘中央有一个指针，默认指向音级 C。
- **升级选项**：在罗盘外围，与指针指向的刻度及其相邻的两个刻度（即五度关系和四度关系的音级）相对应的位置，会浮现三个升级选项。例如，当指针指向 C 时，选项会出现在 C、G (C的上方五度) 和 F (C的下方五度/上方四度) 的位置。

**交互流程**：
1. 升级时，罗盘出现，指针指向当前音级（初始为C）。
2. 玩家从 C、G、F 三个方向的升级选项中选择一个。
3. **选择后，指针将旋转到玩家所选选项对应的音级上**。例如，如果玩家选择了 G 方向的升级，下次升级时，指针将指向 G，而新的选项将出现在 G、D (G的上方五度) 和 C (G的下方五度) 的位置。

### 6.3. 升级池与方向的关联

不同方向的升级选项将具有不同的倾向性，鼓励玩家进行长线的战略规划：

- **向上五度 (顺时针，更“明亮”的调)**：此方向的升级将更倾向于出现**进攻性和伤害加成**相关的选项（如“G音符伤害+1”、“强化弹体效果+20%”）。
- **向下五度 (逆时针，更“柔和”的调)**：此方向的升级将更倾向于出现**防御性、功能性或资源获取**相关的选项（如“获得一个随机音符”、“最大生命值+25”）。
- **当前调性**：停留在当前音级方向的升级，将提供对**当前核心音符**的直接强化。

这个系统不仅在视觉上更具音乐感，更将“选择升级”这一行为与音乐理论中的“调性转换”联系起来。玩家的每一次选择都在决定自己乐曲的“走向”，是向着更激昂、更明亮的方向发展，还是转向更沉静、更稳固的根基。这使得升级过程本身充满了叙事感和策略深度。

## 7. 结论与后续步骤

本提案系统地回应了用户的五项反馈，提出了一套环环相扣的全新设计，旨在将《Project Harmony》的核心体验提升到一个新的高度。我们建议下一步的工作重点是：

1.  **原型开发**：优先实现“音符库存”和“五度圈罗盘”的核心逻辑与UI原型，以验证其可行性与趣味性。
2.  **GDD 更新**：将本提案中的设计细节正式整合并更新到项目的主 GDD 及相关子文档中。
3.  **任务拆分**：将上述设计拆分为具体的开发任务，并更新至项目的待办事项清单中。

我们相信，这次迭代将极大地增强游戏的独特性与策略深度，为玩家带来真正“用音乐战斗与创作”的沉浸式体验。
