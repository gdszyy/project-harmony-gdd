# Project Harmony — 音色武器系统设计文档

**版本:** 2.0
**最后更新:** 2026-02-11
**状态:** 设计稿
**作者：** Manus AI
**关联 Issue:** #38 — 音色系统重新设计：章节专属音色武器 + 词条系统 + 电子乐变体

---

## 1. 设计概述

### 1.1. 系统重新定位：音色即武器，章节即流派

在 v1.0 的音色系统中，音色按声学发声原理被划分为四大系别（弹拨/拉弦/吹奏/打击），作为法术系统的"第五维度"存在。然而，这一设计存在以下核心问题：

1. **音色与章节脱节**：四大系别与七大章节的音乐史主题（古希腊→中世纪→巴洛克→古典→浪漫→爵士→电子）没有对应关系，玩家缺乏"章节专属感"。
2. **缺少电子乐音色**：游戏的美术风格是科幻/故障艺术（Glitch Art），BGM 是 Minimal Techno / Glitch Techno，但音色系统中没有任何电子乐相关的音色。
3. **缺少章节专属词条**：当前音色的"神韵效果"是固定的，不随章节变化，缺少类似肉鸽游戏中"章节专属词条/遗物"的机制。
4. **武器感不足**：当前音色更像是"弹体行为修饰器"，缺乏"武器"的直观感受。

v2.0 将音色系统重新定位为**武器系统**，每种音色对应一种"乐器武器"，其攻击方式、视觉风格和特殊效果都与所属章节的音乐时代主题紧密关联。核心理念为：

> **音色即武器，章节即流派。**

### 1.2. 设计原则

**章节绑定。** 每个章节拥有一种专属音色武器，该武器的设计灵感、攻击质感、视觉风格和听觉效果均来源于该章节所代表的音乐时代。玩家进入新章节时自动获得该章节的专属音色武器。

**武器化表达。** 音色不再是抽象的"弹体行为修饰器"，而是具象化的"乐器武器"。每种乐器武器拥有明确的攻击方式和视觉辨识度，玩家能直观地将其理解为一种"武器"。

**词条深度。** 每个章节拥有专属的词条池（3 个词条：普通/稀有/史诗），词条与章节音色武器有协同效果，鼓励玩家在当前章节使用专属武器以最大化收益。

**电子乐变体。** 每种章节音色武器都有一个对应的电子乐变体，保留原音色的核心机制，但将视觉和听觉风格替换为电子乐美学，契合游戏的科幻/故障艺术整体风格。

**ADSR 驱动行为。** 延续 v1.0 的 ADSR 包络设计，每种乐器武器的弹体行为仍由 Attack/Decay/Sustain/Release 参数驱动。

---

## 2. 章节音色武器

### 2.1. 总览

| 章节 | 时代主题 | 专属音色武器 | 攻击质感 | 电子乐变体 |
| :--- | :--- | :--- | :--- | :--- |
| Ch1 数之和谐 | 古希腊 | **里拉琴 (Lyre)** | 纯净的泛音共鸣，基于数学比例的伤害加成 | Sine Wave Synth（纯正弦波合成） |
| Ch2 记谱之光 | 中世纪 | **管风琴 (Organ)** | 持续的和声层叠，多声部叠加攻击 | Drone Synth（持续低频无人机音） |
| Ch3 复调迷宫 | 巴洛克 | **羽管键琴 (Harpsichord)** | 精密的对位攻击，多弹道交织 | Arpeggiator Synth（琶音器合成） |
| Ch4 完美形式 | 古典主义 | **钢琴 (Fortepiano)** | 力度动态控制，强弱拍伤害差异化 | Velocity Pad（力度感应垫） |
| Ch5 命运之力 | 浪漫主义 | **管弦全奏 (Tutti)** | 情感爆发式攻击，渐强渐弱的伤害曲线 | Supersaw Synth（超级锯齿波） |
| Ch6 切分行者 | 爵士 | **萨克斯 (Saxophone)** | 摇摆节奏攻击，反拍强化 | FM Synth（FM 合成器） |
| Ch7 数字虚空 | 现代/电子 | **合成主脑 (Synthesizer)** | 波形变换攻击，频率操控 | Bitcrusher / Glitch Engine |

### 2.2. Ch1 — 里拉琴 (Lyre)

> **核心机制 [泛音共鸣 / Harmonic Resonance]**：弹体基于数学比例产生伤害加成。弹体飞行距离与基础距离的比值越接近简单整数比（如 2:1、3:2、4:3），伤害加成越高。弹体命中时释放纯净的泛音波纹，对周围半径 60px 内的敌人造成基础伤害 15% 的共鸣伤害。

**攻击质感**：弹体呈现为金色的弦振波形，飞行时留下数学螺旋线拖尾。命中时产生同心圆泛音波纹扩散效果。

**ADSR 参数**：Attack 0.08s, Decay 0.2s, Sustain 60%, Release 0.15s

**和弦交互**：使用里拉琴施放**区域型 (Field / 属七和弦)** 法术时，法术区域内的伤害按毕达哥拉斯音程比例分布——区域中心伤害最高，向外按 2:1、3:2、4:3 的比例衰减，形成"天球和谐"的视觉效果。

### 2.3. Ch2 — 管风琴 (Organ)

> **核心机制 [和声层叠 / Harmonic Stacking]**：每次施法会在弹体上叠加一个"声部层"（最多 4 层）。每层声部使弹体的碰撞范围 +10%，伤害 +8%。声部层在 3 秒内未施法时逐层消退。当声部层达到 4 层时，弹体获得"圣咏"状态：命中敌人时产生持续 2 秒的伤害区域。

**攻击质感**：弹体呈现为多层叠加的光环形态，层数越多光环越厚重。命中时产生教堂回响般的扩散效果。

**ADSR 参数**：Attack 0.15s, Decay 0.0s, Sustain 90%, Release 0.4s

**和弦交互**：使用管风琴施放**持续伤害型 (DOT / 小三和弦)** 法术时，DOT 的每一跳都会叠加一层声部，使 DOT 伤害逐跳递增（每跳 +8%，最多 +32%）。

### 2.4. Ch3 — 羽管键琴 (Harpsichord)

> **核心机制 [对位交织 / Counterpoint Weave]**：每发弹体在生成 0.2 秒后，会在其镜像位置（以玩家为对称中心）生成一个"对位弹体"，伤害为原弹体的 50%。对位弹体与原弹体同时命中同一敌人时，触发"对位共鸣"，造成额外 30% 的爆发伤害。

**攻击质感**：弹体呈现为精密的机械齿轮形态，对位弹体为镜像的半透明版本。两者同时命中时产生巴洛克花纹的爆发效果。

**ADSR 参数**：Attack 0.03s, Decay 0.15s, Sustain 45%, Release 0.0s

**和弦交互**：使用羽管键琴施放**爆炸型 (Explosive / 增三和弦)** 法术时，爆炸会产生两次——原始爆炸和 0.2 秒后的对位爆炸，第二次爆炸位于第一次的镜像位置，伤害为 50%。

### 2.5. Ch4 — 钢琴 (Fortepiano)

> **核心机制 [力度动态 / Velocity Dynamics]**：弹体的伤害根据施法时的"力度"动态变化。系统引入一个"力度条"（0%~100%），玩家通过节奏精准度控制力度——完美节拍（±50ms 内）为 forte（强，伤害 x1.5），普通节拍为 mezzo（中，伤害 x1.0），失误节拍为 piano（弱，伤害 x0.7）。强拍上的 forte 弹体额外获得击退效果。

**攻击质感**：弹体呈现为黑白琴键交替的光球，forte 弹体体积更大且带有冲击波纹，piano 弹体体积更小且半透明。

**ADSR 参数**：Attack 0.02s, Decay 0.1s, Sustain 80%, Release 0.08s

**和弦交互**：使用钢琴施放**召唤/构造型 (Summon / 小七和弦)** 法术时，召唤物的攻击也遵循力度动态机制，且召唤物的持续时间延长 20%。

### 2.6. Ch5 — 管弦全奏 (Tutti)

> **核心机制 [情感爆发 / Emotional Crescendo]**：引入"情感强度"计量条（0~100）。持续攻击使情感强度递增（+2/次），受伤使情感强度大幅递增（+15/次），不攻击时情感强度缓慢衰减（-3/秒）。情感强度影响弹体属性：0~30 为 pianissimo（伤害 x0.8，范围 x0.8），30~70 为 forte（伤害 x1.0，范围 x1.0），70~100 为 fortissimo（伤害 x1.5，范围 x1.3）。达到 100 时触发"高潮爆发"：3 秒内所有弹体伤害 x2.0，之后情感强度重置为 0。

**攻击质感**：弹体呈现为多种乐器音符交织的能量团，随情感强度变化颜色从冷蓝渐变到炽红。高潮爆发时全屏产生交响乐视觉效果。

**ADSR 参数**：Attack 0.1s, Decay 0.05s, Sustain 85%, Release 0.2s

**和弦交互**：使用管弦全奏施放**冲击波型 (Shockwave / 减三和弦)** 法术时，冲击波的伤害随情感强度线性增长（最高 +50%），且在 fortissimo 状态下冲击波范围扩大 30%。

### 2.7. Ch6 — 萨克斯 (Saxophone)

> **核心机制 [摇摆攻击 / Swing Attack]**：弹体的发射时机自动偏移至最近的"摇摆拍位"（将标准八分音符的后半拍延迟约 33%）。在反拍（弱拍）上发射的弹体获得"摇摆加成"：伤害 +25%，弹道呈现 S 型曲线。连续 3 次在反拍上施法，触发"即兴独奏"状态（5 秒）：施法速度 +30%，弹体自动追踪最近敌人。

**攻击质感**：弹体呈现为流动的金色音符形态，飞行时带有爵士乐特有的摇摆弧度。即兴独奏期间弹体变为蓝紫色。

**ADSR 参数**：Attack 0.06s, Decay 0.1s, Sustain 70%, Release 0.12s

**和弦交互**：使用萨克斯施放**护盾/治疗型 (Shield/Heal / 大七和弦)** 法术时，护盾在反拍上吸收伤害时会将吸收量的 20% 转化为对最近敌人的反击伤害。

### 2.8. Ch7 — 合成主脑 (Synthesizer)

> **核心机制 [波形变换 / Waveform Morph]**：玩家可在四种基础波形之间切换——正弦波（Sine，高穿透）、方波（Square，高伤害）、锯齿波（Sawtooth，高范围）、三角波（Triangle，高速度）。每种波形赋予弹体不同的属性加成（对应属性 +30%，其他属性 -10%）。切换波形无冷却但有 0.5 秒的"变形过渡"期，过渡期内弹体同时拥有两种波形的 50% 效果。

**攻击质感**：弹体呈现为对应波形的能量脉冲，正弦波为圆润的光球，方波为棱角分明的方块，锯齿波为锐利的三角形，三角波为快速的光点。

**ADSR 参数**：Attack 0.01s, Decay 0.05s, Sustain 75%, Release 0.03s

**和弦交互**：使用合成主脑施放**天降打击型 (Divine Strike / 减七和弦)** 法术时，天降打击的视觉效果变为"数据崩溃"——打击区域内的敌人受到额外的"故障"效果：2 秒内移动变为低帧率（每 0.2 秒更新一次位置）。

---

## 3. 章节专属词条系统

### 3.1. 系统概述

每个章节在进入时，会解锁该章节的**专属词条池**。玩家在升级时有几率从当前章节的词条池中获得专属词条。词条与章节音色武器有协同效果——使用当前章节的专属音色武器时，词条效果增强。

**词条规则**：
- 每个章节有 3 个专属词条（普通 / 稀有 / 史诗各 1 个）
- 词条在升级面板中以 15% 的概率替代普通升级选项出现
- 使用当前章节专属音色武器时，词条效果获得额外的"协同加成"
- 离开章节后已获得的词条效果保留，但不再获得新词条
- 跨章节词条组合可触发隐藏的"音乐史彩蛋"效果

### 3.2. Ch1 — 数之和谐 · 毕达哥拉斯词条

| 词条名 | 稀有度 | 效果 | 与里拉琴的协同 |
| :--- | :--- | :--- | :--- |
| 黄金比例 | 普通 | 弹体飞行距离为黄金比例（约 1.618 倍基础距离）时，伤害 +25% | 里拉琴弹体自动调整飞行距离至黄金比例 |
| 毕达哥拉斯音程 | 稀有 | 同时存在的弹体数量为 2 的幂次时（2/4/8），全体弹体伤害 +15% | 里拉琴的泛音共鸣自动生成 2^n 个衍生弹体 |
| 天球之乐 | 史诗 | 每 30 秒触发一次"天球共鸣"，对全屏敌人造成当前 DPS 50% 的伤害 | 里拉琴使用期间天球共鸣冷却时间 -10s |

### 3.3. Ch2 — 记谱之光 · 圭多词条

| 词条名 | 稀有度 | 效果 | 与管风琴的协同 |
| :--- | :--- | :--- | :--- |
| 四线谱 | 普通 | 弹体飞行轨迹上留下持续 1s 的"谱线"，敌人经过时受到 10% 额外伤害 | 管风琴的持续音自动生成四条平行谱线 |
| 唱名法 | 稀有 | 连续使用不同音符施法（Do-Re-Mi...），每个不同音符 +8% 伤害（最多 +56%） | 管风琴的多声部自动计入不同音符数 |
| 圣咏回响 | 史诗 | 法术命中敌人后，在命中位置生成持续 3s 的"圣咏区域"，区域内敌人受到的所有伤害 +20% | 管风琴的持续音延长圣咏区域至 5s |

### 3.4. Ch3 — 复调迷宫 · 巴赫词条

| 词条名 | 稀有度 | 效果 | 与羽管键琴的协同 |
| :--- | :--- | :--- | :--- |
| 卡农 | 普通 | 每发弹体在 0.3s 后生成一个延迟复制体，沿相同轨迹飞行，伤害为 60% | 羽管键琴的对位弹体也会触发卡农 |
| 赋格主题 | 稀有 | 标记第一个命中的敌人为"主题"，后续弹体命中其他敌人时，"主题"敌人也受到 30% 传导伤害 | 羽管键琴的多弹道使"主题"传导更频繁 |
| 哥德堡变奏 | 史诗 | 每 30 次施法后，下一次施法的效果翻倍（伤害、范围、持续时间均 x2） | 羽管键琴的快速施法加速触发变奏 |

### 3.5. Ch4 — 完美形式 · 莫扎特词条

| 词条名 | 稀有度 | 效果 | 与钢琴的协同 |
| :--- | :--- | :--- | :--- |
| 奏鸣曲式 | 普通 | 战斗分为"呈示-展开-再现"三阶段，每阶段切换时获得 3s 全属性 +15% | 钢琴的力度控制在阶段切换时自动最大化 |
| 完美终止 | 稀有 | 击杀敌人时，若使用的是 V-I（属-主）和弦进行，额外获得 2 倍经验 | 钢琴自动将终止式的力度提升至 fortissimo |
| 莫扎特效应 | 史诗 | 保持 15s 不受伤，获得"灵感"状态：施法速度 +30%，持续 10s | 钢琴在"灵感"状态下解锁隐藏的装饰音弹体 |

### 3.6. Ch5 — 命运之力 · 贝多芬词条

| 词条名 | 稀有度 | 效果 | 与管弦全奏的协同 |
| :--- | :--- | :--- | :--- |
| 命运动机 | 普通 | 每 4 次攻击的第 4 次（da-da-da-DUM）伤害 +40% | 管弦全奏的第 4 拍自动触发全体乐器齐奏 |
| 英雄交响 | 稀有 | 生命值低于 30% 时，攻击力 +50%，移动速度 +20% | 管弦全奏在低血量时自动切换为"暴风雨"模式 |
| 欢乐颂 | 史诗 | 击杀 100 个敌人后触发"欢乐颂"：15s 内所有法术无消耗、无疲劳 | 管弦全奏在欢乐颂期间解锁"合唱终章"超级弹幕 |

### 3.7. Ch6 — 切分行者 · 爵士词条

| 词条名 | 稀有度 | 效果 | 与萨克斯的协同 |
| :--- | :--- | :--- | :--- |
| 蓝调音阶 | 普通 | 使用降音（b3, b5, b7）时，弹体获得"忧郁穿透"：无视 20% 护甲 | 萨克斯的摇摆攻击自动附带蓝调音阶效果 |
| 即兴独奏 | 稀有 | 连续 5s 不重复使用同一音符，触发"即兴独奏"：下一次施法伤害 x3 | 萨克斯在即兴独奏期间攻击速度翻倍 |
| 切分反击 | 史诗 | 在敌人攻击的反拍（弱拍）施法，该法术伤害 +100% 且附带 1s 眩晕 | 萨克斯自动将施法时机偏移至最近的反拍 |

### 3.8. Ch7 — 数字虚空 · 电子词条

| 词条名 | 稀有度 | 效果 | 与合成主脑的协同 |
| :--- | :--- | :--- | :--- |
| 降采样 (Bitcrush) | 普通 | 弹体命中敌人后，敌人的移动变为"低帧率"（每 0.2s 才更新一次位置），持续 2s | 合成主脑的 Bitcrusher 模式使降采样效果范围扩大至 AOE |
| 频率调制 (FM) | 稀有 | 弹体的伤害随飞行时间呈正弦波动（±30%），波峰时命中可触发额外的谐波爆炸 | 合成主脑可调节 FM 的调制频率和深度 |
| 故障溢出 (Glitch Overflow) | 史诗 | 每次击杀敌人有 10% 几率触发"故障溢出"：敌人死亡动画变为数据崩溃效果，对周围敌人造成 200% 伤害 | 合成主脑使故障溢出几率提升至 25% |

---

## 4. 电子乐音色变体系统

### 4.1. 概述

每种章节音色武器都有一个对应的**电子乐变体**，保留原音色的核心机制，但将视觉和听觉风格替换为电子乐美学。电子乐变体的设计契合游戏整体的科幻/故障艺术风格。

### 4.2. 获取方式

1. **局内升级**：稀有级升级选项，将当前章节音色武器切换为电子乐变体
2. **章节完成奖励**：通关某章节后，永久解锁该章节音色的电子乐变体
3. **局外成长**：在"和谐殿堂"中消耗共鸣碎片解锁

### 4.3. 变体详情

| 原音色 | 电子乐变体 | 视觉变化 | 听觉变化 |
| :--- | :--- | :--- | :--- |
| 里拉琴 | Sine Wave Synth | 弹体变为纯净的正弦波形 | 音效变为纯正弦波音 |
| 管风琴 | Drone Synth | 弹体变为低频脉冲波 | 音效变为深沉的无人机音 |
| 羽管键琴 | Arpeggiator Synth | 弹体变为快速闪烁的像素点阵 | 音效变为电子琶音 |
| 钢琴 | Velocity Pad | 弹体变为压力感应的光块 | 音效变为合成垫音 |
| 管弦全奏 | Supersaw Synth | 弹体变为锯齿波形的能量束 | 音效变为厚重的超级锯齿波 |
| 萨克斯 | FM Synth | 弹体变为频率调制的波形 | 音效变为金属质感的 FM 音色 |
| 合成主脑 | Glitch Engine | 弹体变为数据碎片/故障方块 | 音效变为故障噪音 |

### 4.4. 电子乐变体的特殊属性

- 电子乐变体保留原音色的核心机制和 ADSR 参数
- 电子乐变体的疲劳产生量 -50%（电子乐与游戏整体风格更契合）
- 电子乐变体与章节词条的协同效果保持不变
- 电子乐变体在 Ch7（数字虚空）中获得额外 +10% 全属性加成

---

## 5. ADSR 包络数值表

下表列出了每种章节音色武器的 ADSR 参数默认值：

| 乐器武器 | 章节 | Attack (s) | Decay (s) | Sustain (%) | Release (s) |
| :--- | :--- | :---: | :---: | :---: | :---: |
| 里拉琴 (Lyre) | Ch1 | 0.08 | 0.20 | 60% | 0.15 |
| 管风琴 (Organ) | Ch2 | 0.15 | 0.00 | 90% | 0.40 |
| 羽管键琴 (Harpsichord) | Ch3 | 0.03 | 0.15 | 45% | 0.00 |
| 钢琴 (Fortepiano) | Ch4 | 0.02 | 0.10 | 80% | 0.08 |
| 管弦全奏 (Tutti) | Ch5 | 0.10 | 0.05 | 85% | 0.20 |
| 萨克斯 (Saxophone) | Ch6 | 0.06 | 0.10 | 70% | 0.12 |
| 合成主脑 (Synthesizer) | Ch7 | 0.01 | 0.05 | 75% | 0.03 |

> **ADSR 对弹体的具体影响**：在 Attack 阶段，弹体的视觉尺寸和伤害效能从 0 线性增长到 100%（峰值）；在 Decay 阶段，效能从 100% 衰减到 Sustain 百分比；在 Sustain 阶段，效能保持在 Sustain 百分比不变；弹体消失后进入 Release 阶段，残留视觉效果持续 Release 时长，期间仍可造成 Sustain × 50% 的伤害。

---

## 6. 系统整合

### 6.1. 与和弦系统的交互

音色武器对和弦法术的影响已在第 2 节各武器的"和弦交互"中详细描述。总体设计思路是：音色武器不改变和弦法术的基础类型和伤害，而是为其附加额外的行为特征或数值修正。

| 乐器武器 | 受影响的和弦形态 | 交互效果 |
| :--- | :--- | :--- |
| 里拉琴 | 区域型 (属七) | 区域伤害按毕达哥拉斯音程比例分布 |
| 管风琴 | DOT型 (小三) | DOT 每跳叠加声部层，伤害逐跳递增 +8% |
| 羽管键琴 | 爆炸型 (增三) | 产生两次爆炸：原始 + 对位镜像（50% 伤害） |
| 钢琴 | 召唤/构造型 (小七) | 召唤物遵循力度动态，持续时间 +20% |
| 管弦全奏 | 冲击波型 (减三) | 伤害随情感强度增长，fortissimo 范围 +30% |
| 萨克斯 | 护盾/治疗型 (大七) | 反拍吸收伤害的 20% 转化为反击 |
| 合成主脑 | 天降打击型 (减七) | 打击区域附加"故障"效果（低帧率移动） |

### 6.2. 与疲劳系统的交互

音色武器系统与疲劳系统的交互经过重新设计：

**章节专属减免。** 使用**当前章节的专属音色武器**不产生额外疲劳。这鼓励玩家在每个章节中使用对应的专属武器。

**跨章节惩罚。** 使用**其他章节的音色武器**产生 0.03/次 的额外疲劳（低于 v1.0 的 0.05/次切换成本）。这允许玩家跨章节使用武器，但有一定代价。

**电子乐变体减免。** 使用**电子乐变体**的疲劳产生量 -50%。电子乐与游戏整体的科幻/故障艺术风格更契合，因此在疲劳系统中获得优待。

**疲劳对效能的影响。** 延续 v1.0 的设计：中度疲劳（AFI > 0.5）时音色核心机制效能 -20%；严重疲劳（AFI > 0.8）时效能 -50% 且词条协同效果失效。

### 6.3. 与升级系统的交互

章节专属词条作为新的升级池加入 `circle_of_fifths_upgrade.gd`：

- 词条在升级面板中以 15% 的概率替代普通升级选项出现
- 词条与当前章节绑定，离开章节后词条效果保留但不再获得新词条
- 跨章节词条组合可触发隐藏的"音乐史彩蛋"效果

**音乐史彩蛋示例**：

| 组合 | 触发条件 | 效果 |
| :--- | :--- | :--- |
| 古今交响 | 同时持有 Ch1 和 Ch5 的史诗词条 | 天球共鸣和欢乐颂可同时触发 |
| 对位与即兴 | 同时持有 Ch3 和 Ch6 的稀有词条 | 赋格主题的传导伤害可触发即兴独奏 |
| 数字毕达哥拉斯 | 同时持有 Ch1 和 Ch7 的任意词条 | 黄金比例的距离判定精度放宽 20% |

### 6.4. 与局外成长系统的整合

音色武器系统将被整合到"和谐殿堂"的成长体系中：

**模块 B（乐理研习）扩展 — "音色武器图鉴"**：玩家通关每个章节后，自动解锁该章节的音色武器图鉴条目。图鉴中记录了武器的核心机制、ADSR 参数和词条效果。

**电子乐变体解锁**：通关章节后，可在和谐殿堂中消耗共鸣碎片永久解锁该章节音色的电子乐变体。解锁后，该变体在后续所有局中可用。

**音色武器强化**：可以设计专门的局内升级项，用于强化当前激活音色武器的核心机制：

| 升级名称 | 稀有度 | 效果 |
| :--- | :--- | :--- |
| 泛音增幅 | 普通 | 里拉琴共鸣伤害 +10% |
| 声部扩展 | 普通 | 管风琴最大声部层 +1（5 层） |
| 对位精度 | 稀有 | 羽管键琴对位弹体伤害 60% → 70% |
| 力度大师 | 稀有 | 钢琴 forte 伤害倍率 1.5 → 1.8 |
| 情感共鸣 | 稀有 | 管弦全奏情感强度递增速度 +50% |
| 摇摆大师 | 稀有 | 萨克斯反拍伤害加成 25% → 40% |
| 波形融合 | 史诗 | 合成主脑可同时激活两种波形 |

---

## 7. 代码实现方案

### 7.1. 数据结构扩展 — `music_data.gd`

在现有的 `MusicData` 类中重新定义音色系别枚举，从四大声学系别改为七个章节音色武器：

```gdscript
# scripts/data/music_data.gd

## 章节音色武器枚举
enum ChapterTimbre {
    NONE,              # 默认/无音色
    LYRE,              # Ch1 里拉琴
    ORGAN,             # Ch2 管风琴
    HARPSICHORD,       # Ch3 羽管键琴
    FORTEPIANO,        # Ch4 钢琴
    TUTTI,             # Ch5 管弦全奏
    SAXOPHONE,         # Ch6 萨克斯
    SYNTHESIZER,       # Ch7 合成主脑
}

## 电子乐变体枚举
enum ElectronicVariant {
    NONE,
    SINE_WAVE_SYNTH,     # Ch1 正弦波合成
    DRONE_SYNTH,         # Ch2 无人机音合成
    ARPEGGIATOR_SYNTH,   # Ch3 琶音器合成
    VELOCITY_PAD,        # Ch4 力度感应垫
    SUPERSAW_SYNTH,      # Ch5 超级锯齿波
    FM_SYNTH,            # Ch6 FM合成器
    GLITCH_ENGINE,       # Ch7 故障引擎
}

## 章节词条稀有度
enum InscriptionRarity {
    COMMON,    # 普通
    RARE,      # 稀有
    EPIC,      # 史诗
}

## 跨章节音色疲劳代价（使用非当前章节的音色武器时）
const CROSS_CHAPTER_TIMBRE_FATIGUE: float = 0.03

## 电子乐变体疲劳减免倍率
const ELECTRONIC_VARIANT_FATIGUE_MULT: float = 0.5
```

### 7.2. 章节音色武器数据 — `chapter_data.gd`

在 `ChapterData` 中为每个章节添加专属音色武器和词条配置：

```gdscript
# scripts/data/chapter_data.gd

## 章节专属音色武器配置
const CHAPTER_TIMBRES: Dictionary = {
    Chapter.CH1_PYTHAGORAS: {
        "timbre": MusicData.ChapterTimbre.LYRE,
        "name": "里拉琴",
        "name_en": "Lyre",
        "electronic_variant": MusicData.ElectronicVariant.SINE_WAVE_SYNTH,
        "electronic_name": "Sine Wave Synth",
        "adsr": { "attack": 0.08, "decay": 0.20, "sustain": 0.60, "release": 0.15 },
        "core_mechanic": "harmonic_resonance",
        "chord_interaction": MusicData.ChordType.DOMINANT_7,
    },
    # ... (其他章节类似)
}

## 章节专属词条配置
const CHAPTER_INSCRIPTIONS: Dictionary = {
    Chapter.CH1_PYTHAGORAS: [
        {
            "id": "ch1_golden_ratio",
            "name": "黄金比例",
            "rarity": MusicData.InscriptionRarity.COMMON,
            "effect": "弹体飞行距离为黄金比例时，伤害 +25%",
            "synergy": "里拉琴弹体自动调整飞行距离至黄金比例",
            "params": { "distance_ratio": 1.618, "damage_bonus": 0.25 },
        },
        # ... (其他词条)
    ],
    # ... (其他章节)
}
```

### 7.3. 音色武器管理 — `game_manager.gd`

在 GameManager 中管理章节音色武器的获取、切换和词条管理：

```gdscript
# scripts/autoload/game_manager.gd

signal chapter_timbre_changed(new_timbre: int)
signal inscription_acquired(inscription: Dictionary)

var active_chapter_timbre: int = MusicData.ChapterTimbre.NONE
var is_electronic_variant: bool = false
var available_timbres: Array[int] = []
var active_inscriptions: Array[Dictionary] = []
var current_chapter_inscription_pool: Array[Dictionary] = []

## 进入新章节时激活对应音色武器
func activate_chapter_timbre(chapter: int) -> void:
    var config = ChapterData.CHAPTER_TIMBRES.get(chapter, {})
    if config.is_empty():
        return
    active_chapter_timbre = config["timbre"]
    if active_chapter_timbre not in available_timbres:
        available_timbres.append(active_chapter_timbre)
    # 加载章节词条池
    current_chapter_inscription_pool = ChapterData.CHAPTER_INSCRIPTIONS.get(chapter, [])
    chapter_timbre_changed.emit(active_chapter_timbre)

## 切换音色武器
func switch_timbre(timbre: int) -> void:
    if timbre == active_chapter_timbre:
        return
    var current_chapter = ChapterManager.current_chapter
    var chapter_config = ChapterData.CHAPTER_TIMBRES.get(current_chapter, {})
    # 如果切换到非当前章节的音色，产生额外疲劳
    if chapter_config.get("timbre", -1) != timbre:
        FatigueManager.apply_manual_fatigue(MusicData.CROSS_CHAPTER_TIMBRE_FATIGUE)
    active_chapter_timbre = timbre
    chapter_timbre_changed.emit(active_chapter_timbre)

## 获取词条
func acquire_inscription(inscription: Dictionary) -> void:
    active_inscriptions.append(inscription)
    inscription_acquired.emit(inscription)
    _check_music_history_easter_eggs()
```

### 7.4. 章节切换 — `chapter_manager.gd`

在章节切换时激活对应音色武器和词条池：

```gdscript
# scripts/systems/chapter_manager.gd

func _transition_to_chapter(new_chapter: int) -> void:
    # ... (原有的章节切换逻辑)
    
    # 激活章节专属音色武器
    GameManager.activate_chapter_timbre(new_chapter)
    
    # 重置词条池
    GameManager.current_chapter_inscription_pool = \
        ChapterData.CHAPTER_INSCRIPTIONS.get(new_chapter, [])
```

### 7.5. 升级面板 — `upgrade_panel.gd`

在升级面板中加入章节词条选项：

```gdscript
# scripts/ui/upgrade_panel.gd

func _generate_upgrade_options() -> Array:
    var options = _get_base_upgrade_options()
    
    # 15% 概率替换一个选项为章节词条
    if randf() < 0.15 and not GameManager.current_chapter_inscription_pool.is_empty():
        var available = _get_unacquired_inscriptions()
        if not available.is_empty():
            var inscription = available[randi() % available.size()]
            options[randi() % options.size()] = _create_inscription_option(inscription)
    
    return options
```

### 7.6. 音色切换 UI — `timbre_wheel_ui.gd`

重新设计音色切换 UI，按章节分组显示：

```gdscript
# scripts/ui/timbre_wheel_ui.gd

func _build_timbre_list() -> void:
    timbre_list.clear()
    for timbre in GameManager.available_timbres:
        var config = _get_timbre_config(timbre)
        var item = {
            "timbre": timbre,
            "name": config.get("name", "未知"),
            "chapter": config.get("chapter", -1),
            "is_current_chapter": _is_current_chapter_timbre(timbre),
            "has_electronic": _has_electronic_variant(timbre),
        }
        timbre_list.append(item)
```

---

## 8. 玩家策略与 Build 构建

音色武器系统的引入为玩家提供了更丰富的 Build 构建空间。以下是几种典型的策略流派分析：

| 流派名称 | 核心武器 | 核心词条 | 核心和弦 | 策略描述 |
| :--- | :--- | :--- | :--- | :--- |
| **数学精准** | 里拉琴 | 黄金比例 + 毕达哥拉斯音程 | 属七 (区域) | 利用数学比例最大化泛音共鸣伤害 |
| **圣咏压制** | 管风琴 | 圣咏回响 + 唱名法 | 小三 (DOT) | 通过声部叠加和圣咏区域持续压制 |
| **对位大师** | 羽管键琴 | 赋格主题 + 卡农 | 增三 (爆炸) | 利用对位弹体和卡农复制体制造密集弹幕 |
| **力度控制** | 钢琴 | 莫扎特效应 + 奏鸣曲式 | 小七 (召唤) | 精准节拍控制力度，灵感状态下爆发 |
| **情感风暴** | 管弦全奏 | 欢乐颂 + 命运动机 | 减三 (冲击波) | 积累情感强度触发高潮爆发 |
| **摇摆反击** | 萨克斯 | 切分反击 + 即兴独奏 | 大七 (护盾) | 利用反拍机制实现高伤害反击 |
| **波形操控** | 合成主脑 | 故障溢出 + 频率调制 | 减七 (天降打击) | 灵活切换波形，利用故障效果清场 |

---

## 9. 总结与展望

v2.0 的音色武器系统将音色从抽象的"弹体行为修饰器"重新定位为具象化的"章节专属乐器武器"，实现了以下核心目标：

1. **章节绑定**：每个章节拥有独特的音色武器，攻击质感和视觉风格与章节主题深度关联。
2. **词条深度**：21 个章节专属词条（7 章 × 3 个）为玩家提供了丰富的构建选择和跨章节组合可能。
3. **电子乐融合**：7 种电子乐变体将游戏的科幻/故障艺术美学融入核心战斗系统。
4. **武器化表达**：每种乐器武器都有明确的攻击方式和视觉辨识度，玩家能直观地将其理解为"武器"。

未来可以考虑的扩展方向包括：

- **Boss 专属音色**：击败特定 Boss 后获得其专属音色变体，拥有独特的核心机制。
- **音色融合**：允许玩家在特定条件下将两种章节音色武器融合，创造全新的混合武器。
- **赛季限定音色**：随赛季更新引入限定的电子乐变体皮肤，增加收集要素。
