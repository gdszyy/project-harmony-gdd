# Project Harmony：数值设计文档

**作者：** Manus AI
**版本：** 2.0
**日期：** 2026年2月7日

---

## 1. 引言

本文档为 **Project Harmony** 的核心游戏机制提供了一套完整、可量化且支持长线成长的数值设计方案。该方案在v1.0的基础上，根据肉鸽（Roguelite）生存者的游戏模式，重点引入了**数值成长系统**、**扩展和弦体系**，并配套了**自动化平衡性跑分系统**，以确保游戏在长线体验中依然保持平衡、策略深度和可玩性。

设计遵循以下核心原则：

*   **风险与回报的动态平衡**：高风险操作应提供高回报，但惩罚也应随成长而动态调整，避免后期风险过低或过高。
*   **有意义的成长选择**：玩家在肉鸽升级中获得的每个数值提升都应带来清晰、可感知的策略变化，而非简单的线性增强。
*   **策略多样性的持续奖励**：鼓励玩家在游戏的不同阶段探索和组合不同的法术元素，并通过数值设计使其成为比单调策略更优的选择。
*   **可维护与可扩展性**：通过自动化的跑分系统，保证未来新增内容（新音符、新和弦、新升级）时，能够快速验证其对整体平衡性的影响。

---

## 2. 核心数值体系

### 2.1. 基础参数与转换

白键音符的基础弹体由四维参数（伤害DMG, 速度SPD, 持续DUR, 大小SIZE）驱动，其总和恒定为12。这些参数到游戏内实际属性的转换比率保持不变：

| 参数 | 每点对应值 | 设计说明 |
| :--- | :--- | :--- |
| **伤害 (DMG)** | 10 基础伤害 | 决定了弹体的基础伤害值。 |
| **速度 (SPD)** | 200 像素/秒 | 决定了弹体的飞行速度，影响射程和命中率。 |
| **持续 (DUR)** | 0.5 秒 | 决定了弹体在消失前的存活时间。 |
| **大小 (SIZE)** | 8 像素 | 决定了弹体的碰撞半径，影响命中率和覆盖范围。 |

### 2.2. 白键音符基础数值

下表展示了7个白键音符在**无任何成长**下的基础数值。**有效DPS** 是一个综合指标，它估算了在标准施法间隔（BPM=120）下，考虑了命中率因素后的期望秒伤。

> **有效DPS** ≈ (基础伤害 × 命中因子) / 施法间隔
> **命中因子** ≈ min(1.0, (SIZE点数 × SPD点数) / 12.0)

| 音符 | DMG | SPD | DUR | SIZE | 实际伤害 | 速度(px/s) | 存活(s) | 半径(px) | 有效DPS | 覆盖面积(px²) |
| :---: | :-: | :-: | :-: | :-: | :---: | :---: | :---: | :---: | :---: | :---: |
| **C** | 3 | 3 | 3 | 3 | 30 | 600 | 1.5 | 24 | 45.0 | 1810 |
| **D** | 2 | 5 | 3 | 2 | 20 | 1000 | 1.5 | 16 | 33.3 | 804 |
| **E** | 2 | 2 | 4 | 4 | 20 | 400 | 2.0 | 32 | 26.7 | 3217 |
| **F** | 2 | 1 | 5 | 4 | 20 | 200 | 2.5 | 32 | 13.3 | 3217 |
| **G** | 5 | 3 | 2 | 2 | 50 | 600 | 1.0 | 16 | 50.0 | 804 |
| **A** | 4 | 2 | 4 | 2 | 40 | 400 | 2.0 | 16 | 26.7 | 804 |
| **B** | 4 | 4 | 2 | 2 | 40 | 800 | 1.0 | 16 | 53.3 | 804 |

---

## 3. 肉鸽数值成长系统

作为肉鸽游戏，玩家在每次游戏流程中可以通过升级获得各种强化。这些强化分为五大类别，为玩家提供了丰富的Build构建空间。

### 3.1. 升级类别与示例

| 类别 | 设计目标 | 升级示例 | 稀有度 |
| :--- | :--- | :--- | :--- |
| **音符属性强化** | 强化特定音符的四维参数，实现单点突破。 | **伤害增幅**: 选择一个音符，其DMG参数+0.5 | 普通 |
| | | **全维强化**: 选择一个音符，其所有参数+0.25 | 史诗 |
| **疲劳耐受强化** | 降低“单音寂静”系统的负面影响，提升操作容错率。 | **单调耐受**: 单调值累积速率-10% | 稀有 |
| | | **不和谐消散**: 不和谐值自然衰减速率+0.5/秒 | 稀有 |
| **节奏精通** | 强化节奏相关的机制，提供战术多样性。 | **节奏加速**: 基础BPM+5 | 稀有 |
| | | **蓄力精通**: 休止符对其他弹体的DMG/SIZE加成+0.15 | 稀有 |
| **和弦精通** | 强化和弦效果，解锁更强大的和弦。 | **和弦威力**: 所有和弦的伤害倍率+0.1x | 稀有 |
| | | **扩展和弦解锁**: 解锁5音/6音扩展和弦的使用能力 | **传说** |
| **生存强化** | 提升玩家的生存能力。 | **生命强化**: 最大生命值+25 | 普通 |
| | | **闪避本能**: 基础闪避率+3% | 稀有 |

### 3.2. 音符成长与和弦继承

**核心机制**：对单个音符的任何四维参数（DMG/SPD/DUR/SIZE）强化，都会被其参与构成的**和弦法术**所继承。

*   **伤害继承**：和弦法术的基础伤害通常取决于**根音**的伤害值。因此，强化根音的DMG属性会直接提升和弦法术的威力。
*   **功能继承**：和弦法术的功能性参数（如持续时间、范围）取决于**所有构成音**的对应参数的**平均值**或**总和**。例如，一个由高DUR音符组成的“持续区域”法术，其持续时间会更长。

这一设计确保了即使在游戏后期，玩家依然有动力去强化基础音符，因为这些强化能贯穿整个法术系统，持续提供价值。

![音符DPS成长曲线](Reports/growth_curve.png)
*图1：音符DPS成长曲线，展示了对不同音符进行“伤害增幅”升级后的DPS变化。可见，成长曲线基本呈线性，符合预期。*

---

## 4. 扩展和弦体系 (4/5/6音)

为了提供更长线、更有深度的后期游戏体验，我们在原有的3-4音和弦基础上，引入了更复杂的5音和6音和弦。这些**扩展和弦**拥有毁天灭地的威力，但伴随着极高的**不和谐度**和**疲劳代价**，并且需要通过传说级升级项**“扩展和弦解锁”**才能使用。

### 4.1. 扩展和弦列表

| 和弦类型 | 音数 | 不和谐度 | 法术形态 | 伤害倍率 | 疲劳代价 | 特殊效果 |
| :--- | :-: | :-: | :--- | :-: | :-: | :--- |
| **属九和弦** | 5 | 5.00 | 风暴区域 | 0.5x | 0.25 | 区域内敌人减速30% |
| **大九和弦** | 5 | 3.50 | 圣光领域 | 0.0x | 0.15 | 领域内队友持续回血(2/秒) |
| **减九和弦** | 5 | 7.50 | 湮灭射线 | 4.0x | 0.40 | 直线贯穿，无视防御 |
| **属十一和弦** | 5 | 6.00 | 时空裂隙 | 0.6x | 0.30 | 区域内时间减速50% |
| **属十三和弦** | 6 | 7.00 | 交响风暴 | 1.0x | 0.45 | 全屏持续AOE，附加随机元素效果 |
| **减十三和弦** | 6 | 9.50 | **终焉乐章** | **5.0x** | **0.60** | 延迟后全屏毁灭打击，施法者自损20%HP |

### 4.2. 风险-回报分析

扩展和弦的设计严格遵循“高风险高回报”的原则。随着音数的增加，和弦的威力和复杂性呈指数级增长，其不和谐度与疲劳代价也随之飙升。

![和弦不和谐度 vs 伤害倍率](Reports/chord_dissonance_power.png)
*图2：和弦的不和谐度与伤害倍率关系图。红色的扩展和弦（5-6音）普遍位于图表的右上角，体现了其高风险、高回报的特性。*

![扩展和弦惩罚增长曲线](Reports/extended_chord_penalty.png)
*图3：左图显示不和谐度随音数增加而近似指数增长；右图显示疲劳代价也随之急剧增加。这确保了扩展和弦的强大威力被其高昂的风险所平衡。*

---

## 5. 自动化平衡性跑分系统

为了科学、高效地进行平衡性验证，我们开发了一套**平衡性跑分系统**。该系统能够模拟各种法术策略，并从**输出、生存、风险**三个维度进行量化评估，最终给出一个综合得分。

**方法论文档**：[./BalanceKit/Methodology.md](./BalanceKit/Methodology.md)
**跑分系统源码**：[./BalanceKit/balance_scorer.py](./BalanceKit/balance_scorer.py)
**可视化报告生成器**：[./BalanceKit/generate_report.py](./BalanceKit/generate_report.py)

### 5.1. 跑分结果分析

我们对12种预设策略，在“初始”、“中期”、“后期”三个成长阶段分别进行了跑分，结果如下：

![策略综合得分对比](Reports/strategy_comparison.png)
*图4：策略综合得分对比图。红色条为负分（有害策略），黄色为正分（有效策略），绿色为高分（优秀策略）。*

**核心结论**：
1.  **惩罚系统有效**：“纯C/G音符Spam”这类单调策略在所有阶段均为负分，证明了疲劳系统的有效性。
2.  **多样性奖励显著**：包含多样化音符、和弦、休止符的“混合最优策略”和使用高级和弦的策略得分远高于简单策略。
3.  **成长曲线健康**：随着从“初始”到“后期”的成长，所有有效策略的得分均有显著提升，且强力策略（如扩展和弦）的优势愈发明显，符合肉鸽游戏的爽快感预期。

![DPS vs 风险散点图](Reports/dps_vs_risk.png)
*图5：DPS vs 风险散点图。优秀的策略（绿色）集中在左上角的“高DPS、低风险”区域，而糟糕的策略（红色）则集中在右下角的“低DPS、高风险”区域，符合设计预期。*

### 5.2. 平衡性微调建议

从跑分结果看，当前数值体系整体健康。但“后期阶段”的策略得分差距较大（最高分69.7，中位策略仅4.4），可能导致后期最优解过于单一。建议进行以下微调：

*   **增强中期策略**：适当提升部分基础和弦（如增三和弦、小七和弦）的伤害倍率或功能性，使其在后期的成长收益能跟上扩展和弦的步伐。
*   **增加升级多样性**：增加更多针对特定节奏型或非伤害性和弦（如大七和弦）的升级项，为玩家提供更多元的后期Build可能性。

---

## 6. 总结

本次 v2.0 数值设计成功地在 v1.0 的基础上，构建了一套包含**长线成长**和**后期策略深度**的完整体系。新引入的**自动化平衡性跑分系统**被证明是一个强大而高效的决策辅助工具，它不仅验证了当前数值设计的健康度，也为项目未来的迭代和扩展提供了科学的依据和质量保障。
