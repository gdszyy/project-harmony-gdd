# 召唤系统设计文档：幻影声部 (The Phantom Section)

**作者：** Manus AI (集成 gdszyy 的设计方案)
**版本：** 1.0
**日期：** 2026年2月7日

---

## 1. 设计概述

### 1.1. 系统定位：战场上的伴奏声部

在 Project Harmony 的法术体系中，由 **小七和弦 (Minor 7th Chord)** 触发的召唤/构造类法术，其核心设计意象源于其“深沉厚重”的听感，引申为“地面构造” [1]。本系统将此概念深化，摒弃传统游戏中“召唤物是独立战斗单位”的设计，将其重新定义为**“幻影声部” (The Phantom Section)**。

在此框架下，召唤物不再是代替玩家输出的“炮台”或“宠物”，而是作为一种固定的**“伴奏声部” (Accompaniment Section)**存在于战场上。它们严格遵循全局的音乐节拍（BPM），其行为模式与玩家的“主旋律”（白键弹体）形成协奏关系，共同服务于“战斗即创作”的核心设计支柱 [1]。

### 1.2. 设计原则

- **伴奏而非代打**: 召唤物的核心价值在于强化、修饰或改变战场的“音乐环境”，而非直接替代玩家进行战斗。
- **节奏的奴隶**: 所有召唤物的行为（攻击、触发效果）都必须严格对齐到全局的节拍上，特别是强弱拍的区分，使其成为战场上可见的“节拍器”。
- **生命周期基于音乐时长**: 召唤物没有传统的生命值（HP），其存在时间由**“小节数” (Measures)** 定义，时间一到便会如乐曲般“淡出” (Fade out)，这避免了引入复杂的仇恨和伤害计算。
- **空间布局的策略性**: 通过“共鸣网络”机制，鼓励玩家有策略地在战场上布置召唤物的位置，以构建具有协同效应的“杀阵”。

---

## 2. 构造体类型：基于根音 (Root Note)

小七和弦由“根音 + 小三度 + 纯五度 + 小七度”构成。其中，**根音**的音高决定了召唤出的“构造体”的具体类型。我们将构造体分为三大类：**律动塔 (Rhythm)**，负责按节拍直接输出；**共鸣器 (Resonance)**，负责与玩家或其他法术互动以增强效果；以及**干扰场 (Modulation)**，负责控制敌人或改变战场环境。

| 根音 | 构造体名称 | 类型 | 行为模式 (Action on Beat) | 音乐隐喻 |
| :--- | :--- | :--- | :--- | :--- |
| **C** | **节拍哨塔** | 律动塔 | 每拍发射一枚基础弹体，指向最近敌人。 | 稳定的底鼓 (Kick Drum) |
| **D** | **长程棱镜** | 共鸣器 | 不攻击。玩家穿过棱镜射出的弹体，射程翻倍并分裂。 | 延迟/回声效果器 (Delay) |
| **E** | **低频音墙** | 干扰场 | 生成一道阻挡敌人的波形墙，接触的敌人被推开。 | 门限效果器 (Gate) |
| **F** | **净化信标** | 干扰场 | 范围内每小节清除一个敌人的弹幕或Debuff。 | 降噪器 (De-noiser) |
| **G** | **重低音炮** | 律动塔 | 仅在**强拍** (第1拍) 发射高伤冲击波，范围小但伤害高。 | 贝斯/808鼓 (Sub-Bass) |
| **A** | **和声光环** | 共鸣器 | 范围内玩家的疲劳值缓慢恢复。 | 铺底音色 (Pad) |
| **B** | **高频陷阱** | 干扰场 | 地面生成尖刺区域，经过的敌人持续受到高频伤害。 | 踩镲 (Hi-hats) |

---

## 3. 核心机制设计

### 3.1. 强弱拍响应 (Accent System)

所有构造体的行为效能都与其触发时所在的节拍位置（强拍/弱拍）紧密相关，这是实现“节奏感”的关键。

- **强拍 (1/3拍)**: 构造体执行其核心功能，效能为100%。对于特定构造体（如重低音炮），这是其唯一的行动时机。
- **弱拍 (2/4拍)**: 构造体的效能减半（如伤害、范围减至50%），或完全休止。

此设计旨在创造一种可预期的“战场呼吸感”，玩家可以围绕强拍时刻来规划走位和战术配合，例如在强拍时将敌人引至重低音炮的攻击范围。

### 3.2. 共鸣网络 (Resonance Network)

这是召唤系统区别于传统塔防玩法的核心策略深度所在。

- **连线规则**: 当两个**同类型**（律动塔/共鸣器/干扰场）的构造体被放置在彼此的一定距离内（暂定400像素），它们之间会自动生成一条可视的**“音频线缆” (Patch Cable)** 进行连接。
- **连线效果**: 线缆本身会对穿过的敌人造成持续的微量伤害（类似激光栅栏）。更重要的是，所有处于连接状态的构造体都会获得增益效果，例如：
    - **律动塔网络**: 攻击速度 +20%
    - **共鸣器网络**: 效果范围 +25%
    - **干扰场网络**: 效果强度 +30%

该机制鼓励玩家进行有意识的战场布局，通过构建不同的几何阵型（如三角、矩阵）来最大化召唤物网络的整体效能。

### 3.3. 玩家指挥 (Conducting)

为了强化玩家作为“指挥家”的身份，玩家的普通攻击（白键弹体）可以与自己召唤的构造体进行互动。

- **激励 (Excitation) 效果**: 当玩家的弹体击中自己的构造体时，不会造成伤害，而是会“激励”该构造体，使其**立即执行一次额外的、相当于强拍效果的动作**。该次额外动作不计入其正常的节拍攻击计时。
- **反馈**: 触发激励时，会伴有悦耳的“调音”或“和声”音效，为玩家提供正向反馈。

此设计为玩家在战斗的“空窗期”（如等待技能CD或敌人距离较远时）提供了有意义的操作，进一步强化了玩家与召唤物之间的协奏关系。

---

## 4. 与现有系统整合

### 4.1. 与听感疲劳系统 (AFI) 的整合

召唤大量单位可能导致视觉混乱和认知过载，这与听感疲劳系统（AFI）的设计哲学相悖 [2]。为解决此问题，我们引入以下限制：

- **最大复音数 (Max Polyphony)**: 战场上同时存在的构造体数量上限为 **4** 个。此上限可通过局外成长系统（和谐殿堂）解锁，初始为2个。
- **强制淡出**: 当玩家试图在达到上限后召唤新的构造体时，最早被召唤的那个构造体将会被强制“淡出”（立即消失），为新的构造体腾出“编制”。

这一机制在控制视觉噪音的同时，也为玩家带来了“召唤物管理”的策略维度，迫使玩家根据战况更新场上的构造体组合。

### 4.2. 与音色系统 (Timbre) 的深度整合

玩家当前激活的音色 (Timbre) 将为所有召唤物附加一层全局的“行为滤镜”，进一步深化“配器”的概念。以下设计整合并扩展了音色系统文档中的初步构想 [3]。

| 音色系别 | 对召唤物的核心修饰效果 | 音乐意象 |
| :--- | :--- | :--- |
| **弹拨系 (古筝/琵琶)** | 构造体攻击时，会额外弹射出2个微型音符，自动追踪小范围内的敌人。 | 琴弦的清脆泛音 |
| **拉弦系 (二胡/大提琴)** | 构造体周围产生一个持续的减速力场（半径100px，减速15%）。若为大提琴音色，法阵类构造体会跟随玩家移动。 | 弓弦的持续共振 |
| **吹奏系 (笛子/长笛)** | 构造体的攻击（如节拍哨塔的弹体）获得+2穿透效果。 | 气息的穿透力 |
| **打击系 (钢琴/贝斯)** | 构造体在强拍的攻击会附加显著的击退(Knockback)效果。若为钢琴音色，构造体持续时间+20%。 | 琴槌的击弦力度 |

---

## 5. 美术与音效指南

### 5.1. 视觉风格 (Visuals)

构造体的视觉设计应严格遵循“非具象”和“音乐可视化”的原则，避免任何传统意义上的生物或机械形态。

- **核心形态**: 应采用**全息波形 (Holographic Waveforms)**、**悬浮的抽象乐器部件**（如发光的琴键、巨大的音响震膜）或**神圣几何体**作为设计语言。
- **示例**: C音符的“节拍哨塔”可以是一个悬浮的、随节拍脉动的发光立方体；G音符的“重低音炮”可以是一个巨大的、每次在强拍时剧烈震颤的扬声器震膜幻影。

### 5.2. 听觉反馈 (Audio)

音频反馈是召唤系统成败的关键，必须确保所有召唤物的声音产出都是“音乐性的”。

- **音高量化 (Pitch Quantized)**: 所有构造体的攻击、触发等音效，其音高都必须被量化到当前背景音乐的调性音阶上。例如，在C大调的BGM下，任何音效的音高都应是C、D、E、F、G、A、B之一。
- **和谐共鸣**: 这一设计确保了无论战场上有多少个构造体在同时行动，它们产生的音效组合在一起永远是和谐的“交响乐”，而非刺耳的“噪音”，从而完美服务于游戏的核心体验。

---

## 6. Godot 实现逻辑参考

以下伪代码片段展示了构造体基类的核心逻辑，重点在于如何响应全局节拍信号并根据强弱拍和音色调整行为。

```gdscript
# summon_base.gd
extends Node2D

# 构造体数据
var root_note: int  # C=0, D=1, ...
var measures_alive: int = 4 # 存活小节数
var current_beat: int = 0

func _ready():
    # 注册到全局节拍信号
    MusicTheoryEngine.connect("beat_signal", self, "_on_beat")

func _on_beat(beat_index: int):
    current_beat = beat_index
    
    # 强拍判断 (4/4拍的第1和第3拍)
    var is_strong_beat = (beat_index % 2 == 0)
    
    # 根据当前音色获取行为修饰
    var timbre_modifier = SpellcraftSystem.get_timbre_modifier_for_summons()
    
    # 执行具体行为
    perform_action(is_strong_beat, timbre_modifier)
    
    # 生命周期管理
    if beat_index == 0: # 新小节开始
        measures_alive -= 1
        if measures_alive <= 0:
            fade_out() # 执行淡出动画并销毁

func perform_action(is_strong: bool, modifier: Dictionary):
    # 示例：节拍哨塔
    if root_note == 0: # C - 节拍哨塔
        var damage_multiplier = 1.0
        if not is_strong:
            damage_multiplier = 0.5 # 弱拍伤害减半
        
        shoot_projectile(modifier, damage_multiplier)

    # 示例：重低音炮
    if root_note == 4: # G - 重低音炮
        if is_strong: # 仅强拍攻击
            area_blast(modifier)

func fade_out():
    # 实现淡出动画和音效，然后 queue_free()
    pass

# ... 其他具体构造体的行为实现
```

---

## 7. 参考资料

[1] `GDD.md` - 游戏核心设计文档
[2] `Docs/AestheticFatigueSystem_Documentation.md` - 听感疲劳系统设计文档
[3] `Docs/TimbreSystem_Documentation.md` - 音色系统设计文档
[4] `Docs/Numerical_Design_Documentation.md` - 数值设计文档
