# 《Project Harmony》第二章开发计划：故障指挥家·艾伦

**文档目的：** 本文档为《Project Harmony》第二章“故障指挥家·艾伦”提供详细、可执行的开发计划。此计划将延续第一章已验证的“随机流+剧本流”混合生成模型，并引入新的敌人、机制和Boss战，核心聚焦于“故障艺术”（Glitch Art）与“信号崩溃”的美学主题。

**核心目标：** 引入“Screech”和“Silence”两种新敌人，并围绕它们设计教学关卡和Boss战，深化玩家对游戏“噪音vs和谐”核心对立的理解。

---

## 1. 章节设计：信号崩溃的美学

第二章将玩家带入一个被数字噪音严重侵蚀的世界。相比第一章毕达哥拉斯代表的“有序”，本章Boss“艾伦”代表了“失序”与“崩溃”。

### 1.1. 章节时间线 (第二章)

BPM 将在 120-130 之间动态变化，整体节奏比第一章更快。

```
[章节开始 BPM=120]
│
├─ 【剧本】波次 2-1：初识尖啸 (教学波, ~35s)
│   └─ 2 只 Screech，教学其冲刺和脆弱特性
│
├─ [随机流恢复] 波次 1~2 (随机, enemy_pool: static, screech, ~50s)
│
├─ 【剧本】波次 2-2：寂静力场 (教学波, ~45s)
│   └─ 1 只 Silence，教学其疲劳光环和暴露核心机制
│
├─ [随机流恢复] 波次 3~4 (随机, enemy_pool: static, screech, silence, ~50s)
│
├─ 【剧本】波次 2-3：动静结合 (练习波, ~50s)
│   └─ 2 Screech + 1 Silence，练习在移动和静止间的切换
│
├─ [随机流恢复] 波次 5~6 (随机, BPM=130, ~40s)
│
├─ 【剧本】波次 2-4：信号风暴 (考试波, ~60s)
│   └─ 4 Screech + 2 Silence + 5 Static，综合考验
│
├─ [Boss 前冲刺] 波次 7 (随机, pre_boss, 高密度, ~30s)
│
└─ 【Boss 战】故障指挥家·艾伦
```

---

## 2. 核心系统改造

本章无需对核心系统（`EnemySpawner`, `ChapterManager`）进行大的结构性改造，主要工作在于为新敌人编写AI脚本，并创建新的 `WaveData` 资源。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **敌人模型** | `Screech.tscn` | 麦克风反馈音的视觉化，带有拖影和故障特效。 | **高** |
| **敌人模型** | `Silence.tscn` | 黑洞般的视觉核心，周围有扭曲空间的静音光环。 | **高** |
| **Boss模型** | `Boss_Alan.tscn` | 由损坏的示波器、均衡器和信号监视器组成的拼贴人形。 | **极高** |
| **Shader** | `DataMoshing.gdshader` | Boss战背景，模拟数据损坏和视频压缩失真的视觉效果。 | **高** |
| **UI** | `FatigueMeter_v2.tscn` | 升级疲劳计量表，更清晰地展示寂静光环的疲劳累积效应。 | 中 |
| **数据资源** | `wave_2_1.tres` ~ `wave_2_4.tres` | 4个新的 `WaveData` 剧本文件。 | **高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 新敌人实现 (预计 2 天)

*   [ ] **Task 1.1**: 创建 `Screech.gd` 脚本，实现其快速冲刺、瞬移和脆弱的AI逻辑。
*   [ ] **Task 1.2**: 创建 `Silence.gd` 脚本，实现其静音疲劳光环和暴露核心的机制。
*   [ ] **Task 1.3**: **(集成测试)** 在测试场景中验证两种新敌人的行为是否符合设计。

### Milestone 2: 剧本波次实现 (预计 2 天)

*   [ ] **Task 2.1**: 创建 `wave_2_1.tres` 至 `wave_2_4.tres` 四个剧本波次数据文件。
*   [ ] **Task 2.2**: 在 `ChapterData.gd` 中为第二章配置新的 `scripted_waves` 调度表。
*   [ ] **Task 2.3**: **(集成测试)** 完整运行第二章的随机流与剧本流，确保所有波次按预期触发和运行。

### Milestone 3: Boss 战实现 (预计 3 天)

*   [ ] **Task 3.1**: 创建 `boss_alan.gd` 脚本，继承 `boss_base.gd`。
*   [ ] **Task 3.2**: 实现Boss的“信号过载”和“蓝屏死机”两大阶段的核心机制。
*   [ ] **Task 3.3**: 实现 `DataMoshing.gdshader`，并将其作为Boss战的背景。
*   [ ] **Task 3.4**: **(最终测试)** 完整挑战并通过Boss战，验证其难度和趣味性。

---

## 5. 波次剧本详细设计

### 5.1. 波次 2-1：初识尖啸

*   **教学目标:** 学习应对 Screech 的高速冲刺和利用其攻击后的硬直进行反击。
*   **事件序列:**
    *   `0.0s`: `SHOW_HINT` - “尖啸的冲刺迅猛，但攻击后会短暂瘫痪！”
    *   `3.0s`: `SPAWN` - 1x Screech, NORTH
    *   `8.0s`: `SPAWN` - 1x Screech, EAST

### 5.2. 波次 2-2：寂静力场

*   **教学目标:** 理解 Silence 的疲劳光环机制，学会优先集火或规避。
*   **事件序列:**
    *   `0.0s`: `SHOW_HINT` - “寂静力场会加速疲劳，摧毁其核心！”
    *   `2.0s`: `SPAWN` - 1x Silence, CENTER
    *   `10.0s`: `CONDITIONAL_HINT` - (if player in aura for 5s) “尽快离开光环范围！”

### 5.3. 波次 2-3：动静结合

*   **练习目标:** 在应对 Screech 的高速威胁的同时，处理 Silence 带来的区域控制压力。
*   **事件序列:**
    *   `2.0s`: `SPAWN` - 1x Silence, WEST
    *   `5.0s`: `SPAWN` - 2x Screech, EAST

### 5.4. 波次 2-4：信号风暴

*   **考试目标:** 综合应对本章所有新旧敌人的混合攻击。
*   **事件序列:**
    *   `0.0s`: `SET_BPM` - 130
    *   `2.0s`: `SPAWN_SWARM` - 5x Static, SCATTERED
    *   `8.0s`: `SPAWN` - 2x Silence, NORTH & SOUTH
    *   `12.0s`: `SPAWN_SWARM` - 4x Screech, CORNERS

---

## 6. Boss 战详细设计：故障指挥家·艾伦

*   **核心机制:** Boss通过操纵“信号”来攻击，分为两个阶段。

### 阶段一：信号过载 (Signal Overload)

*   **HP:** 1000
*   **攻击模式:**
    1.  **数据包弹幕 (Data Packets):** 发射大量慢速、方形的弹幕，类似损坏的UDP包。
    2.  **比特流激光 (Bitstream Laser):** 发射一道持续的、不稳定的激光，会产生随机的故障跳跃。
    3.  **召唤故障仆从 (Summon Glitches):** 召唤 2-3 只 Screech 或 Static 的故障变体。

### 阶段二：蓝屏死机 (Blue Screen of Death) - HP < 40%

*   **触发:** Boss进入短暂无敌，屏幕闪烁蓝屏，然后恢复。
*   **HP:** 1500 (恢复)
*   **新机制:**
    1.  **致命错误区域 (Fatal Error Zones):** 在场地随机生成持续扩大的红色故障区域，进入会受到巨额伤害。
    2.  **进程扼杀 (Process Kill):** Boss点名一个玩家当前装备的音符或和弦，使其在一段时间内“被禁用”，强制玩家改变策略。
    3.  **系统重启脉冲 (System Reboot Pulse):** 周期性释放全屏冲击波，清除所有弹幕，但也会暂时清除玩家的序列器编排。

*   **击败奖励:** 解锁“音色系统”，允许玩家在出战前选择一种乐器音色（如钢琴、合成主音、贝斯），获得独特的被动加成。
