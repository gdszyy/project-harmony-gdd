# Project Harmony — 频谱相位系统 (共鸣切片) 设计文档

**作者：** Manus AI
**版本：** 1.0
**日期：** 2026年2月10日

---

## 1. 设计概述

### 1.1. 系统定位：从“作曲家”到“混音师”

本设计文档详细阐述了为《Project Harmony》设计的核心战斗解谜机制——**频谱相位系统 (Spectrum Phase System)**，其概念源于用户 gdszyy 提出的“共鸣切片 (Resonance Slicing)”创意。该系统将游戏的核心隐喻从“战斗即作曲”提升至“**战斗即混音**”的全新维度。玩家不仅是创造旋律的作曲家，更是实时调整战场“频率”，从混沌噪音中解析出和谐秩序的混音工程师。

频谱相位系统并非一个孤立的模块，而是深度整合现有**听感疲劳系统 (Aesthetic Fatigue System, AFI)** [1]、**敌人与 Boss 系统** [2, 3] 及**音色系统** [4] 的核心枢纽。它将作为游戏后期，特别是 Boss 战中的核心解谜玩法，要求玩家在不同“频率层”之间穿梭，以应对多维度的威胁，并利用敌人在不同相位下的形态变化来发现并攻击其弱点。

### 1.2. 设计原则

- **解谜驱动战斗**：敌人的威胁不再是单一维度的，而是分布在不同的“频谱”中。玩家的生存与胜利取决于能否正确“滤波”，在合适的时机切换到合适的相位，使战斗从单纯的反应力比拼转变为策略性的解谜过程。
- **风险与资源的动态平衡**：相位的切换与维持将与听感疲劳系统深度绑定，形成全新的资源循环。玩家在享受相位切换带来的巨大战术优势的同时，也必须管理“相位能量”和新增的“频谱偏移疲劳”，从而被引导回至作为“安全区”的全频相位进行休整与恢复。
- **强化现有系统**：本系统旨在增强而非取代现有机制。它为敌人的行为模式、Boss 的阶段设计以及音色的策略选择提供了全新的维度，使现有系统更具深度与可玩性。

---

## 2. 核心机制：三相频谱切换

玩家将获得在三个核心“频谱相位”之间切换的能力。每个相位都代表着对战场这个“复合声波”的一次“切片”，拥有独特的视觉风格、玩家修正、威胁类型和战术优势。

| 相位 | 概念 | 视觉风格 | 玩家修正 | 核心玩法 |
| :--- | :--- | :--- | :--- | :--- |
| **高通相位 (Overtone)** | 过滤低频，保留尖锐、高速的泛音 | 画面变亮，边缘锐化，冷色调，物体线框/碎片化 | 移速+30%，冲刺冷却-50%，受伤+20% | **规避与刺杀**：用于躲避低频弹幕，攻击暴露的高频弱点 |
| **低通相位 (Sub-Bass)** | 过滤高频，保留厚重、缓慢的基频 | 画面变暗，动态模糊，暖色调，物体液态/实心化 | 移速-20%，获得霸体，受伤-50%，无法冲刺 | **防御与破盾**：用于硬抗高频攻击，打击暴露的低频护甲 |
| **全频相位 (Fundamental)** | 标准物质世界，平衡状态 | 游戏原始美术风格 | 无修正，能量恢复速度最快 | **恢复与观察**：核心的能量恢复层，用于观察战场全局 |

### 2.1. 高通相位 (The Overtone Layer)

在此相位下，世界呈现为不稳定的高频形态。玩家变得轻盈、迅捷，但自身也更加脆弱。这是典型的“玻璃大炮”模式，适合进行快速的位移、躲避密集的低频弹幕（如震荡波、重力场），并对敌人暴露出的核心弱点进行精准打击。

### 2.2. 低通相位 (The Sub-Bass Layer)

在此相位下，世界呈现为厚重的低频能量场。玩家变得沉重、坚固，但行动迟缓。这是典型的“坦克”模式，适合硬抗无法躲避的高频攻击（如激光、音刃），并利用霸体效果强行突破敌阵，攻击敌人的重型护甲。

### 2.3. 全频相位 (The Fundamental Layer)

这是游戏的默认状态，也是玩家的“安全港”。在此相位下，玩家的各项属性均无变化，但最重要的是，这是唯一能够高效恢复“相位能量”和降低“频谱偏移疲劳”的相位。玩家在极端相位中消耗资源后，必须周期性地返回全频相位进行“重置”。

---

## 3. 与听感疲劳系统 (AFI) 的深度整合

频谱相位系统将引入两项新资源，与现有的听感疲劳指数 (AFI) 构成一个完整的资源管理闭环。

### 3.1. 新资源：相位能量 (Phase Energy)

- **概念**：一个独立的能量条，上限为100。切换到高通或低通相位会**立即消耗10点**能量，并且只要停留在极端相位中，就会**每秒持续消耗5点**能量。
- **恢复**：只有在**全频相位**下，相位能量才会恢复。其恢复速度与玩家当前的**听感疲劳指数 (AFI) 负相关**。

| 疲劳等级 (AFI) | 相位能量恢复速度 (点/秒) |
| :--- | :--- |
| 无 (AFI < 0.3) | 20 |
| 轻度 (0.3 ≤ AFI < 0.5) | 15 |
| 中度 (0.5 ≤ AFI < 0.8) | 10 |
| 严重 (0.8 ≤ AFI < 1.0) | 5 |
| 临界 (AFI = 1.0) | 0 |

这一设计将相位切换的“操作成本”与玩家的“音乐性”表现直接挂钩。一个演奏得更富于变化的玩家（低AFI），将能更频繁地使用相位切换能力。

### 3.2. 新疲劳维度：频谱偏移疲劳 (Spectrum Offset Fatigue)

为了防止玩家滥用极端相位，我们为 AFI 系统引入第九个疲劳维度：

- **概念**：只要玩家停留在高通或低通相位，该疲劳维度就会随时间线性增长。其增长速度远高于其他八个维度。
- **效果**：当“频谱偏移疲劳”成为 AFI 的主要贡献者时，系统会强制触发“**频谱失调 (Spectrum Corruption)**”的全局 Debuff，表现为屏幕剧烈扭曲，所有音色效果暂时失效，直到玩家返回全频相位一段时间后才会解除。

这一机制强制玩家必须将极端相位作为一种**战术爆发手段**，而非持续状态，从而巩固了全频相位的核心恢复地位。

---

## 4. 敌人与弹幕的相位形态

频谱相位系统将为所有敌人和弹幕赋予多维形态，将战斗转化为动态解谜。

### 4.1. 敌人相位矩阵

现有敌人将在不同相位下呈现出截然不同的形态、行为和弱点。

| 敌人 | 高通相位 (Overtone) | 低通相位 (Sub-Bass) | 全频相位 (Fundamental) |
| :--- | :--- | :--- | :--- |
| **Static (底噪)** | 体积缩小为光点，速度极快，但生命值极低。 | 膨胀为巨大的减速雾团，无伤害但阻碍移动。 | 原始形态，正常追踪。 |
| **Silence (寂静)** | 静音光环消失，暴露出可被暴击的核心。 | 静音光环范围扩大50%，疲劳增长效果加倍。 | 原始形态，缓慢追踪。 |
| **Screech (尖啸)** | 冲刺变为瞬移，极难命中但极度脆弱。 | 移动速度降为0，被重低音压制在原地。 | 原始形态，快速冲刺。 |
| **Pulse (脉冲)** | 环形弹幕变为8道瞬发的高频激光。 | 环形弹幕变为一次全屏的低频震荡波。 | 原始形态，环形弹幕。 |
| **Wall (音墙)** | 护盾消失，本体暴露，但移动速度提升30%。 | 体积增大，完全不可摧毁，可作为临时掩体或平台。 | 原始形态，带护盾的推进墙。 |

### 4.2. 弹幕相位可见性

敌人的攻击也将拥有相位属性，这意味着在错误的相位下，某些攻击可能是完全不可见或无害的，而在正确的相位下，它们又是致命的威胁。这要求玩家通过快速切换相位来“扫描”战场的真实危险。

**案例：相位地雷 (Phase Mine)**

> Boss 发射一颗巨大的黑色球体。在**全频相位**下，它是一个标准的爆炸物。但如果玩家切换到**高通相位**，会发现它其实是一个空心的网格，可以从中安全穿过。如果切换到**低通相位**，它会变成一个坚固的实体平台，玩家可以站立其上躲避地面攻击。

---

## 5. 与 Boss 战的整合：终极频谱解谜

频谱相位系统将成为后期 Boss 战的核心机制，与 Boss 的“时代特征”和“风格排斥”机制深度融合。

- **第七章 Boss：合成主脑·噪音**：这场战斗将是频谱相位系统的终极考验。Boss 的“波形战争”将与相位完美对应：
    - **锯齿波 (Sawtooth)**: 攻击只在**高通相位**可见且造成伤害。
    - **方波 (Square)**: 矩形致死区域只在**全频相位**生效。
    - **正弦波 (Sine)**: 干涉图样只在**低通相位**可见且造成伤害。
    - **白噪音 (Noise)**: 在所有相位都造成伤害，但只有在**全频相位**才能通过攻击 Boss 核心来打断。

- **第三章 Boss：大构建师·巴赫**：其“赋格迷宫”的多个弹幕声部将分布在不同相位。玩家必须在三个相位间快速切换，才能看清并预判所有声部的完整轨迹，否则就会被来自“不可见维度”的攻击命中。

- **第五章 Boss：狂想者·贝多芬**：其“弹性速度”机制将影响相位切换的效率。在 `Accelerando` (加速) 阶段，切换相位的能量消耗加倍；在 `Ritardando` (减速) 阶段，极端相位的持续消耗减半，鼓励玩家在此时进行破盾或刺杀操作。

---

## 6. 与音色及召唤系统的联动

### 6.1. 音色相位增益

不同的音色系别，其声学特性与特定频谱相位天然契合，将在对应相位下获得增益。

| 音色系别 | 核心机制 | 契合相位 | 增益效果 |
| :--- | :--- | :--- | :--- |
| **弹拨系** | 瞬态爆发 | **高通相位** | 瞬态冲击波伤害 +50% |
| **打击系** | 重音冲击 | **低通相位** | 强拍的击退与眩晕效果翻倍 |
| **拉弦系** | 连绵共振 | **全频相位** | 共振标记持续时间 +50% |
| **吹奏系** | 气息聚焦 | **切换时** | 切换相位后的第一次攻击，立即触发最终聚焦效果 |

### 6.2. 召唤物相位交互

召唤物 [5] 的行为也会受到相位影响。例如，**长程棱镜**（共鸣器）在**高通相位**下，除了增加射程外，还会使穿过它的弹体附加“频谱穿透”效果，能同时伤害所有相位的敌人。而**低频音墙**（干扰场）在**低通相位**下，其推开敌人的力量会大幅增强。

---

## 7. 技术实现方案

### 7.1. 碰撞层扩展

根据用户提议及项目现状 [6]，我们将使用 Layer 10-17 来实现相位碰撞。这要求对项目设置进行如下扩展：

| Layer | 名称 | 用途 |
| :--- | :--- | :--- |
| 10 | `Enemy_Normal` | 敌人在全频相位的碰撞体 |
| 11 | `Enemy_HighPass` | 敌人在高通相位的碰撞体 |
| 12 | `Enemy_LowPass` | 敌人在低通相位的碰撞体 |
| 13 | `Bullet_Normal` | 弹幕在全频相位的碰撞体 |
| 14 | `Bullet_HighPass` | 弹幕在高通相位的碰撞体 |
| 15 | `Bullet_LowPass` | 弹幕在低通相位的碰撞体 |
| 16 | `Player_Phase_Interaction` | 玩家用于与相位特定物体交互的层 |

当玩家切换相位时，脚本将动态修改玩家的 `collision_mask`，使其只与当前相位对应的敌人和弹幕层发生碰撞。

### 7.2. 敌人场景结构

遵循用户提议，每个敌人场景将包含三套独立的碰撞体和视觉节点（Sprite/Mesh）。一个全局的 `PhaseManager` 单例将负责广播当前的相位状态，所有敌人和弹幕监听到信号后，调用内部函数切换自身的 `visible` 和 `disabled` 属性，并执行对应的行为逻辑。

### 7.3. 全屏着色器 (Shader)

利用一个 Screen-Space Shader 来实现相位的视觉风格切换。该 Shader 将接收一个 `phase_mode` (0=Normal, 1=High, 2=Low) 的 uniform 变量。

- **高通模式**: 增加亮度，应用边缘检测 (Sobel) 算法，并叠加轻微的色差 (Chromatic Aberration) 和噪点效果。
- **低通模式**: 降低亮度，增加对比度，应用高斯模糊 (Gaussian Blur) 和镜头扭曲 (Lens Distortion) 效果，并叠加全屏的低频震动。

---

## 8. 参考资料

[1] `Docs/AestheticFatigueSystem_Documentation.md` — 听感疲劳系统设计文档
[2] `Docs/Enemy_System_Design.md` — 敌人系统设计文档
[3] `Docs/Level_And_Boss_Design.md` — 关卡与 Boss 机制设计文档
[4] `Docs/TimbreSystem_Documentation.md` — 音色系统设计文档
[5] `Docs/SummoningSystem_Documentation.md` — 召唤系统设计文档
[6] `godot_project/collision_layers.md` — 碰撞层配置文档
