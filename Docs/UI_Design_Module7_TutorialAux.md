# UI 设计文档：模块7 - 教学引导与辅助 UI

**版本:** 1.0
**最后更新:** 2026-02-12
**作者:** Manus AI

---

## 1. 设计哲学与原则

本模块的设计旨在为《Project Harmony》复杂而独特的音乐理论机制提供一套无缝、直观且高度主题化的教学引导与辅助UI系统。设计将严格遵循游戏的核心美学——“抽象矢量主义 vs. 数字衰变”，并将“音乐性”作为交互反馈的指导思想。我们的目标不是简单地“告知”玩家，而是“引导”玩家去“感受”和“发现”游戏内在的和谐规律。

> 在游戏设计中，优秀的教学引导如同“无形之手”，它在不破坏玩家沉浸感的前提下，将复杂的规则转化为可探索的发现之旅 [1]。本模块的设计正是基于此理念，力求将学习成本降至最低，同时将“通感”体验最大化。

设计遵循以下核心原则：

| 设计原则 | 核心理念 | 实现策略 |
| :--- | :--- | :--- |
| **上下文感知** | 在玩家最需要帮助的时刻，提供最精准的引导。 | 深度整合游戏状态机，基于玩家行为（如首次拾取黑键、疲劳值飙升）触发“即时”教学事件。 |
| **非侵入式设计** | 教学不应打断游戏“心流”(Flow)。 | 优先使用环境高亮、动态指示和非模态通知，避免暂停游戏或遮挡核心战斗区域 [2]。 |
| **玩家主导** | 尊重玩家，赋予其对学习过程的完全控制。 | 所有教学序列均提供明确的“跳过”选项，并通过游戏内法典提供随时“回顾”的入口。 |
| **深度主题化** | UI即世界，教学元素是游戏叙事的一部分。 | 摒弃通用范式，将加载画面、提示气泡、结束界面等设计为游戏“音乐宇宙”的自然延伸。 |
| **动态反馈** | 所有UI元素都应充满“多汁感”(Juiciness)。 | 将UI动画与游戏BPM或玩家动作同步，通过辉光、脉动、粒子效果强化“万物皆乐”的通感体验。 |

## 2. 全局UI主题规范应用

本模块所有UI组件将严格遵循已在 `Art_And_VFX_Direction.md` 和 `ui_colors.gd` 中定义的全局规范，确保视觉语言的绝对统一。

| UI元素 | 视觉规范 | 颜色代码 |
| :--- | :--- | :--- |
| **面板背景** | 星空紫，80%不透明，带有微弱噪点 | `#141026` (Alpha: `0.8`) |
| **强调色/高亮** | 明亮的霓虹紫 | `#9D6FFF` |
| **文本主色** | 晶体白 | `#EAE6FF` |
| **文本次色** | 柔和的紫灰色 | `#A098C8` |
| **按钮样式** | 霓虹紫边框，带有辉光效果 | `#9D6FFF` |
| **成功/增益** | 明绿色 | `#4DFF80` |
| **危险/减益** | 警示红 | `#FF4D4D` |
| **传说/稀有** | 金色 | `#FFD700` |

---

## 3. 新手教学提示系统 (Newbie Tutorial System)

新手教学系统是引导玩家理解《Project Harmony》复杂机制的关键。它将是一个序列化的、上下文触发的、视觉引导丰富的系统，旨在将学习过程无缝融入初期的游戏体验中。

### 3.1. 交互流程与教学序列管理

教学流程被设计为一系列可管理的“教学事件”(Tutorial Event)，每个事件包含触发条件、引导步骤和完成目标。这确保了教学的模块化和可扩展性。

**交互流程**
1.  **触发 (Trigger):** 教学事件由游戏内的特定行为触发，例如 `FIRST_NOTE_PICKUP`（首次拾取音符晶片）或 `FATIGUE_FIRST_HIGH`（听感疲劳首次超过60%）。
2.  **执行 (Execution):** 事件触发后，教学管理器 (`tutorial_manager.gd`) 将接管部分UI交互，开始执行引导步骤。游戏不会暂停，但玩家的部分操作可能会被限制，以聚焦于当前教学目标。
3.  **引导 (Guidance):** 系统将组合使用多种视觉提示（见3.2节）来引导玩家完成操作。例如，高亮显示“一体化编曲台”按钮，并用箭头和文字气泡指示玩家点击。
4.  **完成与继续 (Completion & Continuation):** 当玩家完成指定操作（如成功装备一个音符），当前步骤结束。系统会显示一个简短的正面反馈（如“完成！”的Toast通知），然后自动进入下一步，或等待下一个教学事件的触发。

**序列管理**
-   **可跳过 (Skippable):** 屏幕右上角将始终显示一个“跳过教学”的按钮，允许老玩家或希望自行探索的玩家随时退出引导。跳过的教学将被标记为“已查看”，但仍可在谐振法典中回顾。
-   **可回顾 (Reviewable):** 所有完成或跳过的教学内容，都将自动收录到“谐振法典”的“教学”分页中。玩家可以随时查阅，回顾核心机制的图文说明。
-   **进度指示 (Progress Indicator):** 在一个多步骤的教学事件中，屏幕顶部中央会显示一个简化的进度条和步骤编号（如“步骤 2/4”），让玩家对教学的长度有清晰的预期。

### 3.2. 视觉设计与组件

#### 3.2.1. 步骤指引 (Step Indicator)

-   **位置:** 屏幕顶部中央。
-   **样式:** 一个纤细的、由主强调色 `#9D6FFF` 构成的进度条。进度条的填充动画将平滑过渡。进度条上方是“教学：[当前任务]”，下方是步骤编号，如 `2 / 4`。

#### 3.2.2. 高亮区域 (Highlight Area)

-   **效果:** 这是教学系统的核心视觉引导。屏幕上除目标UI元素外，其他所有部分都将被一个半透明的黑色遮罩（`#000000`，70%不透明度）覆盖。目标UI元素周围会形成一个柔和的、发光的“聚光灯”区域。
-   **实现:** 使用一个全屏的 `CanvasLayer`，其中包含一个 `Light2D` 节点和一个作为遮罩纹理的 `Sprite2D`。通过修改 `Light2D` 的位置和纹理缩放，可以动态地将“聚光灯”聚焦到屏幕上任何UI元素 [3]。

#### 3.2.3. 箭头指示与文字说明气泡 (Arrow & Text Bubble)

-   **箭头:** 一个动态的、由粒子构成的发光箭头，箭头本身带有流动和脉冲的动画效果，使其充满生命力。箭头颜色为主强调色 `#9D6FFF`。
-   **文字气泡:** 遵循全局面板样式，背景为星空紫 `#141026`，带有霓虹紫 `#9D6FFF` 的辉光边框。包含简短、清晰的指令性文字，如“点击这里打开编曲台”。

---

## 4. 辅助UI组件设计

除了新手教学，一系列辅助UI组件将在整个游戏流程中为玩家提供信息和支持。

### 4.1. 游戏内提示气泡 (In-Game Hint Bubbles)

与新手教学不同，提示气泡是为非关键性、上下文敏感的操作提示设计的。它们更加轻量，出现时不会打断游戏流程。

- **样式:** 一个小巧的、半透明的面板，从屏幕边缘或特定UI元素旁滑出。背景为 `PANEL_DARK` (`#100C20`)，带有 `ACCENT_2` (`#4DFFF3`) 的细边框，以区别于教学系统的紫色主题。
- **触发时机:** 玩家长时间未使用某个核心功能、在某个界面停留过久，或游戏检测到玩家可能陷入了困境。
- **内容:** 提示性文字，例如“尝试切换频谱相位来应对不同敌人”。

### 4.2. 加载画面设计 (Loading Screen Design)

加载画面不仅仅是等待时间的填充，更是章节主题的预演和游戏氛围的延续。

- **布局:**
    - **背景:** 一张高品质的、符合章节主题的插画。
    - **章节标题:** 屏幕中央显示巨大的章节标题和编号，如“第一乐章：谐振之初”。
    - **加载进度条:** 屏幕底部一个纤细的进度条，填充物是流动的、由主强调色 `#9D6FFF` 构成的能量波。
    - **游戏提示 (Game Tips):** 在进度条上方，循环显示与游戏机制相关的简短提示。

- **动效:** 背景插画将有微妙的视差滚动和粒子效果。加载完成时，整个画面会伴随一个强烈的“谐振”音效和白光闪现，然后无缝切换到游戏场景。

### 4.3. 游戏结束界面 (Game Over Screen)

游戏结束界面需要提供清晰的反馈，并引导玩家进行下一步操作。我们将整合现有的 `run_results_screen.gd`，并对其进行主题化和情感化重构，称之为“最终乐章”界面。

- **设计流程:**
    1. **死亡原因:** 屏幕中央首先清晰地显示死亡原因，例如“被 [敌人名称] 击败”或“被不和谐所吞噬”。
    2. **背景与氛围:** 屏幕会首先变为黑白，然后根据玩家本局的“和谐度”评级，背景会展现不同的动态视觉效果（从S级的金色曼陀罗到D级的红色故障特效）。
    3. **统计摘要:** 死亡原因淡出后，一个面板会从屏幕中央展开，以动画形式逐条“演奏”出核心统计数据。
    4. **操作选项:** 统计摘要下方是三个清晰的按钮：“重塑谐振” (重试)、“返回殿堂” (返回主菜单)和“查看乐谱” (远期功能)。

---

## 5. 通用组件库设计规范 (Common Component Library)

为了确保整个游戏UI的统一性，我们将定义一套可复用的通用组件规范。

| 组件类型 | 用途 | 视觉样式与行为 |
| :--- | :--- | :--- |
| **通用弹窗** | 模态操作确认（如退出游戏）。 | 游戏暂停，背景遮罩。面板遵循全局样式，提供“确认”和“取消”按钮。 |
| **Toast 通知** | 非关键、短暂的自动消息（如成就解锁）。 | 屏幕角落滑入，停留2-3秒后自动消失。根据通知类型（成就、物品）使用不同图标和颜色。 |
| **工具提示(Tooltip)** | 悬停显示详细信息。 | 鼠标悬停0.5秒后出现。紧凑、信息密度高的面板，使用次要背景色，避免干扰主UI。 |

## 6. Godot 实现总览与建议

| 模块 | 建议实现方案 | 关键节点/脚本 | 依赖与集成 |
| :--- | :--- | :--- | :--- |
| **新手教学系统** | 创建新的 `tutorial_manager` Autoload（位于 `scripts/systems/`），管理教学事件序列。高亮遮罩和箭头气泡功能已由 `tutorial_hint_manager.gd` 脚本统一控制，无独立场景文件。 | `tutorial_manager.gd`, `tutorial_hint_manager.gd` | 监听 `GameManager` 状态信号；在 `CodexUI` 中添加回顾入口。 |
| **加载画面** | 创建 `LoadingScreen.tscn` 场景，在场景切换时加载。 | `LoadingScreen.tscn`, `loading_screen.gd` | 由 `GameManager` 的场景切换函数调用。（注：原设计中的 `loading_tips.json` 当前缺失，提示文本可能已硬编码在 `loading_screen.gd` 中。） |
| **游戏结束界面** | 重构现有 `run_results_screen.gd`，整合死亡原因显示和基于评级的动态背景特效。 | `RunResultsScreen.gd` (建议重命名为 `FinalMovementScreen.gd`) | 需要从 `GameManager` 获取最终统计数据和和谐度评级。 |
| **通用弹窗** | 创建可复用的对话框场景，继承自 `PopupPanel`。 | `dialog_system.gd` | 在需要确认操作的地方（如 `PauseMenu`）实例化并等待信号。 |
| **Toast 通知** | 创建 `notification_manager.gd` Autoload，管理通知队列和显示 [4]。 | `notification_manager.gd`, `toast_notification.tscn` | 游戏各处（如 `AchievementManager`, `Inventory`）均可调用其公共方法来显示通知。 |
| **工具提示** | 创建 `CustomTooltip.tscn` 场景，并编写脚本覆盖 `Control._make_custom_tooltip` 方法 [5]。 | `CustomTooltip.tscn`, `tooltip_system.gd` | 在全局脚本中设置，即可为所有控件启用自定义 Tooltip。 |

---

## 7. 总结

模块7的设计旨在通过一套完整、主题化且交互友好的UI/UX解决方案，有效降低《Project Harmony》的学习门槛，同时增强游戏的沉浸感和整体体验。通过将教学引导、即时反馈和辅助信息无缝地融入游戏的核心美学和玩法循环中，我们希望玩家的每一次交互都成为其“音乐创作之旅”中一个和谐而直观的音符。

---

## 8. 参考资料

[1] Inworld AI. (n.d.). *Game UX: Best practices for video game tutorial design*. Retrieved from https://inworld.ai/blog/game-ux-best-practices-for-video-game-tutorial-design
[2] Brouard, L. (2021, November 11). *Games UX: Building the right onboarding experience*. UX Collective. Retrieved from https://uxdesign.cc/games-ux-building-the-right-onboarding-experience-a6e99cf4aaea
[3] Godot Engine. (n.d.). *SpotLight3D*. Godot Engine documentation. Retrieved from https://docs.godotengine.org/en/4.4/classes/class_spotlight3d.html
[4] Godot Engine Proposals. (2020, September 10). *Add action notifications/toast menu system #1489*. GitHub. Retrieved from https://github.com/godotengine/godot-proposals/issues/1489
[5] Godot Engine. (n.d.). *Popup*. Godot Engine documentation. Retrieved from https://docs.godotengine.org/en/4.4/classes/class_popup.html
