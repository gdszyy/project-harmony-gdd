# 《Project Harmony》第六章开发计划：十二音序列破坏者·勋伯格

**文档目的：** 本文档为《Project Harmony》第六章“十二音序列破坏者·勋伯格”提供详细、可执行的开发计划。本章将深入探讨“无调性”和“序列主义”的音乐概念，核心聚焦于“规则的颠覆”和“可预测的无序”。

**核心目标：** 引入“序列敌人”（Serial Enemy）和“音列矩阵”（Tone Row Matrix）机制，并围绕它们设计一个需要玩家从混乱中寻找规律的、极具挑战性的Boss战。

---

## 1. 章节设计：无调性的秩序

第六章的主题是“在混沌中寻找秩序”。灵感来源于勋伯格的十二音技法——一种用严格的数学规则来组织无调性音乐的方法。战斗将充满看似随机、实则暗含规律的挑战，考验玩家的观察力和逻辑推理能力。

### 1.1. 章节时间线 (第六章)

BPM 极不稳定，会在 80-160 之间剧烈跳跃，制造出极强的无序感。

```
[章节开始 BPM=???]
│
├─ 【剧本】波次 6-1：音列矩阵 (教学波, ~60s)
│   └─ 场地出现“音列矩阵”，教学玩家根据矩阵预判敌人出现的位置和类型
│
├─ [随机流恢复] 波次 1~2 (随机, enemy_pool: all previous, ~80s)
│
├─ 【剧本】波次 6-2：序列敌人 (教学波, ~60s)
│   └─ 出现“序列敌人”，其行为（移动、攻击）严格遵循矩阵的下一个音符
│
├─ [随机流恢复] 波次 3~4 (随机, ~80s)
│
├─ 【剧本】波次 6-3：矩阵变形 (练习波, ~70s)
│   └─ “音列矩阵”会进行“逆行”、“倒影”等变形，增加预判难度
│
├─ [随机流恢复] 波次 5~6 (随机, ~60s)
│
├─ 【剧本】波次 6-4：无调性合奏 (考试波, ~90s)
│   └─ 在剧烈变化的BPM和变形的矩阵下，应对大量的序列敌人
│
├─ [Boss 前冲刺] 波次 7 (随机, pre_boss, 高密度, ~30s)
│
└─ 【Boss 战】十二音序列破坏者·勋伯格
```

---

## 2. 核心系统改造

*   **UI系统:** 需要一个高度可定制的UI元素来显示“音列矩阵”，并能动态展示其变形。
*   **敌人AI:** 需要一个新的AI基类 `SerialAI`，它的所有行为都由外部的“音列矩阵”驱动。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **UI元素** | `ToneRowMatrix.tscn` | 一个12x12的网格，显示着不同的音符/敌人图标，能够高亮和变形。 | **极高** |
| **敌人模型** | `SerialEnemy.tscn` | 由纯粹的几何形状（方块、三角、圆形）构成的抽象敌人。 | **高** |
| **Boss模型** | `Boss_Schoenberg.tscn` | 一个巨大的、由12个分离的、不断重组的几何体构成的Boss。 | **极高** |
| **Shader** | `MatrixGlitch.gdshader` | Boss战背景，模拟数字矩阵的故障和数据流。 | **高** |
| **数据资源** | `wave_6_1.tres` ~ `wave_6_4.tres` | 4个新的 `WaveData` 剧本文件。 | **高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 新机制与敌人实现 (预计 4 天)

*   [ ] **Task 1.1**: 设计并实现 `ToneRowMatrix.gd` UI控件，包括其数据结构和变形（逆行、倒影、逆行倒影）逻辑。
*   [ ] **Task 1.2**: 创建 `SerialAI.gd` 基类，使其能够读取矩阵数据并据此行动。
*   [ ] **Task 1.3**: 创建多种继承自 `SerialAI` 的“序列敌人”，分别对应不同的行为（移动、攻击、防御）。
*   [ ] **Task 1.4**: **(集成测试)** 验证矩阵的显示和变形，以及序列敌人的行为是否严格与矩阵同步。

### Milestone 2: 剧本波次实现 (预计 2 天)

*   [ ] **Task 2.1**: 创建 `wave_6_1.tres` 至 `wave_6_4.tres` 四个剧本文件。
*   [ ] **Task 2.2**: 在 `ChapterData.gd` 中配置第六章的 `scripted_waves` 调度表。
*   [ ] **Task 2.3**: **(集成测试)** 完整运行第六章，确保玩家能够理解并利用矩阵规律。

### Milestone 3: Boss 战实现 (预计 4 天)

*   [ ] **Task 3.1**: 创建 `boss_schoenberg.gd` 脚本。
*   [ ] **Task 3.2**: **(核心难点)** 实现Boss本身就是“音列矩阵”的机制。Boss的12个组成部分会根据矩阵规则移动和攻击，玩家需要攻击正确的“音符”才能对其造成伤害。
*   [ ] **Task 3.3**: 实现Boss的“矩阵崩溃”和“序列奇点”攻击。
*   [ ] **Task 3.4**: **(最终测试)** 完整挑战并通过Boss战，体验这场从极度混乱到洞悉规律的认知突破之旅。

---

## 5. Boss 战详细设计：十二音序列破坏者·勋伯格

*   **核心机制:** Boss由12个独立的几何体组成，分别代表12个半音。这12个几何体的位置和行为由一个全局的“音列矩阵”控制。玩家的HUD上会显示这个矩阵，矩阵预告了Boss每个部分的下一步行动。

### 阶段一：原型音列 (Prime Series)

*   **HP:** 2000
*   **机制:** Boss的12个部分会按照一个固定的“原型音列”依次激活并攻击。玩家必须按照矩阵显示的顺序，攻击当前被激活的部分才能造成有效伤害。攻击错误的“音符”会导致弹幕被反弹。
*   **攻击模式:**
    1.  **序列脉冲 (Serial Pulse):** 被激活的Boss部分会发射一道追踪玩家的能量脉冲。
    2.  **音簇弹幕 (Tone Cluster):** 多个相邻的Boss部分同时激活，发射一片密集的扇形弹幕。

### 阶段二：矩阵变形 (Matrix Transformation) - HP < 50%

*   **HP:** 2500 (恢复)
*   **新机制:** “音列矩阵”开始进行变形，Boss的行为随之改变。
    1.  **逆行 (Retrograde):** 矩阵倒序播放，Boss部分会以相反的顺序激活和攻击。
    2.  **倒影 (Inversion):** 矩阵的音程关系上下颠倒，Boss部分的攻击模式发生镜像改变（例如，向上的攻击变为向下）。
    3.  **矩阵崩溃 (Matrix Collapse):** （终极技能，HP<20%）矩阵本身开始出现“故障”，预告信息会延迟或错误，Boss的行为变得极难预测。同时，所有12个部分会向场地中心聚合，形成一个“序列奇点”（Serial Singularity），持续吸引玩家并释放毁灭性的全屏攻击。玩家必须在被吸入之前，根据仅存的正确矩阵信息，摧毁特定的“结构弱点音符”。

*   **击败奖励:** 解锁“法术书”的“高级和弦”页面，允许玩家在局外成长系统中研究和解锁“减七和弦”、“大七和弦”等更复杂的和弦法术。
