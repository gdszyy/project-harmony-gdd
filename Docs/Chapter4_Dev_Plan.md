# 《Project Harmony》第四章开发计划：摇滚反叛者·莫扎特

**文档目的：** 本文档为《Project Harmony》第四章“摇滚反叛者·莫扎特”提供详细、可执行的开发计划。本章将颠覆前几章的庄严与秩序，引入“摇滚”与“即兴”的元素，核心聚焦于“摇摆节奏”（Swing Rhythm）和动态、不可预测的敌人行为。

**核心目标：** 引入“即兴乐手”（Improviser）敌人和“摇摆弹道”机制，并围绕它们设计一个充满动感和即兴色彩的Boss战。

---

## 1. 章节设计：古典的叛逆

第四章的主题是“规则的破坏者”。灵感来源于莫扎特音乐中蕴含的戏剧性和一丝叛逆精神，并将其用现代的摇滚乐形式进行诠释。敌人和Boss的行为将充满变化，鼓励玩家进行即兴反应而非死记硬背。

### 1.1. 章节时间线 (第四章)

BPM 在 130-140 之间，是目前为止节奏最快的章节，充满能量感。

```
[章节开始 BPM=130]
│
├─ 【剧本】波次 4-1：摇摆节奏 (教学波, ~40s)
│   └─ 教学玩家使用“摇摆节奏”解锁S型弹道
│
├─ [随机流恢复] 波次 1~2 (随机, enemy_pool: static, screech, ~50s)
│
├─ 【剧本】波次 4-2：即兴乐手 (教学波, ~50s)
│   └─ 2 只 Improviser，教学其不可预测的移动和攻击模式
│
├─ [随机流恢复] 波次 3~4 (随机, ~50s)
│
├─ 【剧本】波次 4-3：舞台冲撞 (练习波, ~60s)
│   └─ 4 只 Improviser 进行“Mosh Pit”（冲撞），练习在混乱中的走位
│
├─ [随机流恢复] 波次 5~6 (随机, BPM=140, ~40s)
│
├─ 【剧本】波次 4-4：即兴独奏 (考试波, ~70s)
│   └─ 1 只精英Improviser，拥有多种攻击模式，考验玩家的反应速度
│
├─ [Boss 前冲刺] 波次 7 (随机, pre_boss, 高密度, ~30s)
│
└─ 【Boss 战】摇滚反叛者·莫扎特
```

---

## 2. 核心系统改造

*   **节奏系统:** 正式解锁“摇摆节奏”，并允许玩家在序列器中应用。应用后，弹体获得 `is_swing` 属性。
*   **弹道系统:** 弹体移动逻辑需要检查 `is_swing` 属性，如果为 `true`，则应用S型或波浪形轨迹。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **敌人模型** | `Improviser.tscn` | 穿着朋克风格服装，手持电吉他的敌人，动作夸张且难以预测。 | **高** |
| **Boss模型** | `Boss_Mozart.tscn` | 莫扎特经典形象与华丽摇滚明星的结合体，在舞台灯光下表演。 | **极高** |
| **Shader** | `StageLighting.gdshader` | Boss战背景，模拟动态的舞台追光灯和频闪效果。 | **高** | 
| **数据资源** | `wave_4_1.tres` ~ `wave_4_4.tres` | 4个新的 `WaveData` 剧本文件。 | **高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 新机制与敌人实现 (预计 3 天)

*   [ ] **Task 1.1**: 在节奏系统中实现“摇摆节奏”的解锁和应用逻辑。
*   [ ] **Task 1.2**: 修改弹体基类，增加 `apply_swing_trajectory()` 方法。
*   [ ] **Task 1.3**: 创建 `Improviser.gd` 脚本，为其设计多种随机组合的移动和攻击行为模式。
*   [ ] **Task 1.4**: **(集成测试)** 验证摇摆弹道和Improviser的行为符合预期。

### Milestone 2: 剧本波次实现 (预计 2 天)

*   [ ] **Task 2.1**: 创建 `wave_4_1.tres` 至 `wave_4_4.tres` 四个剧本文件。
*   [ ] **Task 2.2**: 在 `ChapterData.gd` 中配置第四章的 `scripted_waves` 调度表。
*   [ ] **Task 2.3**: **(集成测试)** 完整运行第四章，体验其快节奏和即兴感。

### Milestone 3: Boss 战实现 (预计 4 天)

*   [ ] **Task 3.1**: 创建 `boss_mozart.gd` 脚本。
*   [ ] **Task 3.2**: **(核心难点)** 实现Boss的“乐句模仿”机制，即Boss能“学习”并“变奏”玩家最近使用的和弦法术。
*   [ ] **Task 3.3**: 实现Boss的“舞台跳水”和“吉他独奏”等表演性攻击模式。
*   [ ] **Task 3.4**: **(最终测试)** 完整挑战并通过Boss战，感受如同参与一场摇滚音乐会的战斗。

---

## 5. Boss 战详细设计：摇滚反叛者·莫扎特

*   **核心机制:** Boss是一个在舞台上高速移动、表演并与玩家互动的“明星”。他的攻击模式充满表演性质，并且会根据玩家的行为做出反应。

### 阶段一：嬉游曲 (Divertimento)

*   **HP:** 1500
*   **攻击模式:**
    1.  **舞台跳水 (Stage Dive):** Boss跳向玩家位置，落地产生冲击波，并随机向周围发射音符弹幕。
    2.  **即兴重复段 (Riff):** Boss在舞台上高速滑行，同时向两侧发射固定的摇摆弹道弹幕。
    3.  **乐句模仿 (Phrase Mimicry):** Boss记录玩家最近使用的2-3个和弦法术，短暂“调音”后，释放一个威力更大、弹幕更华丽的“摇滚版”法术。

### 阶段二：安魂曲 (Requiem) - HP < 50%

*   **HP:** 2000 (恢复)
*   **新机制:**
    1.  **吉他独奏 (Guitar Solo):** Boss移动到舞台中央，进入无敌状态，开始一段华丽的吉他独奏。此时，全屏会降下密集的“音符雨”弹幕，玩家必须在弹幕中生存。
    2.  **魔笛 (The Magic Flute):** Boss召唤2个幽灵般的“夜后”（Queen of the Night），她们会用咏叹调般的尖啸发射追踪激光。
    3.  **返场 (Encore):** （终极技能，HP<20%）Boss变得极度狂暴，移速和攻击速度大幅提升，并会同时使用阶段一和阶段二的所有技能，将舞台变为一片弹幕的海洋。

*   **击败奖励:** 解锁“手动施法”槽位，允许玩家将法术配置到快捷键，进行更精准、更高频率的即时施法。
