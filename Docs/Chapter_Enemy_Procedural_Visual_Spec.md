# 《Project Harmony》章节特色敌人程序化视觉实现规范

**作者：** Manus AI
**版本：** 1.0
**日期：** 2026年2月12日
**关联 Issues：** #67, #68, #69
**关联文档：**
- [《角色设计概念提案》](./Character_Design_Concept.md)
- [《美术与VFX方向》](./Art_And_VFX_Direction.md)
- [《美术实现框架》](./ART_IMPLEMENTATION_FRAMEWORK.md)
- [《敌人系统设计》](./Enemy_System_Design.md)

---

## 目录

1. [概述](#1-概述)
2. [第四章：小步舞曲舞者 (Minuet Dancer)](#2-第四章小步舞曲舞者-minuet-dancer)
3. [第五章：狂怒精魂 (Fury Spirit)](#3-第五章狂怒精魂-fury-spirit)
4. [第六章：摇摆贝斯 (Walking Bass)](#4-第六章摇摆贝斯-walking-bass)
5. [Shader 清单与参数说明](#5-shader-清单与参数说明)
6. [场景文件清单](#6-场景文件清单)
7. [性能预算](#7-性能预算)

---

## 1. 概述

本文档定义了第四、五、六章特色敌人的**纯程序化视觉实现方案**。所有视觉元素均由代码、数学和 Shader 程序化生成，不使用任何位图资源，完全遵循项目的核心美学原则——"科幻神学 / 极简几何 / 故障艺术"。

### 1.1 设计原则

| 原则 | 说明 |
| :--- | :--- |
| **零位图** | 所有视觉元素由 `Polygon2D`、`Line2D`、`ShaderMaterial` 程序化生成 |
| **音乐驱动** | 视觉效果与节拍系统 (`BeatManager`) 和音乐强度深度绑定 |
| **故障美学** | 继承 `enemy_base.gd` 的故障视觉系统，HP 越低故障越严重 |
| **章节特色** | 每个敌人的视觉语言与其所在章节的音乐时代紧密对应 |

---

## 2. 第四章：小步舞曲舞者 (Minuet Dancer)

### 2.1 视觉概念

小步舞曲舞者是古典主义对称之美的具象化，其视觉核心是一个**洛可可风格的烛台几何体**。永远成对出现，移动轨迹保持完美的镜像对称。

### 2.2 程序化几何体结构

烛台由以下四个层次的 `Polygon2D` 程序化生成：

| 层次 | 节点类型 | 描述 |
| :--- | :--- | :--- |
| 底座 | `Polygon2D` (16边椭圆) | 宽椭圆形底座，颜色较深 |
| 柱身 | `Polygon2D` (参数化曲线) | 收腰杯形轮廓，20段采样的洛可可曲线 |
| 装饰卷曲 | `Polygon2D` × 3 | 左右对称的C形卷曲 + 顶部星形花饰 |
| 火焰 | `Polygon2D` + 光晕 | 顶部的动态火焰，带闪烁和色彩脉动 |

### 2.3 旋风光粒子 VFX

旋转攻击（第一拍强拍）时，烛台几何体隐藏，激活由 24 个菱形粒子组成的**金色光屑旋风**：

- 每个粒子沿螺旋轨道运动，半径随时间收缩/展开
- 粒子自身旋转并带有闪烁效果
- 旋风展开时有缩放动画（0.3 → 1.0）
- 无敌帧期间受击时粒子闪白提示

### 2.4 镜像对称 AI

- **领舞**：追踪玩家，加入 3/4 拍的圆弧运动和螺旋趋近
- **跟舞**：以玩家为中心，精确镜像领舞的位置
- **连接线**：领舞绘制贝塞尔曲线连接线，随舞步脉动

### 2.5 色彩方案

| 状态 | 领舞色彩 | 跟舞色彩 |
| :--- | :--- | :--- |
| 正常 | `Color(0.95, 0.88, 0.92)` 银粉 | `Color(0.92, 0.88, 0.78)` 淡金 |
| 狂暴 | `Color(1.0, 0.3, 0.3)` 红色 | `Color(1.0, 0.3, 0.3)` 红色 |
| 旋风粒子 | `Color(1.0, 0.92, 0.6)` 金色光屑 | 同左 |

---

## 3. 第五章：狂怒精魂 (Fury Spirit)

### 3.1 视觉概念

狂怒精魂是贝多芬狂暴激情的具象化，其视觉核心是一个**不定形的闪电粒子云**，中心有一个**脉动的心脏核心**。形态随 BGM 强度实时变化。

### 3.2 程序化视觉结构

| 层次 | 节点类型 | 描述 |
| :--- | :--- | :--- |
| 粒子云 | `Polygon2D` × 40 | 不规则多边形粒子，噪声驱动的位置 |
| 核心球体 | `Polygon2D` (16边) | 心跳脉动的中心球体 |
| 核心光晕 | `Polygon2D` (24边) | 低透明度的外层光晕 |
| 闪电触须 | `Line2D` × 4-6 | 程序化分形闪电路径 |
| 电弧轨迹 | `Line2D` (动态生成) | 冲刺时留下的电弧残影 |

### 3.3 音乐强度驱动系统

`music_intensity` 参数（0.0 ~ 1.0）由 `AudioManager` 提供，影响以下视觉属性：

| 属性 | 低强度 (0.0) | 高强度 (1.0) |
| :--- | :--- | :--- |
| 粒子云半径 | 基础 × 0.6 | 基础 × 1.3 |
| 粒子运动速度 | 基础 × 0.3 | 基础 × 1.5 |
| 闪电触须长度 | 基础 × 0.3 | 基础 × 1.2 |
| 闪电刷新频率 | 150ms | 40ms |
| 核心脉动速度 | 基础 × 0.8 | 基础 × 2.0 |
| 随机闪电概率 | 0.5% | 0.75% |

### 3.4 状态机与视觉变化

| 状态 | 视觉效果 |
| :--- | :--- |
| IDLE | 正常粒子云 + 闪电触须 |
| CHARGING | 粒子向核心收缩，核心变亮变大，触须收缩变白 |
| DASHING | 全身闪白，生成电弧轨迹，释放闪电爆发 |
| RECOVERING | 视觉逐渐恢复正常 |

---

## 4. 第六章：摇摆贝斯 (Walking Bass)

### 4.1 视觉概念

摇摆贝斯是爵士乐行走贝斯线的具象化，其视觉核心是一个由**霓虹灯管**构成的低音提琴轮廓，颜色沿布鲁斯音阶流动。

### 4.2 程序化几何体结构

| 层次 | 节点类型 | 描述 |
| :--- | :--- | :--- |
| 内部填充 | `Polygon2D` | 暗色半透明的提琴形状填充 |
| 霓虹辉光 | `Line2D` (closed) | 宽线条、低透明度的外层辉光 |
| 霓虹轮廓 | `Line2D` (closed) | 窄线条、高亮度的灯管轮廓 |
| 琴弦 | `Line2D` × 4 | 带振动效果的琴弦 |
| f孔 | `Polygon2D` × 2 | 简化的 f 形音孔 |

### 4.3 流动色彩系统

使用 6 色布鲁斯音阶调色板，通过 `Gradient` 沿提琴轮廓流动：

| 音阶度数 | 颜色名称 | 色值 |
| :--- | :--- | :--- |
| 根音 | 电蓝 | `Color(0.0, 0.8, 1.0)` |
| 小三度 | 霓虹粉 | `Color(0.9, 0.2, 0.8)` |
| 四度 | 琥珀 | `Color(1.0, 0.6, 0.0)` |
| 五度 | 霓虹绿 | `Color(0.2, 1.0, 0.4)` |
| 小七度 | 霓虹红 | `Color(1.0, 0.1, 0.3)` |
| 蓝调音 | 霓虹紫 | `Color(0.6, 0.3, 1.0)` |

### 4.4 音符符号轨迹 VFX

每到达一个路径节点时，生成一个发光的音符符号：

- **四分音符**：实心椭圆音符头 + 符杆
- **八分音符**：音符头 + 符杆 + 符尾旗帜
- **低音谱号**：简化的 C 形曲线 + 两个点

音符使用当前流动色彩着色，带有上浮淡出动画。

### 4.5 摇摆律动

- **强拍**：提琴纵向压缩（1.3, 0.8），琴弦闪白
- **反拍**：提琴横向压缩（0.8, 1.2），霓虹轮廓加宽，色彩偏暖
- **持续摇摆**：三连音律动的左右摇摆 + 倾斜

---

## 5. Shader 清单与参数说明

### 5.1 `minuet_dancer_rococo.gdshader`

用于小步舞曲舞者的洛可可烛台视觉增强。

| 参数 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `gold_shimmer_speed` | float | 2.0 | 金色光泽闪烁速度 |
| `gold_shimmer_intensity` | float | 0.3 | 金色光泽强度 |
| `flame_glow_radius` | float | 0.3 | 火焰辉光半径 |
| `flame_glow_intensity` | float | 1.0 | 火焰辉光强度 |
| `is_enraged` | float | 0.0 | 狂暴模式 (0/1) |
| `is_spinning` | float | 0.0 | 旋转模式 (0/1) |

### 5.2 `fury_spirit_lightning.gdshader`

用于狂怒精魂的闪电云体视觉。

| 参数 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `music_intensity` | float | 0.5 | 音乐强度 (由 AudioManager 驱动) |
| `charge_progress` | float | 0.0 | 蓄力进度 (0~1) |
| `lightning_frequency` | float | 8.0 | 闪电闪烁频率 |
| `lightning_brightness` | float | 1.5 | 闪电亮度 |
| `arc_glow_intensity` | float | 1.0 | 电弧辉光强度 |
| `core_pulse_speed` | float | 3.0 | 核心脉动速度 |
| `noise_scale` | float | 15.0 | 噪声纹理缩放 |

### 5.3 `walking_bass_neon.gdshader`

用于摇摆贝斯的霓虹灯管视觉。

| 参数 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `color_flow_speed` | float | 2.0 | 色彩流动速度 |
| `neon_glow_intensity` | float | 1.5 | 霓虹辉光强度 |
| `neon_flicker_speed` | float | 5.0 | 霓虹闪烁速度 |
| `smoke_density` | float | 0.3 | 烟雾密度 (爵士氛围) |
| `is_offbeat` | float | 0.0 | 反拍状态 (0/1) |

---

## 6. 场景文件清单

| 场景文件 | 敌人 | 脚本 | Shader |
| :--- | :--- | :--- | :--- |
| `ch4_minuet_dancer.tscn` | 小步舞曲舞者 | `ch4_minuet_dancer.gd` | `minuet_dancer_rococo.gdshader` |
| `ch5_fury_spirit.tscn` | 狂怒精魂 | `ch5_fury_spirit.gd` | `fury_spirit_lightning.gdshader` |
| `ch6_walking_bass.tscn` | 摇摆贝斯 | `ch6_walking_bass.gd` | `walking_bass_neon.gdshader` |

---

## 7. 性能预算

| 敌人 | 同屏最大数量 | 每个实例节点数 | 粒子/线段数 | 预估 Draw Call |
| :--- | :--- | :--- | :--- | :--- |
| 小步舞曲舞者 | 4对 (8个) | ~35 | 24 旋风粒子 | ~280 |
| 狂怒精魂 | 6 | ~55 | 40 云粒子 + 6 触须 | ~330 |
| 摇摆贝斯 | 8 | ~20 | 动态音符轨迹 | ~160 |

所有敌人均继承 `enemy_base.gd` 的量化移动系统，通过降低量化帧率（12-14 FPS）减少每帧的位置更新计算。Shader 均为 `canvas_item` 类型，在 2D 管线中运行，不增加 3D 渲染负担。
