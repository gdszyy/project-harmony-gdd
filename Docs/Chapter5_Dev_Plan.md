# 《Project Harmony》第五章开发计划：印象派织梦师·德彪西

**文档目的：** 本文档为《Project Harmony》第五章“印象派织梦师·德彪西”提供详细、可执行的开发计划。本章将探索“印象主义音乐”的朦胧、流动的特质，核心聚焦于“区域控制”、“环境伤害”和“形态切换”机制。

**核心目标：** 引入“迷雾”（Mist）和“倒影”（Reflection）两种新的环境/敌人机制，并围绕它们设计一个如梦似幻、充满氛围感的Boss战。

---

## 1. 章节设计：流动的音画

第五章的主题是“氛围与色彩”。灵感来源于德彪西音乐中打破传统和声、注重音色与和声色彩的特点。战斗将不再是点对点的精确打击，而更多是在大片模糊、危险的区域中寻找安全的“色彩”。

### 1.1. 章节时间线 (第五章)

BPM 较慢，在 90-100 之间，营造一种朦胧、梦幻的氛围。

```
[章节开始 BPM=90]
│
├─ 【剧本】波次 5-1：无形之雾 (教学波, ~50s)
│   └─ 场地被“减速迷雾”覆盖，教学玩家在其中移动和战斗
│
├─ [随机流恢复] 波次 1~2 (随机, enemy_pool: static, pulse, ~70s)
│
├─ 【剧本】波次 5-2：水中倒影 (教学波, ~50s)
│   └─ 出现“倒影”敌人，教学其与本体的联动和击杀方式
│
├─ [随机流恢复] 波次 3~4 (随机, ~70s)
│
├─ 【剧本】波次 5-3：雾中之舞 (练习波, ~60s)
│   └─ 在迷雾中同时应对多个“倒影”敌人
│
├─ [随机流恢复] 波次 5~6 (随机, BPM=100, ~60s)
│
├─ 【剧本】波次 5-4：月光奏鸣 (考试波, ~80s)
│   └─ 场地在“迷雾”和“澄澈”间切换，敌人行为随之改变
│
├─ [Boss 前冲刺] 波次 7 (随机, pre_boss, 高密度, ~30s)
│
└─ 【Boss 战】印象派织梦师·德彪西
```

---

## 2. 核心系统改造

*   **环境系统:** 需要一个全局的“环境管理器”，能够改变整个战场的属性，如施加“迷雾”效果（减速、视野模糊）。
*   **敌人AI:** 敌人需要能够响应“环境变化”事件，在不同环境下切换行为模式。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **环境效果** | `AtmosphericMist.tscn` | 全屏的、流动的、半透明的雾气效果。 | **高** |
| **敌人模型** | `Reflection.tscn` | 玩家或敌人的半透明镜像，会模仿本体的动作。 | **高** |
| **Boss模型** | `Boss_Debussy.tscn` | 一个由流光、水波和月影构成的抽象人形，没有固定形态。 | **极高** |
| **Shader** | `Watercolor.gdshader` | Boss战背景，将整个游戏画面渲染成水彩画的风格。 | **高** |
| **数据资源** | `wave_5_1.tres` ~ `wave_5_4.tres` | 4个新的 `WaveData` 剧本文件。 | **高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 新机制与敌人实现 (预计 3 天)

*   [ ] **Task 1.1**: 创建 `EnvironmentManager.gd`，实现施加和移除全局环境效果的功能。
*   [ ] **Task 1.2**: 创建 `Reflection.gd` 脚本，实现其锁定目标、模仿动作和传递伤害的逻辑。
*   [ ] **Task 1.3**: 修改敌人基类，增加 `_on_environment_changed()` 回调函数。
*   [ ] **Task 1.4**: **(集成测试)** 验证迷雾效果和倒影敌人的行为正确。

### Milestone 2: 剧本波次实现 (预计 2 天)

*   [ ] **Task 2.1**: 创建 `wave_5_1.tres` 至 `wave_5_4.tres` 四个剧本文件。
*   [ ] **Task 2.2**: 在 `ChapterData.gd` 中配置第五章的 `scripted_waves` 调度表。
*   [ ] **Task 2.3**: **(集成测试)** 完整运行第五章，感受其独特的氛围和战斗节奏。

### Milestone 3: Boss 战实现 (预计 4 天)

*   [ ] **Task 3.1**: 创建 `boss_debussy.gd` 脚本。
*   [ ] **Task 3.2**: **(核心难点)** 实现Boss在“水中之月”（地面形态）和“天上之云”（空中形态）之间的无缝切换，两种形态拥有完全不同的攻击方式。
*   [ ] **Task 3.3**: 实现“全音阶滑奏”和“平行和弦”等符合印象主义音乐特征的弹幕模式。
*   [ ] **Task 3.4**: **(最终测试)** 完整挑战并通过Boss战，体验这场如诗如画的战斗。

---

## 5. Boss 战详细设计：印象派织梦师·德彪西

*   **核心机制:** Boss拥有两种形态，并能主动改变战场环境，强迫玩家适应不同的战斗规则。

### 形态一：水中之月 (Moon in the Water)

*   **形态:** Boss化为地面上的一个巨大、发光的水中月影，玩家可以从其上方走过。
*   **攻击模式:**
    1.  **涟漪 (Ripples):** 从月影中心周期性地散发出一圈圈扩大的环形冲击波。
    2.  **倒影召唤 (Summon Reflections):** 在水面上生成玩家或场上其他敌人的“倒影”，倒影会模仿本体的攻击，但自身不受伤害，必须击败本体才能消除倒影。
    3.  **全音阶滑奏 (Whole-tone Glissando):** 从屏幕一侧向另一侧扫过一排密集的、伤害较低的“水珠”弹幕，弹幕的音高呈全音阶排列。

### 形态二：天上之云 (Clouds in the Sky) - HP < 50% 或特定时间切换

*   **形态:** Boss化为漂浮在空中的几朵“云”，无法被直接攻击。
*   **攻击模式:**
    1.  **亚麻色的雨 (Flaxen Hair's Rain):** “云”会降下持续的、覆盖大片区域的“酸雨”，在地面形成持续伤害的区域。
    2.  **平行和弦 (Parallel Chords):** 多朵“云”同时向地面发射平行的、长条形的弹幕，覆盖大片区域，玩家需要在弹幕的缝隙中穿行。
    3.  **牧神午后 (Afternoon of a Faun):** （终极技能）Boss召唤一个巨大的、缓慢追逐玩家的“牧神”幻影，幻影会持续施加催眠效果（减速、降低攻击频率），玩家必须持续移动以保持清醒，同时还要躲避其他“云”的攻击。

*   **击败奖励:** 解锁“和弦炼成”中的“挂留和弦”（Suspended Chord），允许玩家创造可以蓄力后发射的强力弹体。
