# 《Project Harmony》程序化场景实现方案

**作者：** Manus AI
**版本：** 1.0
**日期：** 2026年2月12日

**关联文档：** [《程序化场景架构规范》](./Procedural_Scene_Architecture.md)

---

## 1. 引言

本方案基于《程序化场景架构规范》中定义的七层模型和三类程序化元素，为游戏的七个章节逐一提供具体的、可落地的场景组合实现细节。方案严格遵守“无位图”原则，所有视觉效果均通过Shader、程序化几何体和GPU粒子驱动。

---

## 2. 第一章：毕达哥拉斯 · 光之神殿

**核心美学：** 古希腊数学和谐、黄金比例、几何纯粹、克拉尼图形

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 静谧星空 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用噪声函数生成缓慢闪烁的星星，色调偏暖黄。 |
| **-2: 远景层** | 巨大几何体剪影 | 程序化几何体 | `Polygon2D` | 随机生成巨大的正多面体（十二面体、二十面体）的剪影，以极慢速度旋转。 |
| **-1: 中景层** | 浮动几何粒子 | 程序化粒子 | `GPUParticles2D` | 少量、大型的半透明几何粒子（三角形、圆形）缓慢上升，模拟尘埃。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 克拉尼图形 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用已有的`chladni_ground.gdshader`，模拟沙粒在振动金属板上形成的和谐图案。 |
| **0: 游戏层** | 黄金比例螺旋障碍 | 程序化几何体 | `Line2D` | 场景中会周期性生成由`Line2D`构成的黄金比例螺旋，作为临时性的软性障碍物。 |
| **1: 前景层** | 光晕与弦振 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 一个覆盖全屏的、几乎透明的Shader，当玩家弹奏和谐和弦时，屏幕边缘会产生柔和的光晕和模拟琴弦振动的波纹。 |
| **2: VFX层** | 章节过渡 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用`transition_shader.gdshader`，通过噪声抖动效果从黑暗过渡到场景。 |

---

## 3. 第二章：圭多 · 哥特回响

**核心美学：** 中世纪宗教、哥特式建筑、玫瑰窗、神圣光芒

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 幽暗苍穹 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 深邃的、带有紫色和深蓝色调的渐变背景，模拟高耸教堂的穹顶阴影。 |
| **-2: 远景层** | 哥特式尖拱剪影 | 程序化几何体 | `Polygon2D` | 在远景中生成数个巨大的、静态的哥特式尖拱轮廓，营造庄严肃穆的氛围。 |
| **-1: 中景层** | 神圣光柱 | 程序化几何体 | `Line2D` | 从屏幕外上方斜射下来的、半透明的、体积感的动态光柱。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 玫瑰窗投影 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用已有的`rose_window_ground.gdshader`，在地面上投射出不断旋转变化的彩色玻璃玫瑰窗图案。 |
| **0: 游戏层** | 忏悔室墙壁 | 程序化几何体 | `Polygon2D` | 场景中会生成临时的、由`Polygon2D`构成的矩形墙壁，模拟忏悔室的狭小空间，限制玩家移动。 |
| **1: 前景层** | 飞舞的乐谱残片 | 程序化粒子 | `GPUParticles2D` | 少量方形粒子，模拟古老乐谱的残片在空气中缓慢盘旋飞舞。 |
| **2: VFX层** | 色彩偏移 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 引入轻微的色差（Chromatic Aberration）效果，模拟透过厚重玻璃观察的感觉。 |

---

## 4. 第三章：巴赫 · 巴洛克机械

**核心美学：** 巴洛克复调、机械宇宙、钟表齿轮、精确与秩序

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 精密星图 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 绘制精确的、网格化的星轨和星座图，而非随机星空，体现机械宇宙的秩序感。 |
| **-2: 远景层** | 巨型钟摆 | 程序化几何体 | `Polygon2D` | 一个或两个巨大的钟摆在远景中以精准的节拍（与BPM同步）缓慢摆动。 |
| **-1: 中景层** | 旋转的齿轮 | 程序化几何体 | `Polygon2D` | 大量不同大小、转速的齿轮在多个子层级中旋转，营造复杂的机械感。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 巴洛克式卷草纹 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 地面Shader应生成类似巴洛克时期繁复、对称的卷草纹或花纹图案，并随节拍流动。 |
| **0: 游戏层** | 节拍齿轮陷阱 | 程序化几何体 | `Polygon2D` | 场景中出现旋转的齿轮陷阱，其旋转与BPM同步，玩家需要在正确的时机穿过。 |
| **1: 前景层** | 黄铜质感微光 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 一个带有黄铜色调（`#DAA520`）的、低透明度的全屏Shader，为整个场景赋予温暖的金属质感。 |
| **2: VFX层** | 景深模糊 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用Shader模拟景深效果，使前景和远景的元素产生轻微的模糊，突出游戏层。 |

---

## 5. 第四章：莫扎特 · 洛可可水晶厅

**核心美学：** 洛可可式优雅、水晶吊灯、镜面反射、轻盈与嬉戏

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 柔和光晕 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 模拟一个被巨大水晶吊灯照亮的华丽大厅顶部，背景是柔和、弥散的光晕。 |
| **-2: 远景层** | 镜面回廊 | 程序化几何体 | `Polygon2D` | 用`Polygon2D`构建出无限延伸的镜面回廊的错觉，墙壁上有洛可可风格的S形和C形曲线装饰。 |
| **-1: 中景层** | 飘落的水晶/花瓣 | 程序化粒子 | `GPUParticles2D` | 闪亮的小六边形粒子，模拟水晶碎片或花瓣在空中优雅地飘落。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 水晶地面 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 地面Shader模拟高度抛光的水晶或大理石地面，能微弱地反射上方的光芒，并带有冰裂纹理。 |
| **0: 游戏层** | 假面舞会 | 程序化几何体 | `Polygon2D` | 场景中出现戴着假面的“幽灵”实体，它们不攻击玩家，但会以优雅的舞步移动，作为动态障碍物。 |
| **1: 前景层** | 镜头光晕 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 模拟摄像机镜头在强光下产生的六边形光晕（Lens Flare）效果，当玩家靠近“光源”时出现。 |
| **2: VFX层** | 饱和度提升 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 整体提高画面的饱和度和亮度，营造金碧辉煌、流光溢彩的宫廷氛围。 |

---

## 6. 第五章：贝多芬 · 浪漫风暴

**核心美学：** 浪漫主义、崇高、自然伟力、情感风暴、个人主义

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 雷暴云层 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用多层Simplex Noise生成翻滚的、厚重的云层。在节拍重音时，用纯白闪烁模拟闪电。 |
| **-2: 远景层** | 嶙峋山脉剪影 | 程序化几何体 | `Polygon2D` | 用分形算法生成崎岖、尖锐的山脉轮廓，静态地放置在远景，营造崇高感。 |
| **-1: 中景层** | 狂风暴雨 | 程序化粒子 | `GPUParticles2D` | 大量的、细长的粒子以极快的速度和倾斜的角度下落，模拟狂风中的暴雨。 |
| **0: 地面层** | 汹涌水面 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 用Shader模拟波涛汹涌的水面，有高光反射和扭曲效果，对水面下的图案（如有）产生折射。 |
| **0: 游戏层** | 阵风区域 | 物理区域 | `Area2D` | 场景中出现不可见的`Area2D`，通过`wind_force`属性持续向一个方向推动玩家和敌人，模拟阵风。 |
| **1: 前景层** | 镜头上的雨滴 | 程序化粒子 | `GPUParticles2D` | 随机在屏幕上生成少量大而半透明的圆形粒子，短暂存在后滑落或消失，模拟雨滴打在镜头上。 |
| **2: VFX层** | 情绪暗角 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 当玩家血量降低或Boss放大招时，屏幕边缘出现强烈的、动态脉冲的暗角（Vignette），增强压迫感。 |

---

## 7. 第六章：艾灵顿 · 装饰艺术俱乐部

**核心美学：** 爵士乐、摇摆即兴、装饰艺术（Art Deco）、都市夜生活

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 装饰艺术图案 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 生成典型的Art Deco风格图案：对称的几何线条、扇形、放射状光芒，并赋予金属质感（金、铜）。 |
| **-2: 远景层** | 都市剪影 | 程序化几何体 | `Polygon2D` | 绘制出带有发光窗户的摩天大楼剪影，营造出20世纪初繁华都市的夜景氛围。 |
| **-1: 中景层** | 袅袅烟雾 | 程序化粒子 | `GPUParticles2D` | 大而柔软的粒子缓慢上升、旋转、消散，模拟俱乐部里的烟雾。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 抛光舞池 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 模拟带有Art Deco镶嵌图案的高度抛光木质舞池，能微弱反射上方的光线和实体。 |
| **0: 游戏层** | 摇摆聚光灯 | 程序化Shader | `ShaderMaterial`参数 | 并非实体，而是通过修改地面Shader的参数，在地面上形成一个跟随节拍“摇摆”移动的圆形聚光灯区域。 |
| **1: 前景层** | 舞台灯光炫光 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 模拟舞台射灯造成的镜头炫光（Lens Flare），当玩家移动到特定角度时触发。 |
| **2: VFX层** | 老电影颗粒 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 叠加一层微弱的、动态的噪点，模拟老电影的胶片颗粒感，增加复古氛围。 |

---

## 8. 第七章：噪音 · 故障艺术空间

**核心美学：** 数字崩坏、故障艺术、数据洪流、系统错误、赛博朋克

| 层级 (Layer) | 元素 | 实现方式 | 关键技术/节点 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **-3: 天穹层** | 数字静电噪声 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 模拟老式电视无信号时的“雪花”或数字视频的压缩失真块，作为最底层的背景。 |
| **-2: 远景层** | 崩坏的UI窗口 | 程序化几何体 | `Polygon2D` | 巨大的、破碎的、内容错乱的“UI窗口”或代码片段在远景中堆叠、闪烁。 |
| **-1: 中景层** | 数据流瀑布 | 程序化几何体 | `Line2D` | 模拟“黑客帝国”风格的绿色代码雨，从上到下垂直流动。已在`ChapterVisualManager`中实现。 |
| **0: 地面层** | 数字矩阵 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 使用已有的`digital_matrix_ground.gdshader`，地面是流动的二进制代码和字符。 |
| **0: 游戏层** | 损坏扇区 | 程序化Shader | `ShaderMaterial`参数 | 地面Shader的参数被修改，在特定区域产生强烈的像素化、色彩分离等“损坏”效果，可能会对进入的实体产生减益。 |
| **1: 前景层** | 像素排序故障 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 周期性地在屏幕的随机行或列上触发像素排序（Pixel Sorting）的视觉故障，产生水平或垂直的拉伸线条。 |
| **2: VFX层** | 屏幕撕裂与块化 | 程序化Shader | `ColorRect` + `ShaderMaterial` | 最终的、最强烈的故障效果层。根据不和谐度，对整个游戏画面进行屏幕撕裂、块化（Datamoshing）和颜色通道分离。 |

---

## 9. 章节场景对比总览

以下表格从宏观视角对比七个章节的场景构成，帮助团队快速理解各章节的视觉差异化策略。

| 维度 | 第1章：毕达哥拉斯 | 第2章：圭多 | 第3章：巴赫 | 第4章：莫扎特 | 第5章：贝多芬 | 第6章：艾灵顿 | 第7章：噪音 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **主色调** | 暖黄/金 | 深紫/宝石蓝 | 黄铜/深棕 | 粉金/水晶白 | 深靛/闪电白 | 琥珀/霓虹 | 矩阵绿/故障红 |
| **天穹层** | 静谧星空 | 幽暗穹顶 | 精密星图 | 柔和光晕 | 雷暴云层 | Art Deco图案 | 数字静电 |
| **远景层** | 多面体剪影 | 哥特尖拱 | 巨型钟摆 | 镜面回廊 | 嶙峋山脉 | 都市剪影 | 崩坏UI窗口 |
| **中景层** | 浮动几何粒子 | 神圣光柱 | 旋转齿轮 | 水晶/花瓣 | 狂风暴雨 | 袅袅烟雾 | 数据流瀑布 |
| **地面层** | 克拉尼图形 | 玫瑰窗投影 | 巴洛克卷草纹 | 水晶地面 | 汹涌水面 | Art Deco舞池 | 数字矩阵 |
| **游戏层机制** | 黄金螺旋障碍 | 忏悔室墙壁 | 节拍齿轮陷阱 | 假面舞会 | 阵风区域 | 摇摆聚光灯 | 损坏扇区 |
| **前景层** | 弦振光晕 | 乐谱残片 | 黄铜微光 | 镜头光晕 | 镜头雨滴 | 舞台炫光 | 像素排序 |
| **VFX层** | 章节过渡 | 色差效果 | 景深模糊 | 饱和度提升 | 情绪暗角 | 老电影颗粒 | 屏幕撕裂 |
| **情绪曲线** | 宁静→启蒙 | 庄严→敬畏 | 精密→沉思 | 轻盈→嬉戏 | 激昂→崇高 | 慵懒→即兴 | 混沌→对抗 |
| **动态强度** | ★★☆☆☆ | ★★☆☆☆ | ★★★☆☆ | ★★★☆☆ | ★★★★★ | ★★★☆☆ | ★★★★★ |

---

## 10. 实施路线图

### 第一阶段：基础框架（1-2周）

第一阶段的核心目标是搭建七层模型的基础设施，使得后续的章节内容填充可以在一个稳定的框架上进行。具体工作包括：在`main_game.tscn`中创建所有`CanvasLayer`节点和容器节点，实现`ParallaxController`脚本并验证视差效果，实现`ProceduralGeometry`工具类的所有基础形状生成函数，以及创建`ChapterSceneConfig`资源类型和`ChapterSceneBuilder`的骨架代码。

### 第二阶段：核心章节实现（2-3周）

第二阶段聚焦于实现视觉差异最大的三个章节——第1章（毕达哥拉斯）、第5章（贝多芬）和第7章（噪音）。这三个章节分别代表了"宁静和谐"、"激烈风暴"和"数字混沌"三种极端的视觉状态，实现它们可以验证框架的灵活性。具体工作包括：实现3个天穹层Shader（P0优先级），实现4个地面层Shader（第3、4、5、6章的地面Shader），以及为这三个章节创建完整的`ChapterSceneConfig`配置文件。

### 第三阶段：完善所有章节（2-3周）

第三阶段完成剩余四个章节的场景内容，并实现所有P1和P2优先级的Shader。具体工作包括：实现4个天穹层Shader（第2、3、4、6章），实现7个前景/VFX层Shader（P2优先级），以及为所有七个章节创建完整的配置文件并进行视觉调优。

### 第四阶段：优化与打磨（1-2周）

第四阶段聚焦于性能优化和视觉打磨。具体工作包括：实现P3优先级的4个Shader，进行性能分析并优化超出预算的Shader，调整各层的视差系数和透明度以获得最佳的深度感，以及确保章节过渡时所有层级的切换流畅无闪烁。

---

## 参考文献

[1] [Godot Engine Documentation - CanvasLayer](https://docs.godotengine.org/en/stable/classes/class_canvaslayer.html) — CanvasLayer节点的官方文档
[2] [Godot Engine Documentation - CanvasItem Shaders](https://docs.godotengine.org/en/stable/tutorials/shaders/shader_reference/canvas_item_shader.html) — Canvas Item Shader参考
[3] [Godot Engine Documentation - GPUParticles2D](https://docs.godotengine.org/en/stable/classes/class_gpuparticles2d.html) — GPU粒子系统文档
[4] [Project Harmony - 技术美术蓝图](./ART_IMPLEMENTATION_FRAMEWORK.md) — 现有Shader体系与视觉管理器架构
[5] [Project Harmony - 美术与VFX方向](./Art_And_VFX_Direction.md) — 美术圣经与章节风格定义
