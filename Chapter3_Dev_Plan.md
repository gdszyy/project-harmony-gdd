_# 《Project Harmony》第三章开发计划：大构建师·巴赫

**文档目的：** 本文档为《Project Harmony》第三章“大构建师·巴赫”提供详细、可执行的开发计划。本章将聚焦于“结构”与“对位”的音乐概念，通过引入新的敌人“音墙”（Wall）的变体和赋格（Fugue）追逐的Boss战，为玩家带来一场充满建筑美感和逻辑解谜的战斗体验。

**核心目标：** 引入“建筑师音墙”（Architect Wall）和“反射棱镜”（Reflector Prism）两种新机制/敌人，并围绕它们设计一个充满空间解谜和逻辑性的Boss战。

---

## 1. 章节设计：音乐的建筑学

第三章的主题是“结构之美”，灵感来源于巴赫音乐中严谨的对位和赋格。整个章节的敌人和Boss设计都将围绕“建造”、“反射”和“结构化”展开。

### 1.1. 章节时间线 (第三章)

BPM 稳定在 110，营造一种庄严而富有逻辑性的氛围。

```
[章节开始 BPM=110]
│
├─ 【剧本】波次 3-1：建筑师之墙 (教学波, ~40s)
│   └─ 1 只 Architect Wall，教学其建造和路径阻挡特性
│
├─ [随机流恢复] 波次 1~2 (随机, enemy_pool: static, wall, architect_wall, ~60s)
│
├─ 【剧本】波次 3-2：反射棱镜 (教学波, ~45s)
│   └─ 2 只 Reflector Prism，教学其弹幕反射机制
│
├─ [随机流恢复] 波次 3~4 (随机, ~60s)
│
├─ 【剧本】波次 3-3：迷宫构造 (练习波, ~60s)
│   └─ 2 Architect Wall + 3 Reflector Prism，练习在复杂结构中战斗
│
├─ [随机流恢复] 波次 5~6 (随机, ~50s)
│
├─ 【剧本】波次 3-4：结构解谜 (考试波, ~70s)
│   └─ 综合利用反射和墙体摧毁，解决一个小型“弹幕迷宫”
│
├─ [Boss 前冲刺] 波次 7 (随机, pre_boss, 高密度, ~30s)
│
└─ 【Boss 战】大构建师·巴赫
```

---

## 2. 核心系统改造

*   **弹幕系统:** 需要增加“可反射”属性和“所有者”标识，以实现棱镜的反射机制，并防止玩家被自己的子弹伤害。

---

## 3. 美术与资源清单

| 类型 | 资源名称 | 描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **敌人模型** | `ArchitectWall.tscn` | 能够在其身后生成半透明能量墙的特殊“音墙”。 | **高** |
| **敌人模型** | `ReflectorPrism.tscn` | 旋转的水晶棱镜，能将玩家的弹幕以特定角度反射出去。 | **高** |
| **Boss模型** | `Boss_Bach.tscn` | 一个巨大的、由管风琴和建筑蓝图构成的几何构造体。 | **极高** |
| **Shader** | `BlueprintGrid.gdshader` | Boss战背景，动态生成的蓝色建筑网格，带有对位线条。 | **高** |
| **数据资源** | `wave_3_1.tres` ~ `wave_3_4.tres` | 4个新的 `WaveData` 剧本文件。 | **高** |

---

## 4. 开发任务分解 (Milestones)

### Milestone 1: 新机制与敌人实现 (预计 3 天)

*   [ ] **Task 1.1**: 改造弹幕基类，增加 `is_reflectable` 和 `owner` 属性。
*   [ ] **Task 1.2**: 创建 `ArchitectWall.gd` 脚本，实现其建造能量墙的行为。
*   [ ] **Task 1.3**: 创建 `ReflectorPrism.gd` 脚本，实现弹幕反射逻辑。
*   [ ] **Task 1.4**: **(集成测试)** 验证新敌人的行为和弹幕反射机制的正确性。

### Milestone 2: 剧本波次实现 (预计 2 天)

*   [ ] **Task 2.1**: 创建 `wave_3_1.tres` 至 `wave_3_4.tres` 四个剧本文件。
*   [ ] **Task 2.2**: 在 `ChapterData.gd` 中配置第三章的 `scripted_waves` 调度表。
*   [ ] **Task 2.3**: **(集成测试)** 完整运行第三章，确保所有波次按预期进行。

### Milestone 3: Boss 战实现 (预计 4 天)

*   [ ] **Task 3.1**: 创建 `boss_bach.gd` 脚本。
*   [ ] **Task 3.2**: **(核心难点)** 实现Boss的“赋格追逐”机制，即多个声部（弹幕发射器）按时间依次进入，形成复杂的弹幕对位。
*   [ ] **Task 3.3**: 实现Boss的“卡农墙”和“圣咏盾”机制。
*   [ ] **Task 3.4**: **(最终测试)** 完整挑战并通过Boss战，感受其如同解开精密建筑般的战斗体验。

---

## 5. Boss 战详细设计：大构建师·巴赫

*   **核心机制:** Boss本身是一个固定的“建筑核心”，通过在场上召唤和操纵各种“建筑构件”（如音墙、棱镜、弹幕发射器）来攻击玩家。

### 阶段一：主题呈现 (Theme Exposition)

*   **HP:** 1200
*   **攻击模式:**
    1.  **主题一 (Subject 1):** Boss召唤一个弹幕发射器，以固定模式发射弹幕（赋格的主题）。
    2.  **对题 (Answer):** 在另一个位置（通常是五度关系的位置）召唤第二个发射器，以移调的方式重复主题一的弹幕模式。
    3.  **卡农墙 (Canon Wall):** 召唤两堵平行的 Architect Wall，它们会同步移动，压缩玩家的战斗空间。

### 阶段二：展开部 (Development) - HP < 50%

*   **HP:** 1800 (恢复)
*   **新机制:**
    1.  **逆行 (Retrograde):** 召唤一个发射器，以“倒放”的方式发射主题一的弹幕。
    2.  **倒影 (Inversion):** 召唤一个发射器，其弹幕模式与主题一在垂直方向上呈镜像关系。
    3.  **圣咏盾 (Chorale Shield):** Boss自身被四块缓慢旋转的、无敌的“音墙碎片”保护，玩家必须在碎片间的空隙进行攻击。
    4.  **赋格迷宫 (Fugue Maze):** （终极技能，HP<20%）Boss在场地中用能量墙构建一个小型迷宫，同时多个“声部”发射器在迷宫中生成弹幕，玩家需要在躲避的同时找到并摧毁迷宫的“结构弱点”。

*   **击败奖励:** 解锁“节奏型”系统，允许玩家在序列器中应用附点、切分等节奏，改变弹体的行为模式。
