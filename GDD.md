# 游戏设计文档：Project Harmony

**作者：** Manus AI (根据 gdszyy 的创意与反馈迭代)
**版本：** 1.1 (Live Document)
**最后更新：** 2026年2月9日

---

## 1. 游戏概述 (Game Overview)

### 1.1. 核心概念 (High Concept)

**Project Harmony** 是一款将音乐理论与魔法系统深度结合的幸存者类（Survivor-like）肉鸽（Roguelike）游戏。在这个游戏中，玩家的每一次法术施放和组合，都在实时创作一首乐曲。游戏的核心平衡与资源管理，完全基于“音乐性”的内在逻辑，为玩家带来一种前所未有的、在战斗中进行音乐创作的独特体验。

### 1.2. 设计支柱 (Core Pillars)

- **音乐即编程 (Music as Programming):** 游戏摒弃了传统的预设技能，将音符、和弦、节奏作为构建法术的参数与函数，玩家通过“编曲”来“编程”自己的战斗方式。
- **听感即平衡 (Aesthetics as Balance):** 利用人类对音乐和谐与不和谐的直观感受，构建了一套内在的、符合直觉的资源与风险管理系统。
- **战斗即创作 (Combat as Composition):** 将游戏过程升华为一场从无序、刺耳的噪音到和谐、悦耳的乐章的音乐创作之旅，玩家每一轮的战斗都将谱写出独一无二的乐曲。

---

## 2. 音频设计 (Audio Design)

Project Harmony 的音频设计是游戏体验的核心支柱之一，它将“和谐 vs. 噪音”的对立概念深度融入玩法与反馈系统。

### 2.1. 核心哲学

- **玩家 = 和谐 (Harmony):** 玩家的法术音效以钢琴、合成器和弦等乐音为主，创造悦耳、符合乐理的音乐，提供积极、正向的反馈。
- **敌人 = 噪音 (Noise):** 敌人的音效被设计为“错误的信号”或“损坏的音频”，如数据错误、电流干扰或机械故障，制造冲突感与压迫感。

### 2.2. 背景音乐 (BGM)

- **风格选型:** 选用 **Minimal Techno / Glitch Techno** 作为核心 BGM 类型。其稳定的 4/4 拍 Kick (底鼓) 为节奏同步战斗提供了天然、精准的节拍器，同时其机械感与科幻、故障艺术的美术风格完美契合。
- **技术实现:** BGM 系统由 `BGMManager` 全局单例管理，负责音乐的播放、BPM 同步和场景切换。所有 BGM 输出到 `Music` 音频总线，该总线挂载 `AudioEffectSpectrumAnalyzer` 效果器，用于提取节拍能量以驱动视觉效果。

### 2.3. 敌人音效

- **声音风格:** 敌人的移动、受击、死亡等行为，分别对应机械卡顿、数据丢失 (Bitcrush)、信号崩溃 (Glitch Burst) 等噪音风格，与玩家的和谐音效形成强烈对比。
- **技术实现:** 采用 `AudioManager` 全局单例，通过**信号驱动机制**实现。敌人脚本在创建时将自身信号注册到管理器，由管理器监听信号并从**对象池**中获取播放器播放对应的**程序化生成**的音效。此架构实现了高度解耦和高性能。

### 2.4. 详细设计

关于音频系统的完整设计哲学、BGM 选型依据、程序化音效生成方法、音频总线配置以及代码实现架构，请参阅详细的 **[音频设计与实现指南](Docs/Audio_Design_Guide.md)**。

---

## 3. 核心游戏机制 (Core Gameplay Mechanics)

### 3.1. 节奏同步战斗 (Rhythmic Combat)

游戏中的所有“弹幕发射”（即法术施放）都将严格遵循一个全局的音乐节拍（如4/4拍）。游戏将采用节奏感强烈的音乐类型作为背景，其稳定且清晰的鼓点将作为玩家行动的节拍器，所有法术的触发时点都将自动对齐到这些节拍上。

### 3.2. "单音寂静" — 三维惩罚模型

取代了传统的冷却时间或法力值，这是一个基于“音乐多样性”的资源系统，包含三个维度：

| 维度 | 触发原因 | 惩罚 | 消解方式 |
|---|---|---|---|
| **单调值** | 重复同一音符 | 该音符进入"寂静"，暂时禁用 | 使用不同音符；适度不和谐也可缓解 |
| **密度值** | 音符堆太满，没有呼吸感 | "噪音过载"Debuff，降低精准度 | 编入休止符，留出空拍 |
| **不和谐值** | 使用不和谐法术 | 直接扣血（生命腐蚀） | 施放和谐法术或"解决和弦" |

**关键交互：** 不和谐音是双刃剑——它会扣血，但因为引入了变化，可以有效降低**单调值**。

### 3.3. 音符经济系统 (Note Economy)

音符在本游戏中是一种**消耗品资源**，而非永久可用的工具。玩家拥有一个"音符库存"（概念上类似弹药库），每种白键音符（C, D, E, F, G, A, B）各自独立堆叠并显示数量。游戏开始时，玩家将获得一套基础的音符组合作为初始资源。

音符的获取途径主要有两种：其一，通过**升级奖励**获得（每次升级可获得一个随机音符，或通过升级选项获得指定音符）；其二，特定精英敌人在死亡时有几率掉落可拾取的"音符晶片"。

音符在其生命周期中存在三种状态：**装备**（从库存放入法术槽，库存数量减一）、**卸下**（从法术槽移除，安全返回库存）、以及**永久消耗**（仅在和弦炼成时发生，作为原材料被不可逆地消耗）。

音符经济系统的完整实现包含以下核心组件：**音符库存** (`NoteInventory`) 管理所有音符的持有与消耗；**和弦炼成台** (`ChordAlchemyPanel`) 提供合成和弦法术的专用界面；**法术书** (`SpellbookUI`) 存放所有已合成的和弦法术。初始设计提案已归档至 **[Archive/Design_Update_Proposal_v1.md](Docs/Archive/Design_Update_Proposal_v1.md)**。

### 3.4. 双模施法系统

- **自动施法**：4小节×4拍的"乐谱序列器"，战斗前编排，战斗中自动执行。每拍可放一个音符（从库存中装备），或整小节放一个和弦法术（从法术书中装备），也可编入休止符。
- **手动施法**：3个快捷键（`1`, `2`, `3`），对齐到**八分音符**精度（每小节8个施法时机），用于精准释放强力法术。玩家可从音符库存或法术书中，将法术拖拽到HUD上的手动施法槽完成配置。

### 3.5. 频谱相位系统：共鸣切片 (Resonance Slicing)

频谱相位系统是游戏的核心战斗解谜机制，将玩家的角色从"作曲家"提升至"混音师"。在这个设定中，所有物体（敌人、子弹、地形）本质上都是高维的"复合声波"，玩家所在的游戏画面只是这团复杂声波的一个"频率切片"。玩家可以在**高通相位 (Overtone)**、**全频相位 (Fundamental)** 和**低通相位 (Sub-Bass)** 三种模式之间瞬间切换，从而改变战场上所有物体的形态、行为和威胁类型。

| 相位 | 视觉风格 | 玩家修正 | 核心玩法 |
| :--- | :--- | :--- | :--- |
| **高通 (Overtone)** | 明亮、线框化、冷色调 | 移速+30%，受伤+20% | 规避低频弹幕，刺杀高频弱点 |
| **低通 (Sub-Bass)** | 暗沉、液态化、暖色调 | 霸体，受伤-50%，无法冲刺 | 硬抗高频攻击，破盾低频护甲 |
| **全频 (Fundamental)** | 原始美术风格 | 无修正，能量恢复最快 | 恢复相位能量，观察战场全局 |

该系统与听感疲劳系统 (AFI) 深度绑定：切换和维持极端相位会消耗"**相位能量**"，而相位能量的恢复速度与 AFI 负相关——演奏得更富于变化的玩家能更频繁地使用相位切换。此外，长时间停留在极端相位会积累"**频谱偏移疲劳**"（AFI 的第九维度），强制玩家将极端相位作为战术爆发手段而非持续状态。

详细设计请参阅 **[频谱相位系统设计文档](Docs/ResonanceSlicing_System_Design.md)**。

---

## 4. 法术构建系统 (Spellcraft System)

### 4.1. 白键音符：四维参数弹体

每个白键音符代表一种具有独特属性配比的**基础弹体**。四维总和恒定为**12**。

> **四维参数：** 伤害(DMG), 飞行速度(SPD), 持续时间(DUR), 弹体大小(SIZE)

| 音符 | DMG | SPD | DUR | SIZE | 特点 |
|---|---|---|---|---|---|
| C | 3 | 3 | 3 | 3 | 均衡型 |
| D | 2 | **5** | 3 | 2 | 极速远程 |
| E | **1** | **1** | **4** | **6** | 巨型缓行（移动壁垒） |
| F | 2 | 1 | **6** | 3 | 超持久缓行（战场游魂） |
| G | **6** | 3 | 1 | 2 | 高伤快消（致命一击） |
| A | **4** | 2 | **4** | 2 | 持久高伤 |
| B | **4** | **4** | 2 | 2 | 高速高伤 |

> **设计哲学：** 基础音符是“原子”，其差异仅通过四维物理属性的极化来体现，不应拥有任何特殊机制。特殊机制（固定放置、区域DOT、天降打击等）是“分子”——和弦法术的专属领域。

### 4.2. 黑键音符：双重身份

黑键拥有两种截然不同的使用方式：

1.  **作为修饰符**：单独使用时，为下一个法术附加一次性效果。
    - **C#/Db (锐化):** 穿透
    - **D#/Eb (追踪):** 追踪
    - **F#/Gb (分裂):** 分裂
    - **G#/Ab (回响):** 回响
    - **A#/Bb (散射):** 散射

2.  **作为和弦构成音**：与白键组合，改变和弦的性质，进而改变法术的形态。

![黑键的双重身份](Assets/black_key_dual_role_v5.png)
*图1：黑键既可以作为独立的修饰符，也可以作为和弦的一部分来改变其类型。*

### 4.3. 和弦炼成：法术形态生成器

和弦法术通过"和弦炼成"系统创建：玩家在专门的"炼成台"界面中，将**3个或以上的音符**从库存中放入原材料槽，系统将自动识别其乐理类型并生成对应的和弦法术。合成后，原材料音符被**永久消耗**，而生成的和弦法术将被收入玩家的"法术书"中，可被放置到序列器的整个小节或手动施法槽中，移除时返回法术书而非被销毁。

和弦法术的形态由其**乐理类型**决定。

![和弦类型→法术形态映射](Assets/chord_spell_form_v5.png)
*图2：不同类型的和弦如何映射到截然不同的法术形态。*

| 和弦类型 | 法术形态 | 设计思路 |
| :--- | :--- | :--- |
| 大三和弦 | **强化弹体** | 稳定和谐 → 增强基础 |
| 小三和弦 | **DOT弹体** | 忧郁持续 → 持续伤害 |
| 增三和弦 | **爆炸弹体** | 膨胀扩张 → 范围爆炸 |
| 减三和弦 | **冲击波** | 收缩紧张 → 塌缩爆发 |
| 属七和弦 | **法阵/区域** | 需要“解决” → 持续存在 |
| 减七和弦 | **天降打击** | 极度不稳定 → 毁灭打击 |
| 大七和弦 | **护盾/治疗法阵** | 温暖丰满 → 保护 |
| 小七和弦 | **召唤/构造** | 深沉厚重 → 地面构造 |
| 挂留和弦 | **蓄力弹体** | 悬而未决 → 延迟释放 |

### 4.4. 和弦进行：泛化的功能函数

乐段效果由任意两个相邻和弦的**功能转换**决定，并引入**完整度奖励**。

![泛化和弦进行规律](Assets/generalized_progression_v5.png)
*图3：和弦功能之间的转换方向决定了触发效果的类型。*

| 功能转换 | 含义 | 触发效果类型 |
| :--- | :--- | :--- |
| **D → T** | **紧张到解决** | 爆发性的正面效果（如：**爆发治疗、全屏伤害**） |
| **T → D** | **稳定到紧张** | 蓄力或增伤效果（如：**下一个法术伤害翻倍**） |
| **PD → D** | **准备到紧张** | 加速或增幅效果（如：**全体冷却缩减**） |

-   **完整度奖励**：2和弦(x1.0) → 3和弦(x1.5) → 4和弦(x2.0)

### 4.5. 节奏型：小节级的行为模式

玩家在序列器中编排的**节奏型**，会直接改变该小节内所有弹体的**行为模式**。

| 节奏型 | 弹体行为修饰 |
| :--- | :--- |
| 均匀八分音符 | **[连射]** 弹体大小-1，但每拍发射2个。 |
| 附点节奏 | **[重击]** 飞行速度-1，但伤害+1，并获得击退。 |
| 切分节奏 | **[闪避射击]** 发射时，玩家向后微小位移。 |
| 摇摆节奏 | **[摇摆弹道]** S型/波浪形轨迹飞行。 |
| 三连音 | **[三连发]** 伤害50%，但每拍发射3个扇形弹体。 |
| 休止符 | **[精准蓄力]** 每有一个休止符，小节内其他弹体伤害和大小+0.5。 |

---

## 5. 敌人设计 (Enemy Design)

敌人的设计同样遵循"不和谐的具象化"原则，每一种敌人都代表一种特定的"音乐错误"或"音频故障"。在频谱相位系统的加持下，每种敌人在不同相位下将呈现截然不同的形态、行为和弱点，为战斗增添了解谜维度。

| 敌人类型 | 音乐隱喻 | 全频行为 | 高通形态 | 低通形态 |
|---|---|---|---|---|
| **Static (静电)** | 随机噪声 | 基础追踪敌人 | 缩小为光点，极快但脆弱 | 膨胀为减速雾团，无伤害 |
| **Pulse (脉冲)** | 错误节拍器 | 环形弹幕 | 弹幕变为瞬发激光 | 弹幕变为全屏震荡波 |
| **Screech (尖啸)** | 麦克风反馈音 | 快速冲刺 | 瞬移但极度脆弱 | 被重低音压制不动 |
| **Silence (寂静)** | 休止符 / 黑洞 | 静音光环增加疲劳 | 核心暴露可暴击 | 光环范围扩大，疲劳加倍 |
| **Wall (音墙)** | 砖墙限制器 | 带护盾缓慢推进 | 护盾消失但变快 | 不可摧毁但可作掩体 |

详细的敌人系统设计请参阅 **[敌人系统设计文档](Docs/Enemy_System_Design.md)** 及 **[频谱相位系统设计文档](Docs/ResonanceSlicing_System_Design.md)**。

---

## 6. 局内升级系统：五度圈罗盘 (Circle of Fifths Compass)

为了让升级选择过程更具音乐主题性，我们采用"五度圈罗盘"系统替代传统的"三选一卡片"界面。当玩家升级时，屏幕中央将展开一个包含12个刻度的圆盘（对应C, G, D, A, E, B, F#, C#, G#, D#, A#, F），中央的指针指向玩家当前的"音乐探索方向"。在指针所指及其相邻的两个音级（五度关系和四度关系）位置，将浮现三个升级选项。

玩家选择某个方向的升级后，指针将旋转到该音级上，影响下次升级时可选的方向与内容。不同方向具有不同的升级倾向性：

| 方向 | 调性走向 | 升级倾向 | 示例 |
| :--- | :--- | :--- | :--- |
| 向上五度（顺时针） | 更“明亮”的调 | **进攻性与伤害加成** | “G音符伤害+1”、“强化弹体效果+20%” |
| 向下五度（逆时针） | 更“柔和”的调 | **防御性、功能性与资源获取** | “获得一个随机音符”、“最大生命值+25” |
| 当前调性 | 停留在当前音级 | **当前核心音符的直接强化** | “C音符 DMG+0.5”、“当前调性和弦效果+15%” |

每次升级时，玩家还将自动获得一个随机音符加入库存，确保音符资源的稳定增长。

五度圈罗盘升级系统的完整实现由 `CircleOfFifthsUpgrade` 组件驱动，其核心逻辑包括：罗盘指针追踪、方向性升级池筛选、以及每次升级自动赠送随机音符。初始设计提案已归档至 **[Archive/Design_Update_Proposal_v1.md](Docs/Archive/Design_Update_Proposal_v1.md)**。

---

## 7. 美术与视觉效果 (Art & VFX)

Project Harmony 的美术风格与视觉效果是其核心“通感”体验的基石，旨在将抽象的音乐理论和游戏机制转化为直观、清晰且富有冲击力的视觉语言。整体美术方向遵循“抽象矢量主义 vs. 数字衰变”的双极美学体系，为“和谐”与“噪音”两大核心阵营赋予了截然不同的视觉呈现。

关于项目完整的美术顶层设计、全局色彩体系、七大章节的独立美术风格、Godot 渲染架构以及所有视觉元素的实现方案，请参阅详细的 **[《美术与VFX方向总文档》](Docs/Art_And_VFX_Direction.md)**。

对于法术系统超过60种效果的细粒度视觉设计规范，包括其七大效果层级的具体表现、交互反馈和技术实现细节，请参阅专项文档 **[《法术系统视觉增强设计文档》](Docs/Spell_Visual_Enhancement_Design.md)**。

---

## 8. 扩展性与长线设计

### 7.1. 角色/职业系统：基于调性与音阶

为了提供丰富的重玩价值和多样的游戏体验，可以将不同的“调性”（Key）或“音阶”（Scale）设计为不同的英雄角色或职业。例如，“C大调”英雄可能基础法术和谐悦耳，成长曲线平滑；而某个“布鲁斯音阶”英雄可能天生就拥有更多“不和谐”但潜力巨大的法术选项，玩法风格将截然不同。


---

## 8. 数值设计更新日志

本章节记录数值设计文档的重大更新，完整的数值设计请参阅 **[Numerical_Design_Documentation.md](Docs/Numerical_Design_Documentation.md)**。

### v2.2 (2026年2月11日)

**重设计：E/F/G音符四维参数极化与“原子 vs. 分子”设计哲学**

重新审视了基础音符与和弦法术的层级关系，解决了E/F/G音符与和弦法术的功能重叠和强度倒挂问题。

**核心改动：**
- **设计哲学重构**：音符是“原子”，差异仅通过四维物理属性极化体现；和弦是“分子”，拥有音符不具备的特殊机制。
- **转换比率调整**：DUR每点价值 0.5s→0.7s (+40%)，SIZE每点价值 8px→12px (+50%)。
- **E音符重定位**：(2,2,4,4)→(1,1,4,6)，定位从“大范围持久”重新定义为“巨型缓行（移动壁垒）”，半径从32px增至72px，面积扩大5.1倍。
- **F音符重定位**：(2,1,5,4)→(2,1,6,3)，定位从“区域控制”重新定义为“超持久缓行（战场游魂）”，存活时间从2.5s增至4.2s。
- **G音符重定位**：(5,3,2,2)→(6,3,1,2)，定位从“爆发伤害”重新定义为“高伤快消（致命一击）”，伤害从50增至60，存活从1.0s降至0.7s。
- **层级约束验证**：G音符(60) < G根音大三和弦(90) < G根音减七(180) < 终焉乐章(300)，层级递进完整。

**相关文档：**
- [数值设计文档 v2.2](Docs/Numerical_Design_Documentation.md)
- [法术视觉增强设计文档](Docs/Spell_Visual_Enhancement_Design.md) — 第1层音符美术指引更新

### 频谱相位系统 v1.0 (2026年2月10日)

**新增：共鸣切片 (Resonance Slicing) 核心战斗解谜机制**

引入了三相频谱切换系统，作为游戏的核心 Boss/敌人解谜玩法机制，与听感疲劳系统共同构成战斗的资源管理核心。

**核心内容：**
- **三相切换**：高通 (Overtone)、全频 (Fundamental)、低通 (Sub-Bass) 三种相位，每种拥有独特的视觉风格、玩家修正和战术优势。
- **敌人相位矩阵**：所有五种基础敌人均获得三相位形态，包含不同的体积、速度、弱点和行为模式。
- **相位能量系统**：新增独立能量条，切换和维持极端相位消耗能量，恢复速度与 AFI 负相关。
- **频谱偏移疲劳**：AFI 第九维度，防止滥用极端相位。
- **Boss 战整合**：与第七章“合成主脑”的波形战争、第三章“大构建师”的赋格迷宫等深度融合。
- **音色相位增益**：四大音色系别在对应相位下获得增益（弹拨→高通，打击→低通，拉弦→全频，吹奏→切换时）。

**相关文档：**
- [频谱相位系统设计文档](Docs/ResonanceSlicing_System_Design.md)

### v2.1 (2026年2月7日)

**新增：延迟与距离风险维度**

引入了对法术"延迟"和"短射程"的量化风险评估机制，使平衡性跑分系统能够验证"高风险法术用高伤害/大范围补偿"这一设计原则的落实情况。

**核心机制：**
- **延迟命中折扣**：延迟法术（如挂留和弦、减七和弦）的命中率采用反比例衰减模型 `delay_hit = 1/(1+0.3×delay_beats)`。AOE法术可部分补偿延迟风险（全屏法术不需精确瞄准）。
- **距离命中折扣**：短射程音符（如E、F、G）的命中率基于其有效射程与基准射程(1260px)的比值。大弹体（高SIZE）可部分补偿距离劣势。
- **风险评分重构**：风险评分从3维扩展为5维加权模型：HP损失(30) + 单调锁定(25) + 密度过载(15) + 延迟空窗(15) + 近身风险(15)。

**验证结果：**
- G音符raw DPS最高(60)，但射程仅420px，距离折扣后有效DPS降低约67%，与其他音符的差距大幅缩小，符合“高伤快消”的定位。
- 减十三和弦虽然名义5.0x倍率，但延迟折扣后有效倍率3.64x，全屏AOE的补偿使其仍然最强但不再碾压。

**相关文档：**
- [数值设计文档 v2.1](Docs/Numerical_Design_Documentation.md) — 第5章：延迟与距离风险体系
- [跑分系统方法论 v2.1](BalanceKit/Methodology.md) — 第6章：v2.1更新说明

### v2.0 (2026年2月7日)

**新增：肉鸽数值成长系统与扩展和弦体系**

为肉鸽生存者模式设计了完整的数值成长系统和后期策略深度。

**核心内容：**
- **五大类升级**：音符属性强化、疲劳耐受强化、节奏精通、和弦精通、生存强化，共25+种升级项。
- **音符成长继承**：对单个音符的强化会被其参与构成的和弦法术继承，确保基础强化贯穿整体。
- **扩展和弦 (5-6音)**：九和弦、十一和弦、十三和弦等高级和弦，提供毁灭性威力但伴随极高的不和谐度和疲劳代价，需通过传说级升级解锁。
- **自动化平衡性跑分系统**：实现了一键验证数值平衡性的工具，包含核心跑分引擎和可视化报告生成器。

**相关文档：**
- [数值设计文档 v2.0](Docs/Numerical_Design_Documentation.md) — 第3-4章
- [跑分系统方法论](BalanceKit/Methodology.md)

### 听感疲劳系统 v2.0 (2026年2月7日)

**新增：密度疲劳维度**

引入了三个新的疲劳维度来处理"音乐需要空隙"的问题，堵住了v1.0中"连绵不绝"的漏洞。

**新增维度：**
- **事件密度疲劳**：惩罚过高的施法频率（认知过载）。
- **留白缺失疲劳**：惩罚缺乏适当施法间歇的行为，奖励"呼吸感"。
- **持续施法压力**：惩罚长时间不间断的连续施法。

**相关文档：**
- [听感疲劳系统文档 v2.0](Docs/AestheticFatigueSystem_Documentation.md)
- [密度疲劳评估报告](Archive/Assessment_Report_Density_Fatigue.md)


### 7.2. 局外成长系统：和谐殿堂 (Meta-Progression)

为了提供长线的游戏目标和持续的成长感，游戏引入了名为“和谐殿堂”的局外成长系统。玩家在每局游戏结束后，可以利用收集到的“共鸣碎片”来解锁永久性的强化、新的游戏机制和不同的开局职业（调式）。

该系统的设计旨在辅助而非主导玩家的成长体验，其核心目标是逐步扩展玩家的策略选择空间，并平滑化游戏前期的学习曲线。所有数值加成都被严格限制在预设的边界内，以确保局内的肉鸽体验和平衡性始终是游戏的核心。

**核心模块：**
- **乐器调优 (Instrument Tuning)**：提供基础属性的永久加成。
- **乐理研习 (Theory Archives)**：逐步解锁更复杂的黑键修饰符与和弦类型。
- **调式风格 (Mode Mastery)**：解锁并选择拥有独特优劣势的开局“职业”。
- **声学降噪 (Acoustic Treatment)**：提供对“听感疲劳”系统的永久性缓解措施。

详细设计请参阅 **[局外成长系统设计文档](Docs/MetaProgressionSystem_Documentation.md)**。
