# 游戏设计文档：Project Harmony

**作者：** Manus AI (根据 gdszyy 的创意与反馈迭代)
**版本：** 1.0 (Live Document)
**最后更新：** 2026年2月7日

---

## 1. 游戏概述 (Game Overview)

### 1.1. 核心概念 (High Concept)

**Project Harmony** 是一款将音乐理论与魔法系统深度结合的幸存者类（Survivor-like）肉鸽（Roguelike）游戏。在这个游戏中，玩家的每一次法术施放和组合，都在实时创作一首乐曲。游戏的核心平衡与资源管理，完全基于“音乐性”的内在逻辑，为玩家带来一种前所未有的、在战斗中进行音乐创作的独特体验。

### 1.2. 设计支柱 (Core Pillars)

- **音乐即编程 (Music as Programming):** 游戏摒弃了传统的预设技能，将音符、和弦、节奏作为构建法术的参数与函数，玩家通过“编曲”来“编程”自己的战斗方式。
- **听感即平衡 (Aesthetics as Balance):** 利用人类对音乐和谐与不和谐的直观感受，构建了一套内在的、符合直觉的资源与风险管理系统。
- **战斗即创作 (Combat as Composition):** 将游戏过程升华为一场从无序、刺耳的噪音到和谐、悦耳的乐章的音乐创作之旅，玩家每一轮的战斗都将谱写出独一无二的乐曲。

---

## 2. 核心游戏机制 (Core Gameplay Mechanics)

### 2.1. 节奏同步战斗 (Rhythmic Combat)

游戏中的所有“弹幕发射”（即法术施放）都将严格遵循一个全局的音乐节拍（如4/4拍）。游戏将采用节奏感强烈的音乐类型作为背景，其稳定且清晰的鼓点将作为玩家行动的节拍器，所有法术的触发时点都将自动对齐到这些节拍上。

### 2.2. “单音寂静” — 三维惩罚模型

取代了传统的冷却时间或法力值，这是一个基于“音乐多样性”的资源系统，包含三个维度：

| 维度 | 触发原因 | 惩罚 | 消解方式 |
|---|---|---|---|
| **单调值** | 重复同一音符 | 该音符进入"寂静"，暂时禁用 | 使用不同音符；适度不和谐也可缓解 |
| **密度值** | 音符堆太满，没有呼吸感 | "噪音过载"Debuff，降低精准度 | 编入休止符，留出空拍 |
| **不和谐值** | 使用不和谐法术 | 直接扣血（生命腐蚀） | 施放和谐法术或"解决和弦" |

**关键交互：** 不和谐音是双刃剑——它会扣血，但因为引入了变化，可以有效降低**单调值**。

### 2.3. 双模施法系统

- **自动施法**：4小节×4拍的"乐谱序列器"，战斗前编排，战斗中自动执行。每拍可放一个音符，或整小节放一个和弦，也可编入休止符。
- **手动施法**：2-4个快捷键，对齐到**八分音符**精度（每小节8个施法时机），用于精准释放强力法术。

---

## 3. 法术构建系统 (Spellcraft System)

### 3.1. 白键音符：四维参数弹体

每个白键音符代表一种具有独特属性配比的**基础弹体**。四维总和恒定为**12**。

> **四维参数：** 伤害(DMG), 飞行速度(SPD), 持续时间(DUR), 弹体大小(SIZE)

| 音符 | DMG | SPD | DUR | SIZE | 特点 |
|---|---|---|---|---|---|
| C | 3 | 3 | 3 | 3 | 均衡型 |
| D | 2 | **5** | 3 | 2 | 极速远程 |
| E | 2 | 2 | **4** | **4** | 大范围持久 |
| F | 2 | 1 | **5** | **4** | 区域控制 |
| G | **5** | 3 | 2 | 2 | 爆发伤害 |
| A | **4** | 2 | **4** | 2 | 持久高伤 |
| B | **4** | **4** | 2 | 2 | 高速高伤 |

### 3.2. 黑键音符：双重身份

黑键拥有两种截然不同的使用方式：

1.  **作为修饰符**：单独使用时，为下一个法术附加一次性效果。
    - **C#/Db (锐化):** 穿透
    - **D#/Eb (追踪):** 追踪
    - **F#/Gb (分裂):** 分裂
    - **G#/Ab (回响):** 回响
    - **A#/Bb (散射):** 散射

2.  **作为和弦构成音**：与白键组合，改变和弦的性质，进而改变法术的形态。

![黑键的双重身份](Assets/black_key_dual_role_v5.png)
*图1：黑键既可以作为独立的修饰符，也可以作为和弦的一部分来改变其类型。*

### 3.3. 和弦：法术形态生成器

当音符组合成一个**和弦**时，法术的形态将由该和弦的**乐理类型**决定。

![和弦类型→法术形态映射](Assets/chord_spell_form_v5.png)
*图2：不同类型的和弦如何映射到截然不同的法术形态。*

| 和弦类型 | 法术形态 | 设计思路 |
| :--- | :--- | :--- |
| 大三和弦 | **强化弹体** | 稳定和谐 → 增强基础 |
| 小三和弦 | **DOT弹体** | 忧郁持续 → 持续伤害 |
| 增三和弦 | **爆炸弹体** | 膨胀扩张 → 范围爆炸 |
| 减三和弦 | **冲击波** | 收缩紧张 → 塌缩爆发 |
| 属七和弦 | **法阵/区域** | 需要“解决” → 持续存在 |
| 减七和弦 | **天降打击** | 极度不稳定 → 毁灭打击 |
| 大七和弦 | **护盾/治疗法阵** | 温暖丰满 → 保护 |
| 小七和弦 | **召唤/构造** | 深沉厚重 → 地面构造 |
| 挂留和弦 | **蓄力弹体** | 悬而未决 → 延迟释放 |

### 3.4. 和弦进行：泛化的功能函数

乐段效果由任意两个相邻和弦的**功能转换**决定，并引入**完整度奖励**。

![泛化和弦进行规律](Assets/generalized_progression_v5.png)
*图3：和弦功能之间的转换方向决定了触发效果的类型。*

| 功能转换 | 含义 | 触发效果类型 |
| :--- | :--- | :--- |
| **D → T** | **紧张到解决** | 爆发性的正面效果（如：**爆发治疗、全屏伤害**） |
| **T → D** | **稳定到紧张** | 蓄力或增伤效果（如：**下一个法术伤害翻倍**） |
| **PD → D** | **准备到紧张** | 加速或增幅效果（如：**全体冷却缩减**） |

-   **完整度奖励**：2和弦(x1.0) → 3和弦(x1.5) → 4和弦(x2.0)

### 3.5. 节奏型：小节级的行为模式

玩家在序列器中编排的**节奏型**，会直接改变该小节内所有弹体的**行为模式**。

| 节奏型 | 弹体行为修饰 |
| :--- | :--- |
| 均匀八分音符 | **[连射]** 弹体大小-1，但每拍发射2个。 |
| 附点节奏 | **[重击]** 飞行速度-1，但伤害+1，并获得击退。 |
| 切分节奏 | **[闪避射击]** 发射时，玩家向后微小位移。 |
| 摇摆节奏 | **[摇摆弹道]** S型/波浪形轨迹飞行。 |
| 三连音 | **[三连发]** 伤害50%，但每拍发射3个扇形弹体。 |
| 休止符 | **[精准蓄力]** 每有一个休止符，小节内其他弹体伤害和大小+0.5。 |

---

## 4. 扩展性与长线设计

### 4.1. 角色/职业系统：基于调性与音阶

为了提供丰富的重玩价值和多样的游戏体验，可以将不同的“调性”（Key）或“音阶”（Scale）设计为不同的英雄角色或职业。例如，“C大调”英雄可能基础法术和谐悦耳，成长曲线平滑；而某个“布鲁斯音阶”英雄可能天生就拥有更多“不和谐”但潜力巨大的法术选项，玩法风格将截然不同。


---

## 5. 数值设计更新日志

本章节记录数值设计文档的重大更新，完整的数值设计请参阅 **[Numerical_Design_Documentation.md](Docs/Numerical_Design_Documentation.md)**。

### v2.1 (2026年2月7日)

**新增：延迟与距离风险维度**

引入了对法术"延迟"和"短射程"的量化风险评估机制，使平衡性跑分系统能够验证"高风险法术用高伤害/大范围补偿"这一设计原则的落实情况。

**核心机制：**
- **延迟命中折扣**：延迟法术（如挂留和弦、减七和弦）的命中率采用反比例衰减模型 `delay_hit = 1/(1+0.3×delay_beats)`。AOE法术可部分补偿延迟风险（全屏法术不需精确瞄准）。
- **距离命中折扣**：短射程音符（如F、G）的命中率基于其有效射程与基准射程(900px)的比值。大弹体（高SIZE）可部分补偿距离劣势。
- **风险评分重构**：风险评分从3维扩展为5维加权模型：HP损失(30) + 单调锁定(25) + 密度过载(15) + 延迟空窗(15) + 近身风险(15)。

**验证结果：**
- G音符虽然raw DPS最高(50)，但距离折扣后有效DPS降低约33%，与其他音符的差距缩小，符合设计预期。
- 减十三和弦虽然名义5.0x倍率，但延迟折扣后有效倍率3.64x，全屏AOE的补偿使其仍然最强但不再碾压。

**相关文档：**
- [数值设计文档 v2.1](Docs/Numerical_Design_Documentation.md) — 第5章：延迟与距离风险体系
- [跑分系统方法论 v2.1](BalanceKit/Methodology.md) — 第6章：v2.1更新说明

### v2.0 (2026年2月7日)

**新增：肉鸽数值成长系统与扩展和弦体系**

为肉鸽生存者模式设计了完整的数值成长系统和后期策略深度。

**核心内容：**
- **五大类升级**：音符属性强化、疲劳耐受强化、节奏精通、和弦精通、生存强化，共25+种升级项。
- **音符成长继承**：对单个音符的强化会被其参与构成的和弦法术继承，确保基础强化贯穿整体。
- **扩展和弦 (5-6音)**：九和弦、十一和弦、十三和弦等高级和弦，提供毁灭性威力但伴随极高的不和谐度和疲劳代价，需通过传说级升级解锁。
- **自动化平衡性跑分系统**：实现了一键验证数值平衡性的工具，包含核心跑分引擎和可视化报告生成器。

**相关文档：**
- [数值设计文档 v2.0](Docs/Numerical_Design_Documentation.md) — 第3-4章
- [跑分系统方法论](BalanceKit/Methodology.md)

### 听感疲劳系统 v2.0 (2026年2月7日)

**新增：密度疲劳维度**

引入了三个新的疲劳维度来处理"音乐需要空隙"的问题，堵住了v1.0中"连绵不绝"的漏洞。

**新增维度：**
- **事件密度疲劳**：惩罚过高的施法频率（认知过载）。
- **留白缺失疲劳**：惩罚缺乏适当施法间歇的行为，奖励"呼吸感"。
- **持续施法压力**：惩罚长时间不间断的连续施法。

**相关文档：**
- [听感疲劳系统文档 v2.0](Docs/AestheticFatigueSystem_Documentation.md)
- [密度疲劳评估报告](Archive/Assessment_Report_Density_Fatigue.md)
